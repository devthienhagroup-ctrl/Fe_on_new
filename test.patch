diff --git a/src/components/thiet-kegiandien/AppointmentsPage.vue b/src/components/thiet-kegiandien/AppointmentsPage.vue
index 3743ee2bfed3e3dbc96235a2127ad1f70090d20e..8969190b1f23af90be9e71fa8c12056e09b7f590 100644
--- a/src/components/thiet-kegiandien/AppointmentsPage.vue
+++ b/src/components/thiet-kegiandien/AppointmentsPage.vue
@@ -1,61 +1,62 @@
 <script setup>
 import { ref, reactive, onMounted, onBeforeUnmount, nextTick, watch } from 'vue'
 import { Chart, registerables } from 'chart.js'
 import api from '/src/api/api.js'
 import FileNew from './File.vue'
 Chart.register(...registerables)

 const rootRef = ref(null)
 const cleanupHandlers = []
 let chart1 = null
 let chart2 = null
 let chart3 = null
+let chart4 = null
+let chart5 = null
 const statsReady = ref(false)

 // ===== Stats (KH√îNG ƒÉn theo b·ªô l·ªçc) =====
 const statTotal = ref(0)
 const statSelectedDay = ref(0)
 const statUp = ref(0)
 const statPending = ref(0)
 const statCancelled = ref(0)
 // ===== Filter (CH·ªà √°p d·ª•ng cho Calendar + Day Schedule + Table) =====
 const activeFilterText = ref('Tu·∫ßn n√†y')
 const activeFilterCount = ref(0)
 const filteredAppointments = ref([])

 const daySlots = ref([])
 const dayTitle = ref('')
 const calendarTitle = ref('')
 const calendarCells = ref([])
 const historyItems = ref([])

 const openActionMenuId = ref(null)
 const dragOverSlot = ref(null)
 // ===== Summary from BE =====
-const summaryLoading = ref(false)
-const summaryError = ref('')
+const statsAppointments = ref([])


 function getActionInfo(action) {
   return APPOINTMENT_ACTION[action] || {
     label: action,
     cls: 'act-other',
   }
 }

 const registerWindowListener = (event, handler, options) => {
   window.addEventListener(event, handler, options)
   cleanupHandlers.push(() => window.removeEventListener(event, handler, options))
 }

 const $ = (sel, root = rootRef.value) => (root ? root.querySelector(sel) : null)
 const pad2 = (n) => String(n).padStart(2, '0')
 const nowISO = () => new Date().toISOString()
 function getTodayISO() {
   const now = new Date()
   const y = now.getFullYear()
   const m = String(now.getMonth() + 1).padStart(2, '0')
   const d = String(now.getDate()).padStart(2, '0')
   return `${y}-${m}-${d}`
 }

@@ -152,50 +153,55 @@ const TIME_SLOTS = Array.from({ length: DAY_END_HOUR - DAY_START_HOUR + 1 }, (_,

 function timeToMinutes(time) {
   const [h, m] = String(time || '').split(':')
   return Number(h) * 60 + Number(m)
 }

 function buildDaySlotTimes(list) {
   const times = new Set(TIME_SLOTS)
   list.forEach((a) => {
     if (!a?.time) return
     const minutes = timeToMinutes(a.time)
     if (Number.isNaN(minutes)) return
     if (minutes < DAY_START_HOUR * 60 || minutes > DAY_END_HOUR * 60) return
     times.add(a.time)
   })
   return Array.from(times).sort((a, b) => timeToMinutes(a) - timeToMinutes(b))
 }

 function formatVNDate(yyyyMMdd) {
   const [y, m, d] = yyyyMMdd.split('-')
   return `${d}/${m}/${y}`
 }
 function formatShortDateLabel(dateObj) {
   return `${dateObj.getDate()}/${dateObj.getMonth() + 1}`
 }
+function formatCurrencyVND(value) {
+  const number = Number(value)
+  if (!Number.isFinite(number)) return '-'
+  return number.toLocaleString('vi-VN') + ' ƒë'
+}
 function toISODate(d) {
   return `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`
 }
 function startOfWeek(dateObj) {
   const d = new Date(dateObj)
   const day = d.getDay()
   const diff = (day === 0 ? -6 : 1) - day
   d.setDate(d.getDate() + diff)
   d.setHours(0, 0, 0, 0)
   return d
 }
 function endOfWeek(dateObj) {
   const s = startOfWeek(dateObj)
   const e = new Date(s)
   e.setDate(e.getDate() + 7)
   return e
 }
 function endOfWeekInclusive(dateObj) {
   const s = startOfWeek(dateObj)
   const e = new Date(s)
   e.setDate(e.getDate() + 6)
   return e
 }
 function initials(name) {
   const parts = String(name || '')
@@ -301,55 +307,56 @@ function monthTitle(d) {
 }

 // ===== Conflict =====
 function hasConflict({ id = null, date, time, staff }) {
   return appointments.value.find((a) => a.id !== id && a.date === date && a.time === time && a.staff === staff && a.status !== 'CANCELLED')
 }

 // ===== Apply filters (Calendar + Day + Table) =====
 function applyFilters(list) {
   const out = [...list]
   out.sort((a, b) => `${b.date} ${b.time}`.localeCompare(`${a.date} ${a.time}`))
   return out
 }

 function updateFilterOutputs() {
   const filtered = applyFilters(appointments.value)
   filteredAppointments.value = filtered
   activeFilterCount.value = filtered.length

   const rangeText =
       activeRange.value === 'today' ? 'H√¥m nay' : activeRange.value === 'week' ? 'Tu·∫ßn n√†y' : 'Th√°ng n√†y'
   activeFilterText.value = `${rangeText}`
 }

 function updateGlobalStats() {
-  const all = [...appointments.value]
+  const all = [...statsAppointments.value]
   statTotal.value = all.length
   statSelectedDay.value = all.filter((a) => a.date === selectedDateISO.value).length
   statUp.value = all.filter((a) => a.status === 'UP').length
   statPending.value = all.filter((a) => ['WAITING', 'NOT_UP', 'POSTPONED'].includes(a.status)).length
+  statCancelled.value = all.filter((a) => a.status === 'CANCELLED').length
 }

 // ===== Calendar markers by day (orange/blue) =====
 function getMonthKey() {
   const y = calendarMonth.value.getFullYear()
   const m = calendarMonth.value.getMonth()
   return { y, m, key: `${y}-${pad2(m + 1)}` }
 }
 function buildDayMarkerMap(monthKey) {
   const map = new Map() // dayNumber -> marker {color, glow}
   const monthAppts = appointments.value.filter((a) => a.date.startsWith(monthKey) && a.status !== 'CANCELLED')
   monthAppts.forEach((a) => {
     const day = Number(a.date.slice(-2))
     const mk = map.get(day)
     const marker = getRowMarker(a)
     // ∆∞u ti√™n ORANGE n·∫øu c√≥ createdByMe; n·∫øu kh√¥ng th√¨ BLUE
     if (!mk) {
       map.set(day, marker)
     } else {
       if (marker.color === '#ffb347') map.set(day, marker)
     }
   })
   return map
 }

@@ -450,72 +457,74 @@ function getFilterRange() {

   const year = calendarMonth.value.getFullYear()
   const month = calendarMonth.value.getMonth()
   const start = new Date(year, month, 1)
   const end = new Date(year, month + 1, 0)
   return { startDate: toISODate(start), endDate: toISODate(end) }
 }

 function mapAppointmentFromApi(dto) {
   return {
     id: dto.appointmentId,
     customerId: dto.customerId,
     customer: dto.customerName,
     phone: dto.customerPhone,
     date: dto.appointmentDate,
     time: dto.appointmentTime,
     staffId: dto.staffId,
     staff: dto.staffName,
     consultantId: dto.consultantId,
     consultant: dto.consultantName,
     creatorId: dto.creatorId,
     creator: dto.creatorName,
     status: dto.status,
     consultStatus: dto.consultStatus,
     rating: dto.rating,
+    fee: dto.phi ?? 0,
     createdByMe: dto.createdByMe,
     inCharge: dto.inCharge,
     branch: dto.branch || '',
     customerType: dto.customerType || null,
     note: dto.note || '',
     history: dto.history || [],
   }
 }
 const detailLoading = ref(false)
 const detailError = ref('')
 const editLoading = ref(false)
 const editError = ref('')
 function mapAppointmentDetailFromApi(dto) {
   return {
     id: dto.appointmentId,

     customerId: dto.customer?.id,
     customer: dto.customer?.name,
     phone: dto.customer?.phone,
     address: dto.customer?.address,
     oldAddress: dto.customer?.oldAress,
     customerNote: dto.customer?.customerNote,
+    customerFee: dto.customer?.phi ?? null,
     customerType: dto.customer?.customerType,
     files: dto.customer?.files || [],

     date: dto.appointmentDate,
     time: dto.appointmentTime,
     status: dto.status,
     consultStatus: dto.consultStatus,
     rating: dto.rating,
     note: dto.note,
     branchId: dto.branchID ?? null,   // ‚úÖ ID
     branch: dto.branch ?? null,

     consultantId: dto.consultant?.id ?? dto.consultantId,
     consultant: dto.consultant?.name,
     creator: dto.creator?.name,

     history: (dto.histories || []).map(h => ({
       ts: h.createdAt,
       actor: h.actorName,
       action: h.action,
       desc: h.note,
       status: h.status,
       consultStatus: h.consultStatus,
     })),
   }
@@ -549,85 +558,103 @@ async function fetchAppointments() {
     endDate,
     status: activeStatus.value === 'ALL' ? null : activeStatus.value,
     search: searchKeyword.value ? searchKeyword.value.trim() : null,
   }

   appointmentsLoading.value = true
   appointmentsError.value = ''

   try {
     const res = await api.post('/customer-crm/admin/lich-hen/filter', payload)
     const data = Array.isArray(res.data) ? res.data : []
     appointments.value = data.map(mapAppointmentFromApi)
   } catch (e) {
     appointments.value = []
     appointmentsError.value = 'Kh√¥ng th·ªÉ t·∫£i l·ªãch h·∫πn.'
     showToast('L·ªói t·∫£i l·ªãch h·∫πn', e?.response?.data?.message || 'Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.', 'error')
   } finally {
     appointmentsLoading.value = false
   }

   generateCalendar()
   updateDaySchedule()
   updateFilterOutputs()
 }

+async function fetchStatsAppointments() {
+  const { startDate, endDate } = getFilterRange()
+  const payload = {
+    startDate,
+    endDate,
+    status: null,
+    search: null,
+  }
+
+  try {
+    const res = await api.post('/customer-crm/admin/lich-hen/filter', payload)
+    const data = Array.isArray(res.data) ? res.data : []
+    statsAppointments.value = data.map(mapAppointmentFromApi)
+  } catch (e) {
+    statsAppointments.value = []
+    showToast('L·ªói t·∫£i th·ªëng k√™', e?.response?.data?.message || 'Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.', 'error')
+  }
+}
+
 function handleCalendarClick(cell) {
   if (!cell.currentMonth || !cell.iso) return
   if (!cell.enabled) return

   selectedDateISO.value = cell.iso
   updateDaySchedule()
   updateFilterOutputs()
   generateCalendar()
 }

 function handleMonthNav(dir) {
   if (activeRange.value !== 'month') return
   const y = calendarMonth.value.getFullYear()
   const m = calendarMonth.value.getMonth()
   const next = new Date(y, m + dir, 1)
   calendarMonth.value = next
   const nextISO = `${next.getFullYear()}-${pad2(next.getMonth() + 1)}-01`
   selectedDateISO.value = nextISO
   generateCalendar()
   updateDaySchedule()
   updateFilterOutputs()
 }

 // ===== Day schedule (ƒÉn theo selectedDate + filter range disable) =====
 function apptsForSelectedDay() {
   // Day Schedule c≈©ng ph·∫£i n·∫±m trong range
   const inRange = isCellEnabled(selectedDateISO.value)
   if (!inRange) return []
   return appointments.value.filter((a) => a.date === selectedDateISO.value).sort((a, b) => a.time.localeCompare(b.time))
 }

 function updateDaySchedule() {
   dayTitle.value = `Day Schedule ‚Ä¢ ${formatVNDate(selectedDateISO.value)}`
   const list = apptsForSelectedDay()
-  statSelectedDay.value = list.length

   const slotTimes = buildDaySlotTimes(list)
   const byTime = new Map()
   slotTimes.forEach((t) => byTime.set(t, []))
   list.forEach((a) => {
     const minutes = timeToMinutes(a.time)
     if (Number.isNaN(minutes)) return
     if (minutes < DAY_START_HOUR * 60 || minutes > DAY_END_HOUR * 60) return
     if (!byTime.has(a.time)) byTime.set(a.time, [])
     byTime.get(a.time).push(a)
   })

   daySlots.value = slotTimes.map((t) => ({ time: t, appointments: byTime.get(t) || [] }))
 }

 // ===== Drag/drop =====
 function handleDragStart(e, appt) {
   if (appt.status === 'CANCELLED') return
   e.dataTransfer.setData('text/plain', String(appt.id))
   e.dataTransfer.effectAllowed = 'move'
 }
 function handleDragOver(e, time) {
   e.preventDefault()
   dragOverSlot.value = time
 }
@@ -1191,449 +1218,608 @@ function exportCSV() {
   const a = document.createElement('a')
   a.href = url
   a.download = `lich-hen_${selectedDateISO.value}.csv`
   document.body.appendChild(a)
   a.click()
   a.remove()
   URL.revokeObjectURL(url)

   showToast('Xu·∫•t file th√†nh c√¥ng', `ƒê√£ xu·∫•t ${filtered.length} d√≤ng CSV.`, 'success')
 }

 // ===== Charts =====
 function destroyCharts() {
   if (chart1) {
     chart1.destroy()
     chart1 = null
   }
   if (chart2) {
     chart2.destroy()
     chart2 = null
   }
   if (chart3) {
     chart3.destroy()
     chart3 = null
   }
+  if (chart4) {
+    chart4.destroy()
+    chart4 = null
+  }
+  if (chart5) {
+    chart5.destroy()
+    chart5 = null
+  }
 }
 function makeGrad(ctx, stops) {
   const g = ctx.createLinearGradient(0, 0, 0, 220)
   stops.forEach((s) => g.addColorStop(s[0], s[1]))
   return g
 }
+const doughnutCenterPlugin = {
+  id: 'doughnutCenterText',
+  beforeDraw(chart) {
+    const { ctx, chartArea } = chart
+    if (!chartArea) return
+    const dataset = chart.data.datasets?.[0]
+    if (!dataset) return
+    const total = (dataset.data || []).reduce((sum, val) => sum + (Number(val) || 0), 0)
+
+    const centerX = (chartArea.left + chartArea.right) / 2
+    const centerY = (chartArea.top + chartArea.bottom) / 2
+
+    ctx.save()
+    ctx.font = '700 22px "Plus Jakarta Sans", sans-serif'
+    ctx.fillStyle = '#0f172a'
+    ctx.textAlign = 'center'
+    ctx.textBaseline = 'middle'
+    ctx.fillText(total.toLocaleString('vi-VN'), centerX, centerY - 4)
+    ctx.font = '600 12px "Plus Jakarta Sans", sans-serif'
+    ctx.fillStyle = '#64748b'
+    ctx.fillText('T·ªïng', centerX, centerY + 16)
+    ctx.restore()
+  },
+}
 function initCharts() {
   const c1 = $('#appointmentsChart')
   const c2 = $('#statusChart')
   const c3 = $('#successChart')
-  if (!c1 || !c2 || !c3) return
+  const c4 = $('#successChartSecondary')
+  const c5 = $('#revenueChart')
+  if (!c1 || !c2 || !c3 || !c4 || !c5) return

   destroyCharts()

   // Chart 1 (Bar)
   const ctx1 = c1.getContext('2d')
   const barGrad = makeGrad(ctx1, [
     [0, 'rgba(102,126,234,0.95)'],
-    [0.55, 'rgba(118,75,162,0.78)'],
-    [1, 'rgba(79,172,254,0.50)'],
+    [0.6, 'rgba(118,75,162,0.7)'],
+    [1, 'rgba(79,172,254,0.35)'],
   ])

   chart1 = new Chart(ctx1, {
     type: 'bar',
     data: {
       labels: [],
       datasets: [
         {
           label: 'S·ªë l·ªãch h·∫πn',
           data: [],
           backgroundColor: barGrad,
           borderWidth: 0,
-          borderRadius: 14,
+          borderRadius: 10,
           borderSkipped: false,
-          barPercentage: 0.7,
-          categoryPercentage: 0.72,
+          barPercentage: 0.62,
+          categoryPercentage: 0.7,
         },
       ],
     },
     options: {
       responsive: true,
       maintainAspectRatio: false,
+      interaction: {
+        mode: 'index',
+        intersect: false,
+      },
       plugins: {
         legend: { display: false },
         tooltip: {
-          backgroundColor: 'rgba(20,22,30,0.92)',
+          enabled: true,
+          backgroundColor: 'rgba(15,23,42,0.95)',
           padding: 10,
           titleColor: '#fff',
           bodyColor: '#e8edf6',
           displayColors: false,
         },
       },
       scales: {
         y: {
           beginAtZero: true,
           ticks: { color: '#5b6576', font: { weight: '600' } },
-          grid: { color: 'rgba(20,22,30,.08)' },
+          grid: { color: 'rgba(148,163,184,0.22)' },
         },
         x: {
           ticks: { color: '#5b6576', font: { weight: '600' } },
           grid: { display: false },
         },
       },
     },
   })

   // Chart 2 (Doughnut)
   const ctx2 = c2.getContext('2d')
   const gWait = makeGrad(ctx2, [
-    [0, 'rgba(251,191,36,0.95)'],   // v√†ng 400
-    [1, 'rgba(253,230,138,0.55)'],  // v√†ng nh·∫°t
+    [0, 'rgba(251,191,36,0.95)'],
+    [1, 'rgba(253,230,138,0.55)'],
   ])
   const gUp = makeGrad(ctx2, [
     [0, 'rgba(67,233,123,0.95)'],
     [1, 'rgba(56,249,215,0.55)'],
   ])
   const gNot = makeGrad(ctx2, [
     [0, 'rgba(250,112,154,0.92)'],
-    [1, 'rgba(254,225,64,0.50)'],
+    [1, 'rgba(254,225,64,0.55)'],
   ])
   const gPost = makeGrad(ctx2, [
     [0, 'rgba(79,172,254,0.95)'],
     [1, 'rgba(0,242,254,0.55)'],
   ])
   const gCancel = makeGrad(ctx2, [
-    [0, 'rgba(255,88,88,0.90)'],
+    [0, 'rgba(255,88,88,0.9)'],
     [1, 'rgba(240,152,25,0.55)'],
   ])
-
   chart2 = new Chart(ctx2, {
     type: 'doughnut',
     data: {
       labels: [],
       datasets: [
         {
           data: [],
           backgroundColor: [gWait, gUp, gNot, gPost, gCancel],
           borderWidth: 0,
           hoverOffset: 6,
           spacing: 3,
         },
       ],
     },
     options: {
       responsive: true,
       maintainAspectRatio: false,
-      cutout: '70%',
+      cutout: '72%',
+      interaction: {
+        mode: 'nearest',
+        intersect: false,
+      },
       plugins: {
         legend: {
           position: 'bottom',
           labels: { color: '#455064', boxWidth: 10, boxHeight: 10, font: { weight: '600' } },
         },
         tooltip: {
+          enabled: true,
           backgroundColor: 'rgba(20,22,30,0.92)',
           padding: 10,
           titleColor: '#fff',
           bodyColor: '#e8edf6',
           displayColors: true,
         },
       },
     },
+    plugins: [doughnutCenterPlugin],
   })

   // Chart 3 (Pie)
   const ctx3 = c3.getContext('2d')
   const gSuccess = makeGrad(ctx3, [
     [0, 'rgba(67,233,123,0.95)'],
     [1, 'rgba(56,249,215,0.55)'],
   ])
   const gFail = makeGrad(ctx3, [
-    [0, 'rgba(255,88,88,0.90)'],
+    [0, 'rgba(255,88,88,0.9)'],
     [1, 'rgba(240,152,25,0.55)'],
   ])
   const gCare = makeGrad(ctx3, [
     [0, 'rgba(79,172,254,0.95)'],
     [1, 'rgba(0,242,254,0.55)'],
   ])
-
   chart3 = new Chart(ctx3, {
     type: 'pie',
     data: {
       labels: ['Th√†nh c√¥ng', 'Th·∫•t b·∫°i', 'ChƒÉm s√≥c'],
       datasets: [
         {
           data: [0, 0, 0],
           backgroundColor: [gSuccess, gFail, gCare],
           borderWidth: 0,
           hoverOffset: 6,
           spacing: 2,
         },
       ],
     },
     options: {
       responsive: true,
       maintainAspectRatio: false,
+      interaction: {
+        mode: 'nearest',
+        intersect: false,
+      },
+      plugins: {
+        legend: {
+          position: 'bottom',
+          labels: { color: '#455064', boxWidth: 10, boxHeight: 10, font: { weight: '600' } },
+        },
+        tooltip: {
+          enabled: true,
+          backgroundColor: 'rgba(20,22,30,0.92)',
+          padding: 10,
+          titleColor: '#fff',
+          bodyColor: '#e8edf6',
+        },
+      },
+    },
+  })
+
+  // Chart 4 (Pie - Secondary)
+  const ctx4 = c4.getContext('2d')
+  const gSuccess2 = makeGrad(ctx4, [
+    [0, 'rgba(67,233,123,0.95)'],
+    [1, 'rgba(56,249,215,0.55)'],
+  ])
+  const gFail2 = makeGrad(ctx4, [
+    [0, 'rgba(255,88,88,0.9)'],
+    [1, 'rgba(240,152,25,0.55)'],
+  ])
+  const gCare2 = makeGrad(ctx4, [
+    [0, 'rgba(79,172,254,0.95)'],
+    [1, 'rgba(0,242,254,0.55)'],
+  ])
+  chart4 = new Chart(ctx4, {
+    type: 'pie',
+    data: {
+      labels: ['Th√†nh c√¥ng', 'Th·∫•t b·∫°i', 'ChƒÉm s√≥c'],
+      datasets: [
+        {
+          data: [0, 0, 0],
+          backgroundColor: [gSuccess2, gFail2, gCare2],
+          borderWidth: 0,
+          hoverOffset: 6,
+          spacing: 2,
+        },
+      ],
+    },
+    options: {
+      responsive: true,
+      maintainAspectRatio: false,
+      interaction: {
+        mode: 'nearest',
+        intersect: false,
+      },
       plugins: {
         legend: {
           position: 'bottom',
           labels: { color: '#455064', boxWidth: 10, boxHeight: 10, font: { weight: '600' } },
         },
         tooltip: {
+          enabled: true,
           backgroundColor: 'rgba(20,22,30,0.92)',
           padding: 10,
           titleColor: '#fff',
           bodyColor: '#e8edf6',
         },
       },
     },
   })
+
+  // Chart 5 (Revenue)
+  const ctx5 = c5.getContext('2d')
+  const revenueGrad = makeGrad(ctx5, [
+    [0, 'rgba(102,126,234,0.5)'],
+    [0.6, 'rgba(118,75,162,0.25)'],
+    [1, 'rgba(79,172,254,0.12)'],
+  ])
+  const revenueBorder = makeGrad(ctx5, [
+    [0, 'rgba(102,126,234,0.95)'],
+    [1, 'rgba(118,75,162,0.85)'],
+  ])
+  chart5 = new Chart(ctx5, {
+    type: 'line',
+    data: {
+      labels: [],
+      datasets: [
+        {
+          label: 'Doanh thu',
+          data: [],
+          backgroundColor: revenueGrad,
+          borderColor: revenueBorder,
+          borderWidth: 2,
+          fill: true,
+          tension: 0.35,
+          pointRadius: 3,
+          pointHoverRadius: 4,
+          pointBackgroundColor: '#fff',
+          pointBorderColor: '#667eea',
+        },
+      ],
+    },
+    options: {
+      responsive: true,
+      maintainAspectRatio: false,
+      interaction: {
+        mode: 'index',
+        intersect: false,
+      },
+      plugins: {
+        legend: { display: false },
+        tooltip: {
+          enabled: true,
+          backgroundColor: 'rgba(15,23,42,0.95)',
+          padding: 10,
+          titleColor: '#fff',
+          bodyColor: '#e8edf6',
+          callbacks: {
+            label(context) {
+              return `Doanh thu: ${formatCurrencyVND(context.parsed.y)}`
+            },
+          },
+        },
+      },
+      scales: {
+        y: {
+          beginAtZero: true,
+          ticks: {
+            color: '#5b6576',
+            font: { weight: '600' },
+            callback: (value) => formatCurrencyVND(value),
+          },
+          grid: { color: 'rgba(148,163,184,0.22)' },
+        },
+        x: {
+          ticks: { color: '#5b6576', font: { weight: '600' } },
+          grid: { display: false },
+        },
+      },
+    },
+  })
 }

 // ===== Action menu =====
 function toggleActionMenu(id) {
   openActionMenuId.value = openActionMenuId.value === id ? null : id
 }
 function handleAction(type, appt, event) {
   openActionMenuId.value = null
   if (type === 'edit') openEditModal(appt.id)
   else if (type === 'status') openStatusPopover(event.currentTarget, appt.id)
   else if (type === 'delete') {
     appointments.value = appointments.value.filter((x) => x.id !== appt.id)
     generateCalendar()
     updateDaySchedule()
     updateFilterOutputs()
     showToast('ƒê√£ xo√° l·ªãch h·∫πn', appt.customer || 'ƒê√£ xo√°.', 'success')
   } else if (type === 'detail') openDetailModal(appt)
 }
-// ===== Status chart from BE =====
-const statusChartLoading = ref(false)
-const statusChartError = ref('')
-const statusChartData = ref({
-  UP: 0,
-  WAITING: 0,
-  NOT_UP: 0,
-  POSTPONED: 0,
-  CANCELLED: 0,
-})
-async function fetchStatusChart() {
-  const { startDate, endDate } = getFilterRange()
-
-  statusChartLoading.value = true
-  statusChartError.value = ''
-
-  try {
-    const res = await api.get('/customer-crm/admin/lich-hen/status-chart', {
-      params: {
-        from: startDate,
-        to: endDate,
-      },
-    })
-
-    // reset
-    statusChartData.value = {
-      UP: 0,
-      WAITING: 0,
-      NOT_UP: 0,
-      POSTPONED: 0,
-      CANCELLED: 0,
-    }
-
-    // BE tr·∫£: { items: [{ status, count }] }
-    ;(res.data.items || []).forEach(i => {
-      statusChartData.value[i.status] = i.count
-    })
-
-    // üî• update chart 2
-    updateStatusChart()
-
-  } catch (e) {
-    statusChartError.value = 'Kh√¥ng th·ªÉ t·∫£i bi·ªÉu ƒë·ªì tr·∫°ng th√°i'
-  } finally {
-    statusChartLoading.value = false
-  }
-}
 function updateStatusChart() {
   if (!chart2) return

+  const counts = {
+    WAITING: 0,
+    UP: 0,
+    NOT_UP: 0,
+    POSTPONED: 0,
+    CANCELLED: 0,
+  }
+
+  statsAppointments.value.forEach((appt) => {
+    if (!appt?.status) return
+    if (counts[appt.status] === undefined) return
+    counts[appt.status] += 1
+  })
+
   chart2.data.labels = [
     STATUS.WAITING.label,
     STATUS.UP.label,
     STATUS.NOT_UP.label,
     STATUS.POSTPONED.label,
     STATUS.CANCELLED.label,
   ]

   chart2.data.datasets[0].data = [
-    statusChartData.value.WAITING || 0,
-    statusChartData.value.UP || 0,
-    statusChartData.value.NOT_UP || 0,
-    statusChartData.value.POSTPONED || 0,
-    statusChartData.value.CANCELLED || 0,
+    counts.WAITING || 0,
+    counts.UP || 0,
+    counts.NOT_UP || 0,
+    counts.POSTPONED || 0,
+    counts.CANCELLED || 0,
   ]

   chart2.update()
 }

 function getLast7Days() {
   const days = []
   const today = new Date()
   today.setHours(0, 0, 0, 0)
   for (let i = 0; i < 7; i += 1) {
     const d = new Date(today)
     d.setDate(today.getDate() - i)
     days.push(d)
   }
   return days
 }
 function updateAppointmentsChart() {
   if (!chart1) return

   const counts = new Map()
-  appointments.value.forEach((appt) => {
+  statsAppointments.value.forEach((appt) => {
     if (!appt?.date) return
     counts.set(appt.date, (counts.get(appt.date) || 0) + 1)
   })

   const days = getLast7Days()
   chart1.data.labels = days.map((d) => formatShortDateLabel(d))
   chart1.data.datasets[0].data = days.map((d) => {
     const iso = toISODate(d)
     return counts.get(iso) || 0
   })
   chart1.update()
 }
 function updateConsultChart() {
-  if (!chart3) return
+  if (!chart3 && !chart4) return
   const counts = {
     [ConsultStatus.SUCCESS]: 0,
     [ConsultStatus.FAIL]: 0,
     [ConsultStatus.CARE]: 0,
   }

-  appointments.value.forEach((appt) => {
+  statsAppointments.value.forEach((appt) => {
     if (!appt?.consultStatus) return
     if (counts[appt.consultStatus] === undefined) return
     counts[appt.consultStatus] += 1
   })

-  chart3.data.datasets[0].data = [
+  const dataset = [
     counts[ConsultStatus.SUCCESS],
     counts[ConsultStatus.FAIL],
     counts[ConsultStatus.CARE],
   ]
-  chart3.update()
+
+  if (chart3) {
+    chart3.data.datasets[0].data = dataset
+    chart3.update()
+  }
+  if (chart4) {
+    chart4.data.datasets[0].data = dataset
+    chart4.update()
+  }
+}
+
+function getDateRangeDays() {
+  const { startDate, endDate } = getFilterRange()
+  const start = new Date(`${startDate}T00:00:00`)
+  const end = new Date(`${endDate}T00:00:00`)
+  const days = []
+  const cursor = new Date(start)
+  while (cursor <= end) {
+    days.push(new Date(cursor))
+    cursor.setDate(cursor.getDate() + 1)
+  }
+  return days
+}
+
+function updateRevenueChart() {
+  if (!chart5) return
+
+  const totals = new Map()
+  statsAppointments.value.forEach((appt) => {
+    if (!appt?.date) return
+    const fee = Number(appt.fee || 0)
+    if (!Number.isFinite(fee)) return
+    totals.set(appt.date, (totals.get(appt.date) || 0) + fee)
+  })
+
+  const days = getDateRangeDays()
+  chart5.data.labels = days.map((d) => formatShortDateLabel(d))
+  chart5.data.datasets[0].data = days.map((d) => totals.get(toISODate(d)) || 0)
+  chart5.update()
 }

 // ===== Watchers =====
 watch(
     () => [activeRange.value, activeStatus.value],
     () => {
       // ƒë·ªïi range:
       // - today/week: kho√° month nav, gi·ªØ selectedDate n·∫±m trong range
       if (activeRange.value === 'month') {
         const d = new Date(`${selectedDateISO.value}T00:00:00`)
         calendarMonth.value = new Date(d.getFullYear(), d.getMonth(), 1)
       } else {
         // ƒë·∫£m b·∫£o selected date enable
         if (!isCellEnabled(selectedDateISO.value)) {
           // k√©o v·ªÅ start tu·∫ßn / today
           if (activeRange.value === 'today') selectedDateISO.value = getTodayISO()
           if (activeRange.value === 'week') selectedDateISO.value = toISODate(startOfWeek(new Date(`${selectedDateISO.value}T00:00:00`)))
         }
       }

       generateCalendar()
       updateDaySchedule()
       updateFilterOutputs()
     },
 )
 watch(
     () => {
       const { startDate, endDate } = getFilterRange()
       return `${startDate}|${endDate}`
     },
     () => {
       if (!statsReady.value) return
-      fetchAppointmentSummary()
-      fetchStatusChart()
+      fetchStatsAppointments()
     },
     { immediate: false }
 )
-async function fetchAppointmentSummary() {
-  const { startDate, endDate } = getFilterRange()
-
-  summaryLoading.value = true
-  summaryError.value = ''
-
-  try {
-    const res = await api.get('/customer-crm/admin/lich-hen/summary', {
-      params: {
-        fromDate: startDate,
-        toDate: endDate,
-      },
-    })
-
-    statTotal.value = res.data.total ?? 0
-    statUp.value = res.data.up ?? 0
-    statPending.value = res.data.pending ?? 0
-    statCancelled.value = res.data.cancelled ?? 0
-
-  } catch (e) {
-    summaryError.value = 'Kh√¥ng th·ªÉ t·∫£i th·ªëng k√™'
-  } finally {
-    summaryLoading.value = false
-  }
-}

 watch(
     () => searchQuery.value,
     (val) => {
       if (searchTimer) clearTimeout(searchTimer)
       searchTimer = setTimeout(() => {
         searchKeyword.value = (val || '').trim()
       }, 300)
     },
 )

 watch(
     () => [selectedAppointment.value, historyItems.value.length],
     async () => {
       await nextTick()
       syncHistoryPanelHeight()
     },
 )

+watch(
+    () => selectedDateISO.value,
+    () => {
+      updateGlobalStats()
+    },
+)
+
 watch(
     () => {
       const { startDate, endDate } = getFilterRange()
       return [startDate, endDate, activeStatus.value, searchKeyword.value].join('|')
     },
     () => {
       fetchAppointments()
     },
 )
 watch(
-    () => appointments.value,
+    () => statsAppointments.value,
     () => {
+      updateGlobalStats()
       updateAppointmentsChart()
+      updateStatusChart()
       updateConsultChart()
+      updateRevenueChart()
     },
 )
 async function autoPickCustomerByPhone(phone) {
   // g√°n v√†o input t√¨m ki·∫øm
   createForm.customerSearch = phone

   // g·ªçi search
   await fetchCustomerSearch(phone)

   // ƒë·ª£i DOM + data
   await nextTick()

   // auto ch·ªçn kh√°ch ƒë·∫ßu ti√™n (SƒêT unique)
   if (customerSearchResults.value.length > 0) {
     selectCustomer(customerSearchResults.value[0])
   }


 }

 // ===== Mount =====
 onMounted(async () => {
   if (!rootRef.value) return
 // ===== AUTO M·ªû MODAL T·∫†O L·ªäCH T·ª™ TELESALE =====

@@ -1647,78 +1833,79 @@ onMounted(async () => {
   if (flagDatLich === 'true' && customerPhone) {
     // m·ªü modal t·∫°o l·ªãch
     await openCreateModal()
     await nextTick()
     // auto t√¨m + ch·ªçn kh√°ch theo SƒêT
     await autoPickCustomerByPhone(customerPhone)

     // xo√° localStorage ƒë·ªÉ tr√°nh l·∫∑p
     localStorage.removeItem('flagDatLich')
     localStorage.removeItem('customerPhone')
   }
   // ===== Init date =====
   selectedDateISO.value = getTodayISO()
   calendarMonth.value = new Date() // th√°ng hi·ªán t·∫°i

   // ===== Init data =====
   await fetchAppointments()


   // ===== Init charts =====
   await nextTick()
   initCharts()
   updateStatusChart()
   updateAppointmentsChart()
   updateConsultChart()
+  updateRevenueChart()
   statsReady.value = true

   // ===== Fetch branch options (ONLY ONCE) =====


   // ===== Ready toast =====
   showToast('S·∫µn s√†ng', 'H·ªá th·ªëng qu·∫£n l√Ω l·ªãch h·∫πn ƒë√£ s·∫µn s√†ng.', 'success')

   // ===== Global listeners =====
   registerWindowListener('keydown', (e) => {
     if (e.key === 'Escape' && (isModalOpen.value || isCreateModalOpen.value || isDetailModalOpen.value)) {
       if (isModalOpen.value) closeEditModal()
       if (isCreateModalOpen.value) closeCreateModal()
       if (isDetailModalOpen.value) closeDetailModal()
     }
   })

   registerWindowListener('resize', async () => {
     await nextTick()
     initCharts()
     syncHistoryPanelHeight()
     updateStatusChart()
     updateAppointmentsChart()
     updateConsultChart()
+    updateRevenueChart()
   })

-  await fetchAppointmentSummary()
-  await fetchStatusChart()
+  await fetchStatsAppointments()

 })


 onBeforeUnmount(() => {
   destroyCharts()
   cleanupHandlers.forEach((cleanup) => cleanup())
 })
 </script>

 <template>
   <div ref="rootRef" class="appointments-page">
     <div class="toast-wrap" id="toastWrap"></div>

     <main class="main-content">
       <div class="header">
         <div class="page-title">
           <h2><i class="fa-solid fa-calendar-check me-2"></i>Qu·∫£n l√Ω l·ªãch h·∫πn</h2>
           <p>T·∫°o, theo d√µi v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i ‚Ä¢ ph√¢n lo·∫°i ‚Ä¢ ƒë√°nh gi√°</p>
         </div>
       </div>

       <!-- Stats (KH√îNG ƒÉn filter) -->
       <section class="stats">
         <div class="stat s1">
@@ -1767,50 +1954,78 @@ onBeforeUnmount(() => {
             <div class="ico-bubble gB"><i class="fa-solid fa-chart-pie"></i></div>
             <div>
               <h4>Ph√¢n b·ªë tr·∫°ng th√°i</h4>
               <p class="sub">T·ªïng quan t√¨nh tr·∫°ng l·ªãch</p>
             </div>
           </div>
           <div class="chart-container">
             <canvas id="statusChart"></canvas>
           </div>
         </div>

         <div class="chart-card c3">
           <div class="chart-head">
             <div class="ico-bubble gC"><i class="fa-solid fa-bullseye"></i></div>
             <div>
               <h4>T·ª∑ l·ªá th√†nh c√¥ng t∆∞ v·∫•n</h4>
               <p class="sub">Hi·ªáu qu·∫£ theo k·∫øt qu·∫£</p>
             </div>
           </div>
           <div class="chart-container">
             <canvas id="successChart"></canvas>
           </div>
         </div>
       </section>

+      <section class="charts-row">
+        <div class="chart-card c3">
+          <div class="chart-head">
+            <div class="ico-bubble gC"><i class="fa-solid fa-bullseye"></i></div>
+            <div>
+              <h4>T·ª∑ l·ªá th√†nh c√¥ng t∆∞ v·∫•n</h4>
+              <p class="sub">Bi·ªÉu ƒë·ªì k·∫øt qu·∫£ (b·∫£n sao)</p>
+            </div>
+          </div>
+          <div class="chart-container">
+            <canvas id="successChartSecondary"></canvas>
+          </div>
+        </div>
+
+        <div class="chart-card c1">
+          <div class="chart-head">
+            <div class="ico-bubble gA"><i class="fa-solid fa-sack-dollar"></i></div>
+            <div>
+              <h4>Doanh thu theo ng√†y</h4>
+              <p class="sub">T·ªïng ph√≠ t·ª´ l·ªãch h·∫πn trong kho·∫£ng th·ªùi gian</p>
+            </div>
+          </div>
+          <div class="chart-container">
+            <canvas id="revenueChart"></canvas>
+          </div>
+        </div>
+      </section>
+
       <!-- Filters (CH·ªà cho l·ªãch + day + table) -->
       <div class="filters">
         <div class="filter-tabs">
           <button class="filter-btn" :class="{ active: activeRange === 'today' }" @click="activeRange = 'today'">
             H√¥m nay
           </button>
           <button class="filter-btn" :class="{ active: activeRange === 'week' }" @click="activeRange = 'week'">
             Tu·∫ßn n√†y
           </button>
           <button class="filter-btn" :class="{ active: activeRange === 'month' }" @click="activeRange = 'month'">
             Th√°ng
           </button>
         </div>

         <div class="status-filter">
           <div class="status-tag st-all" :class="{ active: activeStatus === 'ALL' }" @click="activeStatus = 'ALL'">T·∫•t c·∫£</div>
           <div class="status-tag st-wait-tag" :class="{ active: activeStatus === 'WAITING' }" @click="activeStatus = 'WAITING'">Ch·ªù x√°c nh·∫≠n</div>
           <div class="status-tag st-up-tag" :class="{ active: activeStatus === 'UP' }" @click="activeStatus = 'UP'">ƒê√£ l√™n</div>
           <div class="status-tag st-not-tag" :class="{ active: activeStatus === 'NOT_UP' }" @click="activeStatus = 'NOT_UP'">Ch∆∞a l√™n</div>
           <div class="status-tag st-post-tag" :class="{ active: activeStatus === 'POSTPONED' }" @click="activeStatus = 'POSTPONED'">T·∫°m ho√£n</div>
           <div class="status-tag st-cancel-tag" :class="{ active: activeStatus === 'CANCELLED' }" @click="activeStatus = 'CANCELLED'">Hu·ª∑</div>

           <div class="search-bar">
             <input
                 id="searchInput"
@@ -2586,50 +2801,54 @@ onBeforeUnmount(() => {
                   </div>
                   <div class="field-row">
                     <div class="field-label">T√™n kh√°ch h√†ng</div>
                     <div class="field-value">{{ selectedAppointment.customer || '-' }}</div>
                   </div>
                   <div class="field-row">
                     <div class="field-label">S·ªë ƒëi·ªán tho·∫°i</div>
                     <div class="field-value">{{ selectedAppointment.phone || '-' }}</div>
                   </div>
                   <div class="field-row">
                     <div class="field-label">ƒê·ªãa ch·ªâ hi·ªán t·∫°i</div>
                     <div class="field-value">{{ selectedAppointment.address || '-' }}</div>
                   </div>
                   <div class="field-row">
                     <div class="field-label">ƒê·ªãa ch·ªâ c≈©</div>
                     <div class="field-value">{{ selectedAppointment.oldAddress || '-' }}</div>
                   </div>
                   <div class="field-row">
                     <div class="field-label">Lo·∫°i kh√°ch</div>
                     <div class="field-value">
                       <span class="chip" :class="getCustomerTypeInfo(selectedAppointment.customerType).cls">
                         {{ getCustomerTypeInfo(selectedAppointment.customerType).label }}
                       </span>
                     </div>
                   </div>
+                  <div class="field-row">
+                    <div class="field-label">Ph√≠ d·ªãch v·ª•</div>
+                    <div class="field-value">{{ formatCurrencyVND(selectedAppointment.customerFee) }}</div>
+                  </div>
                 </div>
               </div>

               <div class="detail-section">
                 <div class="section-head">
                   <span class="section-ico si-note"><i class="fa-regular fa-note-sticky"></i></span>
                   <h5>Ghi ch√∫</h5>
                 </div>
                 <div class="section-divider"></div>
                 <div class="note-grid">
                   <div class="note-card">
                     <div class="note-title">Ghi ch√∫ l·ªãch h·∫πn</div>
                     <div class="note-body">{{ selectedAppointment.note || 'Kh√¥ng c√≥ ghi ch√∫' }}</div>
                   </div>
                   <div class="note-card">
                     <div class="note-title">Ghi ch√∫ kh√°ch</div>
                     <div class="note-body">{{ selectedAppointment.customerNote || 'Kh√¥ng c√≥ ghi ch√∫' }}</div>
                   </div>
                 </div>
               </div>

               <div class="detail-section">
                 <div class="section-head">
                   <span class="section-ico si-staff"><i class="fa-solid fa-user-tie"></i></span>
                   <h5>Nh√¢n s·ª± li√™n quan</h5>
@@ -2869,50 +3088,56 @@ onBeforeUnmount(() => {
   position:relative;
   overflow:hidden;
   min-height: 320px;
 }
 .chart-card::before{
   content:"";
   position:absolute;
   left:-2px; right:-2px; top:-2px;
   height:6px;
   background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
   opacity:0.65;
 }
 .chart-card.c2::before{ background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
 .chart-card.c3::before{ background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }

 .chart-head{ display:flex; gap:12px; align-items:center; margin-bottom:10px; }
 .chart-head h4{ margin:0; font-size:14px; font-weight:900; color:#0b1220; }
 .sub{ margin:2px 0 0; font-size:12.5px; color:#5b6576; font-weight:650; }
 .chart-container{
   height: 240px;
   border-radius: 16px;
   overflow:hidden;
   background: linear-gradient(135deg, rgba(255,255,255,0.70), rgba(255,255,255,0.86));
   border: 1px solid rgba(20,22,30,0.06);
 }
+.chart-container canvas{
+  width:100% !important;
+  height:100% !important;
+  display:block;
+  pointer-events:auto;
+}

 /* ===== Bubbles ===== */
 .ico-bubble{
   width:42px; height:42px;
   border-radius: 16px;
   display:flex; align-items:center; justify-content:center;
   color:#fff;
   box-shadow: 0 15px 45px rgba(0,0,0,0.18);
   flex:0 0 auto;
 }
 .ico-bubble.gA{ background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
 .ico-bubble.gB{ background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
 .ico-bubble.gC{ background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
 .ico-bubble.gD{ background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
 .ico-bubble.gE{ background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }

 /* ===== Filters ===== */
 .filters{
   display:flex; align-items:center; gap:12px;
   flex-wrap:wrap;
   margin-bottom: 16px;
 }
 .filter-tabs, .status-filter{ display:flex; gap:8px; flex-wrap:wrap; }
 .action-buttons{ margin-left:auto; display:flex; gap:10px; }

