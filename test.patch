diff --git a/src/components/dich-vu/Phi-dich-vu.vue b/src/components/dich-vu/Phi-dich-vu.vue
index de459142842f40e805861c289d47a7ef704cbddf..20ec6ad655be5e91f6301ca23cbb87d27c792646 100644
--- a/src/components/dich-vu/Phi-dich-vu.vue
+++ b/src/components/dich-vu/Phi-dich-vu.vue
@@ -236,209 +236,277 @@
             <div class="mt-3 font-extrabold">Tab thống kê</div>
             <div class="mt-2 muted">Bạn yêu cầu để trống. Khi cần mình làm dashboard Chart.js sau.</div>
           </div>
         </div>
       </div>
     </div>

     <!-- TOAST -->
     <div class="toast-wrap">
       <div class="toast" :class="toast.type" v-if="showToast" @click="showToast = false">
         <div class="mt-0.5">
           <i :class="toast.icon"></i>
         </div>
         <div class="min-w-0">
           <div class="tt">{{ toast.title }}</div>
           <div class="tx">{{ toast.text }}</div>
         </div>
         <div class="x ml-auto">
           <i class="fa-solid fa-xmark"></i>
         </div>
       </div>
     </div>

     <!-- MODAL: CREATE CONTRACT -->
     <div class="modal" :class="{ show: showModal === 'modalContract' }" @click.self="closeModal('modalContract')">
-      <div class="modal-card detail">
+      <div class="modal-card detail contract-modal">
         <div class="modal-h">
           <div class="modal-title">
             <i class="fa-solid fa-file-circle-plus"></i>
             <span>Thêm hợp đồng (không cho sửa)</span>
           </div>
           <button class="x" @click="closeModal('modalContract')" title="Đóng">
             <i class="fa-solid fa-xmark"></i>
           </button>
         </div>

         <div class="modal-b">
           <div class="form-grid form-grid--contract">
             <div class="card">
               <div class="card-h">
-                <i class="fa-solid fa-user icon-tone tone-sky"></i>
+                <i class="fa-solid fa-file-lines icon-tone tone-sky"></i>
+                Thông tin hợp đồng
+              </div>
+
+              <div class="section-title">
+                <i class="fa-solid fa-user"></i>
                 Thông tin khách
               </div>

               <div class="field customer-search">
-                <label><i class="fa-solid fa-magnifying-glass icon-tone tone-lilac"></i> Tìm khách theo tên</label>
+                <label class="field-label">
+                  <span class="label-ico tone-lilac"><i class="fa-solid fa-magnifying-glass"></i></span>
+                  <span>Tìm khách theo tên</span>
+                </label>
                 <input v-model="customerSearch" type="text" placeholder="Nhập tên khách hàng để tìm...">

                 <div class="search-results" v-if="customerSearchResults.length">
                   <div v-for="customer in customerSearchResults" :key="customer.id" class="customer-result" @click="selectCustomer(customer)">
                     <div class="customer-avatar sm">{{ initials(customer.name) }}</div>
                     <div class="cr-main">
                       <div class="customer-name">{{ customer.name }}</div>
                       <div class="customer-phone"><i class="fa-solid fa-phone me-1"></i>{{ customer.phone }}</div>
                     </div>
                   </div>
                 </div>
                 <div v-else-if="customerSearchLoading" class="search-results empty">
                   <div class="customer-result muted">
                     <div class="cr-main">
                       <div class="customer-name">Đang tìm khách hàng...</div>
                       <div class="customer-phone">Vui lòng chờ</div>
                     </div>
                   </div>
                 </div>
                 <div v-else-if="customerSearchError && customerSearch.trim()" class="search-results empty">
                   <div class="customer-result muted">
                     <div class="cr-main">
                       <div class="customer-name">{{ customerSearchError }}</div>
                       <div class="customer-phone">Thử nhập tên khác.</div>
                     </div>
                   </div>
                 </div>

                 <div v-if="selectedCustomer" class="selected-customer">
                   <div class="customer-avatar">{{ initials(selectedCustomer.name) }}</div>
                   <div class="min-w-0">
                     <div class="customer-name">{{ selectedCustomer.name }}</div>
                     <div class="customer-phone"><i class="fa-solid fa-phone me-1"></i>{{ selectedCustomer.phone }}</div>
                   </div>
                   <button class="clear-btn" type="button" @click="clearSelectedCustomer">
                     <i class="fa-solid fa-xmark"></i>
                   </button>
                 </div>
               </div>

               <div class="grid grid-cols-1 md:grid-cols-2 gap-3 px-3 pb-2">
                 <div class="field !m-0">
-                  <label><i class="fa-solid fa-id-badge icon-tone tone-rose"></i> Mã khách hàng</label>
+                  <label class="field-label">
+                    <span class="label-ico tone-rose"><i class="fa-solid fa-id-badge"></i></span>
+                    <span>Mã khách hàng</span>
+                  </label>
                   <input :value="selectedCustomer?.id || ''" type="text" readonly>
                 </div>
                 <div class="field !m-0">
-                  <label><i class="fa-solid fa-phone icon-tone tone-emerald"></i> Số điện thoại</label>
+                  <label class="field-label">
+                    <span class="label-ico tone-emerald"><i class="fa-solid fa-phone"></i></span>
+                    <span>Số điện thoại</span>
+                  </label>
                   <input :value="selectedCustomer?.phone || ''" type="text" readonly>
                 </div>
               </div>

               <div class="field">
-                <label><i class="fa-solid fa-calendar-check icon-tone tone-amber"></i> Ngày ký</label>
+                <label class="field-label">
+                  <span class="label-ico tone-amber"><i class="fa-solid fa-calendar-check"></i></span>
+                  <span>Ngày ký</span>
+                </label>
                 <input v-model="newContract.ngayKy" type="date">
               </div>
-            </div>

-            <div class="card">
-              <div class="card-h">
-                <i class="fa-solid fa-circle-check icon-tone tone-mint"></i>
-                Thông tin dịch vụ & thanh toán ban đầu
+              <div class="section-title">
+                <i class="fa-solid fa-briefcase"></i>
+                Dịch vụ & giá trị
               </div>
+
               <div class="field">
-                <label><i class="fa-solid fa-list icon-tone tone-indigo"></i> Dịch vụ</label>
+                <label class="field-label">
+                  <span class="label-ico tone-indigo"><i class="fa-solid fa-list"></i></span>
+                  <span>Dịch vụ</span>
+                </label>
                 <select v-model="newContract.serviceId">
                   <option v-for="service in serviceOptions" :key="service.id || service.name" :value="service.id || service.name">
                     {{ service.name }}
                   </option>
                 </select>
                 <div class="muted tiny">Dịch vụ lấy từ hệ thống, giá gốc dựa theo phân khúc.</div>
               </div>

               <div class="grid grid-cols-1 md:grid-cols-2 gap-3 px-3 pb-2">
                 <div class="field !m-0">
-                  <label><i class="fa-solid fa-building icon-tone tone-teal"></i> Giá trị tài sản chấp nhận ký bán</label>
+                  <label class="field-label">
+                    <span class="label-ico tone-teal"><i class="fa-solid fa-building"></i></span>
+                    <span>Giá trị tài sản chấp nhận ký bán</span>
+                  </label>
                   <input v-model.number="newContract.giaTriTaiSan" type="number" min="0" placeholder="VD: 1500000000">
                   <div class="muted tiny">Nhập giá trị tài sản để xác định phân khúc.</div>
                 </div>

                 <div class="field !m-0">
-                  <label><i class="fa-solid fa-money-bill-wave icon-tone tone-orange"></i> Giá gốc</label>
+                  <label class="field-label">
+                    <span class="label-ico tone-orange"><i class="fa-solid fa-money-bill-wave"></i></span>
+                    <span>Giá gốc</span>
+                  </label>
                   <input :value="formatMoney(newContract.giaDichVuGoc)" type="text" readonly>
                 </div>
               </div>

               <div class="grid grid-cols-1 md:grid-cols-2 gap-3 px-3 pb-2">
                 <div class="field !m-0">
-                  <label><i class="fa-solid fa-tags icon-tone tone-pink"></i> Phí giảm (tiền)</label>
-                  <input v-model.number="newContract.phiGiam" type="number" placeholder="VD: 1000000" @input="updateGiaSauGiam">
+                  <label class="field-label">
+                    <span class="label-ico tone-pink"><i class="fa-solid fa-tags"></i></span>
+                    <span>Giảm giá</span>
+                  </label>
+                  <div class="discount-input">
+                    <div class="discount-toggle">
+                      <button type="button" :class="{ active: newContract.discountMode === 'MONEY' }" @click="setDiscountMode('MONEY')">
+                        <i class="fa-solid fa-money-bill-wave"></i>
+                        Tiền
+                      </button>
+                      <button type="button" :class="{ active: newContract.discountMode === 'PERCENT' }" @click="setDiscountMode('PERCENT')">
+                        <i class="fa-solid fa-percent"></i>
+                        %
+                      </button>
+                    </div>
+                    <div class="discount-value">
+                      <input
+                        v-model.number="newContract.discountValue"
+                        type="number"
+                        :min="newContract.discountMode === 'PERCENT' ? 0 : 1"
+                        :max="newContract.discountMode === 'PERCENT' ? 100 : (newContract.giaDichVuGoc || 0)"
+                        :placeholder="newContract.discountMode === 'PERCENT' ? 'VD: 10' : 'VD: 1000000'"
+                        @input="updateGiaSauGiam"
+                      >
+                      <span class="discount-suffix">{{ newContract.discountMode === 'PERCENT' ? '%' : '₫' }}</span>
+                    </div>
+                  </div>
+                  <div class="muted tiny">
+                    {{ newContract.discountMode === 'PERCENT'
+                      ? 'Giới hạn 0 - 100%.' : 'Giới hạn > 0 và không vượt quá giá gốc.' }}
+                  </div>
                 </div>

                 <div class="field !m-0">
-                  <label><i class="fa-solid fa-circle-dollar-to-slot icon-tone tone-purple"></i> Giá sau giảm</label>
+                  <label class="field-label">
+                    <span class="label-ico tone-purple"><i class="fa-solid fa-circle-dollar-to-slot"></i></span>
+                    <span>Giá sau giảm</span>
+                  </label>
                   <input :value="formatMoney(newContract.giaSauGiam)" type="text" readonly>
                 </div>
               </div>

               <div class="segment-hint" v-if="segmentHint">
                 <i class="fa-solid fa-circle-info"></i>
                 {{ segmentHint }}
               </div>

-              <!-- Plan -->
-              <div class="px-3 pb-2">
-                <div class="muted tiny font-semibold uppercase tracking-wide mb-2">Tuỳ chọn thanh toán ban đầu</div>
+              <div class="section-title">
+                <i class="fa-solid fa-wallet"></i>
+                Tuỳ chọn thanh toán ban đầu
+              </div>

+              <div class="px-3 pb-2">
                 <div class="plan" id="planWrap">
                   <div class="plan-item" :class="{ active: newContract.initPlan === 'COC' }" @click="newContract.initPlan = 'COC'; updateFirstPayment()">
                     <div class="plan-ico"><i class="fa-solid fa-hand-holding-dollar"></i></div>
                     <div class="min-w-0">
                       <div class="plan-tt">Cọc (%)</div>
                     </div>
                   </div>

                   <div class="plan-item" :class="{ active: newContract.initPlan === 'FULL' }" @click="newContract.initPlan = 'FULL'; updateFirstPayment()">
                     <div class="plan-ico"><i class="fa-solid fa-circle-check"></i></div>
                     <div class="min-w-0">
                       <div class="plan-tt">Đóng tất</div>
                     </div>
                   </div>
                 </div>

                 <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                   <div class="field !m-0">
-                    <label><i class="fa-solid fa-percent icon-tone tone-gold"></i> % cọc</label>
+                    <label class="field-label">
+                      <span class="label-ico tone-gold"><i class="fa-solid fa-percent"></i></span>
+                      <span>% cọc</span>
+                    </label>
                     <input v-model.number="newContract.tiLeCoc" type="number" min="0" max="100" placeholder="VD: 30"
                            :disabled="newContract.initPlan === 'FULL'" @input="updateFirstPayment">
                     <div class="muted tiny">Chỉ dùng khi chọn Cọc (%).</div>
                   </div>

                   <div class="field !m-0">
-                    <label><i class="fa-solid fa-money-check-dollar icon-tone tone-cyan"></i> Tiền thanh toán ban đầu</label>
+                    <label class="field-label">
+                      <span class="label-ico tone-cyan"><i class="fa-solid fa-money-check-dollar"></i></span>
+                      <span>Tiền thanh toán ban đầu</span>
+                    </label>
                     <input :value="formatMoney(firstPaymentAmount)" type="text" readonly>
                     <div class="muted tiny">Tự tính theo lựa chọn phía trên.</div>
                   </div>

                   <div class="field !m-0">
-                    <label><i class="fa-solid fa-credit-card icon-tone tone-forest"></i> Hình thức</label>
+                    <label class="field-label">
+                      <span class="label-ico tone-forest"><i class="fa-solid fa-credit-card"></i></span>
+                      <span>Hình thức</span>
+                    </label>
                     <select v-model="newContract.firstMethod">
                       <option value="CHUYEN_KHOAN">CHUYEN_KHOAN</option>
                       <option value="TIEN_MAT">TIEN_MAT</option>
                       <option value="QR">QR</option>
                       <option value="KHAC">KHAC</option>
                     </select>
                   </div>
                 </div>

                 <div class="note">
                   <b>Lưu ý:</b> Khi bấm <b>Lưu hợp đồng</b>, hệ thống sẽ tự tạo 1 dòng <b>Đóng phí</b> theo "Cọc/Đóng tất".
                 </div>
               </div>
             </div>
           </div>
         </div>

         <div class="modal-f">
           <button class="btn ghost" @click="closeModal('modalContract')">
             <i class="fa-solid fa-ban"></i> Hủy
           </button>
           <button class="btn primary" @click="saveContract">
             <i class="fa-solid fa-floppy-disk"></i> Lưu hợp đồng
           </button>
         </div>
@@ -927,50 +995,52 @@ export default {
       // Filters
       searchQuery: '',
       filterService: '',
       filterStatus: '',

       // Customer search
       customerSearch: '',
       selectedCustomer: null,
       customerSearchResults: [],
       customerSearchLoading: false,
       customerSearchError: '',
       customerSearchTimer: null,
       lastCustomerKeyword: '',
       suppressCustomerSearch: false,

       // New contract form
       newContract: {
         maHopDong: '',
         maKhachHang: '',
         tenKhachHang: '',
         tenDichVu: '',
         serviceId: null,
         giaTriTaiSan: null,
         giaDichVuGoc: 0,
         phiGiam: 0,
+        discountMode: 'PERCENT',
+        discountValue: 0,
         giaSauGiam: 0,
         trangThaiHopDong: 'DANG_HIEU_LUC',
         ngayKy: this.todayISO(),
         initPlan: 'COC',
         tiLeCoc: 30,
         firstMethod: 'CHUYEN_KHOAN'
       },

       // Modals
       showModal: null,
       currentContract: null,

       // Payment form
       payment: {
         amount: 0,
         method: 'CHUYEN_KHOAN',
         date: this.todayISO(),
         note: ''
       },

       // Refund form
       refund: {
         amount: 0,
         date: this.todayISO(),
         reason: ''
@@ -1077,50 +1147,54 @@ export default {
         this.newContract.tenKhachHang = ''
       }

       this.clearCustomerSearchTimer()

       const k = (val || '').trim()
       if (!k) {
         this.lastCustomerKeyword = ''
         this.customerSearchResults = []
         this.customerSearchError = ''
         this.customerSearchLoading = false
         return
       }

       this.customerSearchTimer = setTimeout(() => {
         this.fetchCustomerSearch(k)
       }, 250)
     },

     'newContract.serviceId'() {
       this.updateServicePrice()
     },

     'newContract.giaTriTaiSan'() {
       this.updateGiaGocFromAsset()
+    },
+
+    'newContract.discountMode'() {
+      this.updateGiaSauGiam()
     }
   },

   methods: {
     // Helper functions
     formatMoney(n) {
       const x = Math.round(Number(n || 0))
       const sign = x < 0 ? '-' : ''
       const abs = Math.abs(x)
       return sign + abs.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.') + ' ₫'
     },

     initials(name) {
       const parts = String(name || '')
           .trim()
           .split(/\s+/)
           .filter(Boolean)
       if (parts.length === 0) return 'NA'
       if (parts.length === 1) return parts[0].slice(0, 2).toUpperCase()
       return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase()
     },

     getStatusText(status) {
       switch(status) {
         case 'DANG_HIEU_LUC': return 'Đang hiệu lực'
@@ -1246,85 +1320,102 @@ export default {
     },

     // Modal control
     openModal(modal) {
       this.showModal = modal
     },

     closeModal(modal) {
       if (this.showModal === modal) {
         this.showModal = null
       }
     },

     // Contract management
     resetContractForm() {
       const firstService = this.serviceOptions[0] || null
       this.newContract = {
         maHopDong: this.genContractCode(),
         maKhachHang: '',
         tenKhachHang: '',
         tenDichVu: firstService?.name || '',
         serviceId: firstService?.id || firstService?.name || null,
         giaTriTaiSan: null,
         giaDichVuGoc: 0,
         phiGiam: 0,
+        discountMode: 'PERCENT',
+        discountValue: 0,
         giaSauGiam: 0,
         trangThaiHopDong: 'DANG_HIEU_LUC',
         ngayKy: this.todayISO(),
         initPlan: 'COC',
         tiLeCoc: 30,
         firstMethod: 'CHUYEN_KHOAN'
       }
       this.customerSearch = ''
       this.selectedCustomer = null
       this.customerSearchResults = []
       this.customerSearchError = ''
       this.customerSearchLoading = false
       this.updateServicePrice()
       this.showToastMessage('info', 'Tạo mới form', 'Đã reset form hợp đồng.')
     },

     updateServicePrice() {
       const service = this.getServiceById(this.newContract.serviceId)
       this.newContract.tenDichVu = service?.name || ''
       this.updateGiaGocFromAsset()
     },

     updateGiaGocFromAsset() {
       const assetValue = Number(this.newContract.giaTriTaiSan || 0)
       const segment = this.findSegmentForAsset(this.newContract.serviceId, assetValue)
       if (segment) {
         this.newContract.giaDichVuGoc = Number(segment.price || 0)
       } else {
         this.newContract.giaDichVuGoc = 0
       }
       this.updateGiaSauGiam()
     },

+    setDiscountMode(mode) {
+      this.newContract.discountMode = mode
+    },
+
     updateGiaSauGiam() {
-      this.newContract.giaSauGiam = Math.max(0, this.newContract.giaDichVuGoc - (this.newContract.phiGiam || 0))
+      const giaGoc = Number(this.newContract.giaDichVuGoc || 0)
+      if (this.newContract.discountMode === 'PERCENT') {
+        const percent = Math.max(0, Math.min(100, Number(this.newContract.discountValue || 0)))
+        this.newContract.discountValue = percent
+        this.newContract.phiGiam = Math.round(giaGoc * (percent / 100))
+      } else {
+        const money = Number(this.newContract.discountValue || 0)
+        const clamped = Math.max(0, Math.min(giaGoc, money))
+        this.newContract.discountValue = clamped
+        this.newContract.phiGiam = clamped
+      }
+      this.newContract.giaSauGiam = Math.max(0, giaGoc - (this.newContract.phiGiam || 0))
       this.updateFirstPayment()
     },

     updateFirstPayment() {
       // Handled by computed property
     },

     clearSelectedCustomer() {
       this.selectedCustomer = null
       this.customerSearch = ''
       this.customerSearchResults = []
       this.customerSearchError = ''
       this.customerSearchLoading = false
       this.newContract.maKhachHang = ''
       this.newContract.tenKhachHang = ''
     },

     async fetchCustomerSearch(keyword) {
       const k = (keyword || '').trim()
       if (!k) {
         this.customerSearchResults = []
         this.customerSearchError = ''
         return
       }

@@ -1353,91 +1444,99 @@ export default {
     },

     clearCustomerSearchTimer() {
       if (this.customerSearchTimer) clearTimeout(this.customerSearchTimer)
       this.customerSearchTimer = null
     },

     selectCustomer(customer) {
       this.suppressCustomerSearch = true
       this.clearCustomerSearchTimer()
       this.customerSearchLoading = false
       this.customerSearchError = ''
       this.customerSearchResults = []

       this.selectedCustomer = customer
       this.customerSearch = customer.name
       this.newContract.maKhachHang = customer.id
       this.newContract.tenKhachHang = customer.name

       setTimeout(() => {
         this.suppressCustomerSearch = false
       }, 0)
     },

     saveContract() {
+      this.updateGiaSauGiam()
       if (!this.selectedCustomer) {
         this.showToastMessage('error', 'Thiếu dữ liệu', 'Bạn cần chọn khách hàng từ danh sách.')
         return
       }

       if (!this.newContract.tenDichVu) {
         this.showToastMessage('error', 'Thiếu dữ liệu', 'Bạn cần chọn Dịch vụ.')
         return
       }

       if (!this.newContract.giaTriTaiSan) {
         this.showToastMessage('error', 'Thiếu dữ liệu', 'Bạn cần nhập giá trị tài sản.')
         return
       }

       if (!this.newContract.giaDichVuGoc) {
         this.showToastMessage('error', 'Thiếu dữ liệu', 'Giá gốc chưa xác định theo phân khúc.')
         return
       }

+      if (this.newContract.discountMode === 'MONEY' && this.newContract.discountValue <= 0) {
+        this.showToastMessage('error', 'Giảm giá không hợp lệ', 'Giảm giá tiền phải > 0 và không vượt quá giá gốc.')
+        return
+      }
+
       const contract = {
         id: crypto.randomUUID(),
         maHopDong: this.newContract.maHopDong,
         maKhachHang: this.newContract.maKhachHang,
         tenKhachHang: this.newContract.tenKhachHang,
         tenDichVu: this.newContract.tenDichVu,
         serviceId: this.newContract.serviceId,
         giaTriTaiSan: this.newContract.giaTriTaiSan,
         giaDichVuGoc: this.newContract.giaDichVuGoc,
         phiGiam: this.newContract.phiGiam || 0,
         giaSauGiam: this.newContract.giaSauGiam,
         trangThaiHopDong: this.newContract.trangThaiHopDong,
         ngayKy: this.newContract.ngayKy || this.todayISO(),
         ngayTao: new Date().toLocaleString('vi-VN'),
         dotDongTien: [],
         hoanTien: [],
         dieuChinh: [],
         initPlan: this.newContract.initPlan,
         tiLeCoc: this.newContract.initPlan === 'COC' ? (this.newContract.tiLeCoc || 0) : null
       }

+      console.log('New contract payload', contract)
+
       // Add initial payment
       if (this.firstPaymentAmount > 0) {
         contract.dotDongTien.push({
           id: crypto.randomUUID(),
           soTienDong: this.firstPaymentAmount,
           hinhThucThanhToan: this.newContract.firstMethod,
           ngayDongTien: contract.ngayKy,
           ghiChu: this.newContract.initPlan === 'FULL' ?
               'Thanh toán đủ (tạo khi lập HĐ)' :
               `Cọc ${this.newContract.tiLeCoc || 0}% (tạo khi lập HĐ)`,
           nguoiGhiNhan: 'demo_admin',
           ngayTao: new Date().toLocaleString('vi-VN')
         })
       }

       this.contracts.unshift(contract)
       this.showToastMessage('success', 'Đã tạo hợp đồng',
           `${contract.maHopDong} • ${this.newContract.initPlan === 'FULL' ? 'Đóng tất' : 'Cọc'}: ${this.formatMoney(this.firstPaymentAmount)}`)
       this.closeModal('modalContract')
     },

     // Payment management
     openPay(contract) {
       this.currentContract = contract
       this.payment = {
@@ -2454,64 +2553,134 @@ tbody tr:hover{ background: rgba(79,172,254,.08); }
 .card-h i{
   width:28px; height:28px;
   border-radius: 12px;
   display:grid; place-items:center;
   background: rgba(20,30,48,.07);
 }
 .card-h .icon-tone{
   color:#fff;
   box-shadow: 0 10px 18px rgba(15,23,42,.15);
 }
 .icon-tone.tone-sky{ background: linear-gradient(135deg, #38bdf8, #818cf8); }
 .icon-tone.tone-lilac{ background: linear-gradient(135deg, #a78bfa, #f472b6); }
 .icon-tone.tone-rose{ background: linear-gradient(135deg, #fb7185, #f97316); }
 .icon-tone.tone-emerald{ background: linear-gradient(135deg, #22c55e, #14b8a6); }
 .icon-tone.tone-amber{ background: linear-gradient(135deg, #f59e0b, #f97316); }
 .icon-tone.tone-mint{ background: linear-gradient(135deg, #34d399, #06b6d4); }
 .icon-tone.tone-indigo{ background: linear-gradient(135deg, #6366f1, #2563eb); }
 .icon-tone.tone-teal{ background: linear-gradient(135deg, #14b8a6, #0ea5e9); }
 .icon-tone.tone-orange{ background: linear-gradient(135deg, #f97316, #fb7185); }
 .icon-tone.tone-pink{ background: linear-gradient(135deg, #ec4899, #f472b6); }
 .icon-tone.tone-purple{ background: linear-gradient(135deg, #8b5cf6, #6366f1); }
 .icon-tone.tone-gold{ background: linear-gradient(135deg, #facc15, #f59e0b); }
 .icon-tone.tone-cyan{ background: linear-gradient(135deg, #22d3ee, #38bdf8); }
 .icon-tone.tone-forest{ background: linear-gradient(135deg, #16a34a, #059669); }

+.contract-modal{
+  width: min(920px, 100%);
+}
+.contract-modal .modal-h{
+  padding: 10px 12px;
+  background: linear-gradient(90deg, rgba(255,224,235,.55), rgba(224,238,255,.55), rgba(226,255,244,.55));
+}
+.contract-modal .modal-b{
+  padding: 10px;
+}
+.contract-modal .modal-f{
+  padding: 10px 12px;
+}
+.contract-modal .form-grid{
+  gap: 10px;
+  grid-template-columns: 1fr;
+}
+.contract-modal .card{
+  border-radius: 14px;
+}
+.contract-modal .card-h{
+  padding: 8px 12px;
+  font-size: 12px;
+}
+.contract-modal .card-h i{
+  background: transparent;
+  box-shadow: none;
+  color: var(--tone-color, #64748b);
+}
+.contract-modal .icon-tone{
+  color: var(--tone-color, #64748b);
+  background: transparent;
+  box-shadow: none;
+}
+.contract-modal .tone-sky{ --tone-color: #38bdf8; }
+.contract-modal .tone-lilac{ --tone-color: #a78bfa; }
+.contract-modal .tone-rose{ --tone-color: #fb7185; }
+.contract-modal .tone-emerald{ --tone-color: #22c55e; }
+.contract-modal .tone-amber{ --tone-color: #f59e0b; }
+.contract-modal .tone-mint{ --tone-color: #34d399; }
+.contract-modal .tone-indigo{ --tone-color: #6366f1; }
+.contract-modal .tone-teal{ --tone-color: #14b8a6; }
+.contract-modal .tone-orange{ --tone-color: #f97316; }
+.contract-modal .tone-pink{ --tone-color: #ec4899; }
+.contract-modal .tone-purple{ --tone-color: #8b5cf6; }
+.contract-modal .tone-gold{ --tone-color: #f59e0b; }
+.contract-modal .tone-cyan{ --tone-color: #22d3ee; }
+.contract-modal .tone-forest{ --tone-color: #16a34a; }
+
 .segment-hint{
-  margin: 4px 12px 12px;
-  padding: 8px 10px;
+  margin: 4px 12px 10px;
+  padding: 6px 10px;
   border-radius: 12px;
   background: rgba(79,172,254,.08);
   border: 1px dashed rgba(79,172,254,.35);
   font-size: 12px;
   color: rgba(11,18,32,.78);
   display:flex;
   gap:8px;
   align-items:center;
 }
 .segment-hint i{ color: #4facfe; }

+.section-title{
+  margin: 12px 12px 6px;
+  padding-top: 10px;
+  border-top: 1px dashed rgba(148,163,184,.5);
+  font-size: 12px;
+  font-weight: 800;
+  text-transform: uppercase;
+  letter-spacing: .5px;
+  color: rgba(11,18,32,.72);
+  display:flex;
+  align-items:center;
+  gap:8px;
+}
+.section-title i{
+  color: rgba(99,102,241,.8);
+}
+.section-title:first-of-type{
+  border-top: none;
+  padding-top: 0;
+}
+
 .customer-search{ position: relative; }
 .search-results{
   margin-top: 8px;
   border-radius: 12px;
   border: 1px solid rgba(20,30,48,.12);
   background: #fff;
   box-shadow: 0 14px 26px rgba(15,23,42,.08);
   max-height: 220px;
   overflow: auto;
 }
 .search-results.empty{ background: rgba(20,30,48,.02); }
 .customer-result{
   display:flex;
   gap:10px;
   align-items:center;
   padding: 8px 10px;
   cursor:pointer;
   transition: var(--t);
 }
 .customer-result:hover{ background: rgba(102,126,234,.08); }
 .customer-result .cr-main{ flex: 1; }
 .customer-avatar{
   width: 38px;
   height: 38px;
   border-radius: 12px;
@@ -2529,115 +2698,191 @@ tbody tr:hover{ background: rgba(79,172,254,.08); }
 .selected-customer{
   margin-top: 10px;
   padding: 10px 12px;
   border-radius: 12px;
   border: 1px dashed rgba(102,126,234,.35);
   background: rgba(102,126,234,.08);
   display:flex;
   gap:10px;
   align-items:center;
 }
 .clear-btn{
   margin-left: auto;
   width: 32px;
   height: 32px;
   border-radius: 10px;
   border: none;
   background: rgba(255,88,88,.12);
   color: #ff5858;
   display:grid;
   place-items:center;
   cursor:pointer;
   transition: var(--t);
 }
 .clear-btn:hover{ transform: translateY(-1px); background: rgba(255,88,88,.2); }
 .field{ display:grid; gap:6px; margin: 10px 12px; }
+.contract-modal .field{
+  margin: 8px 12px;
+  gap: 5px;
+}
+.field-label{
+  display:flex;
+  align-items:center;
+  gap:8px;
+  font-size: 12px;
+  font-weight: 800;
+  text-transform: uppercase;
+  letter-spacing: .4px;
+  color: rgba(11,18,32,.78);
+}
+.label-ico{
+  width: 20px;
+  height: 20px;
+  display:grid;
+  place-items:center;
+  border-radius: 8px;
+  color: var(--tone-color, #64748b);
+  background: rgba(15,23,42,.04);
+  font-size: 12px;
+}
+.contract-modal .label-ico{
+  background: transparent;
+  width: 18px;
+  height: 18px;
+  border-radius: 6px;
+}
 .field label{
   font-size: 14px;
   font-weight: 600;
   color: rgba(11,18,32,.82);
   display:flex; align-items:center; gap:8px;
 }
 .field input, .field select, .field textarea{
   border: 1px solid rgba(20,30,48,.14);
   border-radius: 12px;
   background: #fff;
   padding: 9px 10px;
   font-size: 14px;
   font-weight: 500;
   outline:none;
   transition: var(--t);
   color:#000;
   width: 100%;
   min-width: 0;
 }
 .field textarea{ min-height: 88px; resize: vertical; }
 .field input:focus, .field select:focus, .field textarea:focus{
   border-color: rgba(79,172,254,.55);
   box-shadow: 0 0 0 4px rgba(79,172,254,.14);
 }

 /* =========================
    RADIO PLAN (Cọc/Đóng tất)
 ========================= */
 .plan{
   display:grid;
   grid-template-columns: 1fr 1fr;
   gap: 10px;
-  margin: 10px 12px 12px 12px;
+  margin: 8px 12px 10px 12px;
 }
 @media (max-width: 640px){ .plan{ grid-template-columns: 1fr; } }
 .plan-item{
   border: 1px solid rgba(20,30,48,.14);
   border-radius: 14px;
-  padding: 10px 12px;
+  padding: 8px 10px;
   background: rgba(255,255,255,.86);
   display:flex;
   gap:10px;
   align-items:flex-start;
   cursor:pointer;
   transition: var(--t);
 }
 .plan-item:hover{ transform: translateY(-1px); border-color: rgba(102,126,234,.30); box-shadow: 0 14px 24px rgba(102,126,234,.12); }
 .plan-item.active{
   border-color: rgba(102,126,234,.44);
   background: rgba(102,126,234,.06);
   box-shadow: 0 14px 26px rgba(102,126,234,.14);
 }
 .plan-ico{
-  width: 36px; height: 36px;
-  border-radius: 14px;
+  width: 32px; height: 32px;
+  border-radius: 12px;
   display:grid; place-items:center;
   color:#fff;
   background: var(--primary-gradient);
   flex: 0 0 auto;
   box-shadow: 0 14px 24px rgba(102,126,234,.18);
 }
 .plan-item:nth-child(2) .plan-ico{ background: var(--success-gradient); box-shadow: 0 14px 24px rgba(67,233,123,.16); }
 .plan-tt{ font-weight: 950; }
 .plan-tx{ margin-top:2px; font-size: 12px; color: rgba(11,18,32,.64); font-weight: 650; }

+.discount-input{
+  display:grid;
+  gap:8px;
+}
+.discount-toggle{
+  display:flex;
+  gap:6px;
+  background: rgba(15,23,42,.04);
+  border-radius: 999px;
+  padding: 4px;
+  width: fit-content;
+}
+.discount-toggle button{
+  border: none;
+  background: transparent;
+  color: rgba(11,18,32,.7);
+  font-size: 12px;
+  font-weight: 700;
+  border-radius: 999px;
+  padding: 4px 10px;
+  display:flex;
+  align-items:center;
+  gap:6px;
+  cursor:pointer;
+  transition: var(--t);
+}
+.discount-toggle button.active{
+  background: rgba(102,126,234,.14);
+  color: #1d4ed8;
+}
+.discount-value{
+  position: relative;
+}
+.discount-value input{
+  padding-right: 34px;
+}
+.discount-suffix{
+  position: absolute;
+  right: 12px;
+  top: 50%;
+  transform: translateY(-50%);
+  font-size: 12px;
+  font-weight: 800;
+  color: rgba(11,18,32,.6);
+}
+
 /* =========================
    TOAST
 ========================= */
 .toast-wrap{
   position: fixed;
   top: 14px;
   right: 14px;
   z-index: 90;
   display:grid;
   gap:8px;
 }
 .toast{
   width: 340px;
   border-radius: 16px;
   padding: 10px 12px;
   display:flex;
   gap:10px;
   color:#fff;
   border: 1px solid rgba(255,255,255,.22);
   box-shadow: 0 18px 34px rgba(0,0,0,.22);
   animation: in .18s ease;
   overflow:hidden;
 }
 @keyframes in{ from{ opacity:0; transform: translateX(14px);} to{ opacity:1; transform: translateX(0);} }
 .toast.success{ background: var(--success-gradient); }
