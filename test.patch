diff --git a/src/components/thiet-kegiandien/AppointmentsPage.vue b/src/components/thiet-kegiandien/AppointmentsPage.vue
index f3796379999eb033deb8791de551d211d70fef74..397ee5b89934d485358200b558a21f5b682c6a91 100644
--- a/src/components/thiet-kegiandien/AppointmentsPage.vue
+++ b/src/components/thiet-kegiandien/AppointmentsPage.vue
@@ -236,62 +236,58 @@ const appointmentsError = ref('')
 let searchTimer = null

 // ===== Modals =====
 const editId = ref(null)
 const isModalOpen = ref(false)
 const isCreateModalOpen = ref(false)
 const isDetailModalOpen = ref(false)
 const selectedAppointment = ref(null)
 const detailCardRef = ref(null)
 const historyPanelRef = ref(null)

 // ===== Create form =====
 const createForm = reactive({
   customerSearch: '',
   selectedCustomer: null,
   branch: null,
   date: '',
   time: '',
   staff: '',
   consultant: 'Tư vấn 1',
   note: '',
   rating: 'BAN_NHANH_30N'
 })

 const editForm = reactive({
-  customer: '',
-  phone: '',
-  branch: 'CN_Q1',
+  branch: null,
   date: '',
   time: '',
-  staff: '',
-  consultant: '',
-  status: 'UP',
-  consultStatus: 'CARE',
-  customerType: 'OWNER',
+  consultantId: null,
+  status: 'WAITING',
   rating: 'BAN_NHANH_30N',
   note: '',
+  customerNote: '',
 })

 function makeHistory(actor, action, desc) {
   return { ts: nowISO(), actor, action, desc }
 }



 /**
  * Flags for marker rule:
  * - createdByMe => ORANGE marker
  * - inCharge => BLUE marker
  */
 const appointments = ref([])

 function getRowMarker(appt) {
   if (appt?.createdByMe) return { color: '#f97316', glow: 'rgba(253, 230, 138, 0.75)' } // ORANGE
   if (appt?.inCharge) return { color: '#2563eb', glow: 'rgba(191, 219, 254, 0.78)' } // BLUE
   return { color: '#667eea', glow: 'rgba(224, 231, 255, 0.7)' }
 }

 function monthTitle(d) {
   return `Tháng ${d.getMonth() + 1}, ${d.getFullYear()}`
 }

@@ -456,71 +452,74 @@ function mapAppointmentFromApi(dto) {
     id: dto.appointmentId,
     customerId: dto.customerId,
     customer: dto.customerName,
     phone: dto.customerPhone,
     date: dto.appointmentDate,
     time: dto.appointmentTime,
     staffId: dto.staffId,
     staff: dto.staffName,
     consultantId: dto.consultantId,
     consultant: dto.consultantName,
     creatorId: dto.creatorId,
     creator: dto.creatorName,
     status: dto.status,
     consultStatus: dto.consultStatus,
     rating: dto.rating,
     createdByMe: dto.createdByMe,
     inCharge: dto.inCharge,
     branch: dto.branch || '',
     customerType: dto.customerType || null,
     note: dto.note || '',
     history: dto.history || [],
   }
 }
 const detailLoading = ref(false)
 const detailError = ref('')
+const editLoading = ref(false)
+const editError = ref('')
 function mapAppointmentDetailFromApi(dto) {
   return {
     id: dto.appointmentId,

     customerId: dto.customer?.id,
     customer: dto.customer?.name,
     phone: dto.customer?.phone,
     address: dto.customer?.address,
     oldAddress: dto.customer?.oldAress,
     customerNote: dto.customer?.customerNote,
     customerType: dto.customer?.customerType,
     files: dto.customer?.files || [],

     date: dto.appointmentDate,
     time: dto.appointmentTime,
     status: dto.status,
     consultStatus: dto.consultStatus,
     rating: dto.rating,
     note: dto.note,
-    branch: dto.branch,
+    branch: dto.branchId ?? dto.branch?.id ?? dto.branch,

+    consultantId: dto.consultant?.id ?? dto.consultantId,
     consultant: dto.consultant?.name,
     creator: dto.creator?.name,

     history: (dto.histories || []).map(h => ({
       ts: h.createdAt,
       actor: h.actorName,
       action: h.action,
       desc: h.note,
       status: h.status,
       consultStatus: h.consultStatus,
     })),
   }
 }
 async function openDetailModal(appt) {
   isDetailModalOpen.value = true
   selectedAppointment.value = null
   detailLoading.value = true
   detailError.value = ''

   try {
     const res = await api.get(`/customer-crm/admin/lich-hen/${appt.id}`)
     const mapped = mapAppointmentDetailFromApi(res.data)
     selectedAppointment.value = mapped
     renderHistory(mapped)
     await nextTick()
@@ -876,139 +875,100 @@ function closeCreateModal() {
 // ===== History =====
 function renderHistory(appt) {
   const history = (appt.history || []).slice(0, 120)
   historyItems.value = history.map((h) => {
     const dt = new Date(h.ts)
     const stamp = `${pad2(dt.getHours())}:${pad2(dt.getMinutes())} • ${pad2(dt.getDate())}/${pad2(dt.getMonth() + 1)}/${dt.getFullYear()}`
     const actionInfo = getActionInfo(h.action)
     return { ...h, stamp, actionLabel: actionInfo.label, actionClass: actionInfo.cls }
   })
 }

 // ===== Detail modal =====
 function closeDetailModal() {
   isDetailModalOpen.value = false
   selectedAppointment.value = null
 }

 function syncHistoryPanelHeight() {
   if (!detailCardRef.value || !historyPanelRef.value) return
   const leftHeight = detailCardRef.value.offsetHeight
   if (!leftHeight) return
   historyPanelRef.value.style.height = `${leftHeight}px`
 }

 // ===== Edit modal =====
-function openEditModal(id) {
-  const appt = appointments.value.find((x) => x.id === id)
-  if (!appt) return
-
+async function openEditModal(id) {
   editId.value = id
-
-  editForm.customer = appt.customer || ''
-  editForm.phone = appt.phone || ''
-  editForm.branch = appt.branch || 'CN_Q1'
-  editForm.date = appt.date
-  editForm.time = appt.time
-  editForm.staff = appt.staff
-  editForm.consultant = appt.consultant
-  editForm.status = appt.status
-  editForm.consultStatus = appt.consultStatus || 'CARE'
-  editForm.customerType = appt.customerType || 'OWNER'
-  editForm.rating = appt.rating || 'BAN_NHANH_30N'
-  editForm.note = appt.note || ''
-
-  renderHistory(appt)
   isModalOpen.value = true
+  editLoading.value = true
+  editError.value = ''
+
+  try {
+    const res = await api.get(`/customer-crm/admin/lich-hen/${id}`)
+    const mapped = mapAppointmentDetailFromApi(res.data)
+
+    editForm.branch = mapped.branch || null
+    editForm.date = mapped.date || ''
+    editForm.time = mapped.time || ''
+    editForm.consultantId = mapped.consultantId || null
+    editForm.status = mapped.status || 'WAITING'
+    editForm.rating = mapped.rating || 'BAN_NHANH_30N'
+    editForm.note = mapped.note || ''
+    editForm.customerNote = mapped.customerNote || ''
+
+    renderHistory(mapped)
+    await fetchEditConsultantsByBranch(editForm.branch)
+  } catch (e) {
+    editError.value = 'Không thể tải chi tiết lịch hẹn'
+    showToast('Lỗi tải lịch hẹn', 'Không thể tải chi tiết lịch hẹn.', 'error')
+  } finally {
+    editLoading.value = false
+  }
 }
 function closeEditModal() {
   isModalOpen.value = false
   editId.value = null
+  editError.value = ''
+  editLoading.value = false
 }
 function saveEditModal() {
   if (editId.value == null) return
-  const idx = appointments.value.findIndex((x) => x.id === editId.value)
-  if (idx < 0) return
-
-  const current = appointments.value[idx]
-  const next = {
-    ...current,
-    customer: editForm.customer.trim() || current.customer,
-    phone: editForm.phone.trim(),
-    branch: editForm.branch,
-    date: editForm.date,
-    time: editForm.time,
-    staff: editForm.staff,
-    consultant: editForm.consultant,
+
+  const payload = {
+    appointmentId: editId.value,
+    branchId: editForm.branch,
+    appointmentDate: editForm.date,
+    appointmentTime: editForm.time,
+    consultantId: editForm.consultantId,
     status: editForm.status,
-    consultStatus: editForm.consultStatus,
-    customerType: editForm.customerType,
     rating: editForm.rating,
     note: editForm.note.trim(),
-    inCharge: editForm.staff === currentUser.name,
-  }
-
-  if (next.status !== 'CANCELLED') {
-    const conflict = hasConflict({ id: next.id, date: next.date, time: next.time, staff: next.staff })
-    if (conflict) {
-      showToast(
-          'Trùng lịch theo nhân viên',
-          `${next.staff} đã có lịch ${formatVNDate(conflict.date)} • ${conflict.time} với ${conflict.customer}.`,
-          'error',
-      )
-      return
-    }
+    customerNote: editForm.customerNote.trim(),
   }

-  const changes = []
-  if ((current.branch || '') !== (next.branch || '')) changes.push('Đổi chi nhánh.')
-  if (current.date !== next.date || current.time !== next.time) changes.push(`Dời lịch: ${formatVNDate(current.date)} • ${current.time} → ${formatVNDate(next.date)} • ${next.time}.`)
-  if (current.staff !== next.staff) changes.push(`Đổi NV phụ trách: ${current.staff} → ${next.staff}.`)
-  if (current.status !== next.status) changes.push(`Đổi tình trạng: ${STATUS[current.status].label} → ${STATUS[next.status].label}.`)
-  if ((current.consultStatus || '') !== (next.consultStatus || '')) changes.push(`Đổi KQ tư vấn: ${CONSULT_STATUS[current.consultStatus]?.label || '-'} → ${CONSULT_STATUS[next.consultStatus]?.label || '-'}.`)
-  if ((current.customerType || '') !== (next.customerType || '')) changes.push(`Đổi phân loại KH: ${CUSTOMER_TYPE[current.customerType]?.label || '-'} → ${CUSTOMER_TYPE[next.customerType]?.label || '-'}.`)
-  if ((current.rating || '') !== (next.rating || '')) changes.push(`Đổi đánh giá: ${RATING[current.rating]?.label || '-'} → ${RATING[next.rating]?.label || '-'}.`)
-  if ((current.note || '') !== (next.note || '')) changes.push('Cập nhật ghi chú.')
-  if ((current.customer || '') !== (next.customer || '') || (current.phone || '') !== (next.phone || '')) changes.push('Cập nhật thông tin khách.')
-
-  next.history = next.history || []
-  if (changes.length) next.history.unshift(makeHistory(currentUser.name, 'EDIT', changes.join(' ')))
-
-  appointments.value[idx] = next
-
-  // giữ selectedDate trong range (week/today)
-  selectedDateISO.value = next.date
-  if (activeRange.value === 'month') {
-    const d = new Date(`${next.date}T00:00:00`)
-    calendarMonth.value = new Date(d.getFullYear(), d.getMonth(), 1)
-  }
-
-  showToast('Đã lưu thay đổi', `${next.customer}: ${formatVNDate(next.date)} • ${next.time}`, 'success')
-  generateCalendar()
-  updateDaySchedule()
-  updateFilterOutputs()
-  updateGlobalStats()
+  console.log('Update appointment payload', payload)
   closeEditModal()
 }
 // ===== Lấy tất cả chi nhánh =========
 // ===== Branch options (API) =====
 const BRANCHES = ref([])
 const branchLoading = ref(false)

 async function fetchBranchOptions() {
   if (branchLoading.value) return

   branchLoading.value = true
   try {
     const res = await api.get('/customer-crm/admin/lich-hen/options')

     // BE trả: [{ id, address }]
     BRANCHES.value = (Array.isArray(res.data) ? res.data : []).map(b => ({
       key: Number(b.id),      // đảm bảo là number
       label: b.address,
     }))

     // ✅ AUTO SELECT CHI NHÁNH ĐẦU TIÊN
     if (!createForm.branch && BRANCHES.value.length > 0) {
       createForm.branch = BRANCHES.value[0].key
       createForm.staff = getStaffOptionsByBranch(createForm.branch)[0] || ''
     }
@@ -1039,50 +999,87 @@ async function fetchCreateConsultantsByBranch(branchId) {
   try {
     const res = await api.get('/customer-crm/admin/lich-hen/consultants', {
       params: { branchId },
     })

     CREATE_CONSULTANTS.value = Array.isArray(res.data) ? res.data : []

     // ✅ AUTO CHỌN NGƯỜI ĐẦU TIÊN
     createForm.consultant = CREATE_CONSULTANTS.value[0]?.id || null
   } catch (e) {
     CREATE_CONSULTANTS.value = []
     createForm.consultant = null
     showToast('Lỗi tải NV tư vấn', 'Không thể tải danh sách nhân viên tư vấn.', 'error')
   } finally {
     createConsultantsLoading.value = false
   }
 }
 watch(
     () => createForm.branch,
     async (branchId) => {
       if (!isCreateModalOpen.value) return
       await fetchCreateConsultantsByBranch(branchId)
     },
 )

+// ===== Consultants for EDIT modal =====
+const EDIT_CONSULTANTS = ref([])
+const editConsultantsLoading = ref(false)
+async function fetchEditConsultantsByBranch(branchId) {
+  if (!branchId) {
+    EDIT_CONSULTANTS.value = []
+    editForm.consultantId = null
+    return
+  }
+
+  editConsultantsLoading.value = true
+  try {
+    const res = await api.get('/customer-crm/admin/lich-hen/consultants', {
+      params: { branchId },
+    })
+
+    EDIT_CONSULTANTS.value = Array.isArray(res.data) ? res.data : []
+
+    if (!EDIT_CONSULTANTS.value.find((c) => c.id === editForm.consultantId)) {
+      editForm.consultantId = EDIT_CONSULTANTS.value[0]?.id || null
+    }
+  } catch (e) {
+    EDIT_CONSULTANTS.value = []
+    editForm.consultantId = null
+    showToast('Lỗi tải NV phụ trách', 'Không thể tải danh sách nhân viên.', 'error')
+  } finally {
+    editConsultantsLoading.value = false
+  }
+}
+watch(
+    () => editForm.branch,
+    async (branchId) => {
+      if (!isModalOpen.value) return
+      await fetchEditConsultantsByBranch(branchId)
+    },
+)
+

 function buildCreateAppointmentPayload() {
   return {
     customerId: createForm.selectedCustomer.id,
     consultantId: createForm.consultant,      // ID NV tư vấn
     branchId: createForm.branch,               // ID chi nhánh
     appointmentDate: createForm.date,          // yyyy-MM-dd
     appointmentTime: createForm.time,          // HH:mm
     note: createForm.note || '',
     rating: createForm.rating || 'BAN_NHANH_30N',
   }
 }
 async function createAppointmentApi() {
   const payload = buildCreateAppointmentPayload()

   return api.post(
       '/customer-crm/admin/lich-hen/create-lich-hen',
       payload
   )
 }

 import {showCenterWarning, updateAlertError, updateAlertSuccess, showLoading} from "../../assets/js/alertService.js";
 function isValidAppointmentTime(dateStr, timeStr) {
   // dateStr: yyyy-MM-dd
   // timeStr: HH:mm
@@ -2155,227 +2152,203 @@ onBeforeUnmount(() => {
           <button class="btn btn-secondary" type="button" @click="closeCreateModal">Huỷ</button>
           <button class="btn btn-primary" type="button" @click="saveNewAppointment">
             <i class="fa-solid fa-floppy-disk"></i>Tạo lịch hẹn
           </button>
         </div>
       </div>
     </div>

     <!-- Modal chỉnh sửa (FIX scrollbar + icon nhỏ chung label) -->
     <div v-if="isModalOpen" class="backdrop" @click.self="closeEditModal">
       <div class="editor-modal edit" role="dialog" aria-modal="true">
         <div class="modal-head">
           <div class="mh-left">
             <div class="mh-ico"><i class="fa-regular fa-pen-to-square"></i></div>
             <div>
               <h4>Chỉnh sửa lịch hẹn</h4>
               <p class="mh-sub">Có scroll riêng • icon nhỏ nền gradient</p>
             </div>
           </div>
           <button class="modal-close" type="button" @click="closeEditModal">
             <i class="fa-solid fa-xmark"></i>
           </button>
         </div>

         <div class="modal-body grid">
-          <div class="modal-card">
-            <div class="card-cap">
-              <i class="fa-solid fa-gear"></i>
-              <span>Nội dung chỉnh sửa</span>
-            </div>
-            <div class="form-grid">
-              <div class="form-group">
-                <label class="form-label">
-                  <span class="lbl">
-                    <span class="lbl-ico gi1"><i class="fa-solid fa-user"></i></span>
-                    Tên khách
-                  </span>
-                </label>
-                <input type="text" class="form-input" v-model="editForm.customer" />
-              </div>
-
-              <div class="form-group">
-                <label class="form-label">
-                  <span class="lbl">
-                    <span class="lbl-ico gi8"><i class="fa-solid fa-phone"></i></span>
-                    Số điện thoại
-                  </span>
-                </label>
-                <input type="text" class="form-input" v-model="editForm.phone" />
+          <div v-if="editLoading" class="detail-state">
+            <i class="fa-solid fa-circle-notch fa-spin"></i>
+            Đang tải chi tiết...
+          </div>
+          <div v-else-if="editError" class="detail-state error">
+            {{ editError }}
+          </div>
+          <template v-else>
+            <div class="modal-card">
+              <div class="card-cap">
+                <i class="fa-solid fa-gear"></i>
+                <span>Nội dung chỉnh sửa</span>
               </div>
-            </div>

-            <div class="form-grid">
-              <div class="form-group">
-                <label class="form-label">
-                  <span class="lbl">
-                    <span class="lbl-ico gi2"><i class="fa-solid fa-building"></i></span>
-                    Chi nhánh
-                  </span>
-                </label>
-                <select
-                    class="form-select"
-                    v-model="editForm.branch"
-                    @change="editForm.staff = (getStaffOptionsByBranch(editForm.branch)[0] || '')"
-                >
-                  <option v-for="b in BRANCHES" :key="b.key" :value="b.key">{{ b.label }}</option>
-                </select>
-              </div>
+              <div class="form-grid">
+                <div class="form-group">
+                  <label class="form-label">
+                    <span class="lbl">
+                      <span class="lbl-ico gi2"><i class="fa-solid fa-building"></i></span>
+                      Chi nhánh
+                    </span>
+                  </label>
+                  <select
+                      class="form-select"
+                      v-model="editForm.branch"
+                  >
+                    <option v-for="b in BRANCHES" :key="b.key" :value="b.key">{{ b.label }}</option>
+                  </select>
+                </div>

-              <div class="form-group">
-                <label class="form-label">
-                  <span class="lbl">
-                    <span class="lbl-ico gi5"><i class="fa-solid fa-user-tie"></i></span>
-                    NV phụ trách
-                  </span>
-                </label>
-                <select class="form-select" v-model="editForm.staff">
-                  <option v-for="staff in getStaffOptionsByBranch(editForm.branch)" :key="staff" :value="staff">{{ staff }}</option>
-                </select>
-              </div>
+                <div class="form-group">
+                  <label class="form-label">
+                    <span class="lbl">
+                      <span class="lbl-ico gi6"><i class="fa-solid fa-headset"></i></span>
+                      Nhân viên phụ trách
+                    </span>
+                  </label>
+                  <select class="form-select" v-model="editForm.consultantId">
+                    <option v-if="editConsultantsLoading" disabled>
+                      Đang tải nhân viên...
+                    </option>
+                    <option
+                        v-for="c in EDIT_CONSULTANTS"
+                        :key="c.id"
+                        :value="c.id"
+                    >
+                      {{ c.name }} <span v-if="c.phone">- {{ c.phone }}</span>
+                    </option>
+                  </select>
+                </div>

-              <div class="form-group">
-                <label class="form-label">
-                  <span class="lbl">
-                    <span class="lbl-ico gi3"><i class="fa-regular fa-calendar"></i></span>
-                    Ngày hẹn
-                  </span>
-                </label>
-                <input type="date" class="form-input" v-model="editForm.date" />
-              </div>
+                <div class="form-group">
+                  <label class="form-label">
+                    <span class="lbl">
+                      <span class="lbl-ico gi3"><i class="fa-regular fa-calendar"></i></span>
+                      Ngày hẹn
+                    </span>
+                  </label>
+                  <input type="date" class="form-input" v-model="editForm.date" />
+                </div>

-              <div class="form-group">
-                <label class="form-label">
-                  <span class="lbl">
-                    <span class="lbl-ico gi4"><i class="fa-regular fa-clock"></i></span>
-                    Giờ hẹn
-                  </span>
-                </label>
-                <select class="form-select" v-model="editForm.time">
-                  <option v-for="slot in TIME_SLOTS" :key="slot" :value="slot">{{ slot }}</option>
-                </select>
+                <div class="form-group">
+                  <label class="form-label">
+                    <span class="lbl">
+                      <span class="lbl-ico gi4"><i class="fa-regular fa-clock"></i></span>
+                      Giờ hẹn
+                    </span>
+                  </label>
+                  <input type="time" class="form-input" v-model="editForm.time" />
+                </div>
               </div>
-            </div>
-

-            <div class="form-grid">
-              <div class="form-group">
-                <label class="form-label">
-                  <span class="lbl">
-                    <span class="lbl-ico gi9"><i class="fa-solid fa-traffic-light"></i></span>
-                    Tình trạng
-                  </span>
-                </label>
-                <select class="form-select" v-model="editForm.status">
-                  <option value="UP">Đã lên</option>
-                  <option value="NOT_UP">Chưa lên</option>
-                  <option value="POSTPONED">Tạm hoãn</option>
-                  <option value="CANCELLED">Huỷ</option>
-                </select>
-              </div>
+              <div class="form-grid">
+                <div class="form-group">
+                  <label class="form-label">
+                    <span class="lbl">
+                      <span class="lbl-ico gi9"><i class="fa-solid fa-traffic-light"></i></span>
+                      Trạng thái
+                    </span>
+                  </label>
+                  <select class="form-select" v-model="editForm.status">
+                    <option value="WAITING">Chờ đến hẹn</option>
+                    <option value="UP">Đã lên</option>
+                    <option value="NOT_UP">Chưa lên</option>
+                    <option value="POSTPONED">Tạm hoãn</option>
+                    <option value="CANCELLED">Huỷ</option>
+                  </select>
+                </div>

-              <div class="form-group">
-                <label class="form-label">
-                  <span class="lbl">
-                    <span class="lbl-ico gi10"><i class="fa-solid fa-bullseye"></i></span>
-                    KQ tư vấn
-                  </span>
-                </label>
-                <select class="form-select" v-model="editForm.consultStatus">
-                  <option value="SUCCESS">Thành công</option>
-                  <option value="FAIL">Thất bại</option>
-                  <option value="CARE">Chăm sóc</option>
-                </select>
+                <div class="form-group">
+                  <label class="form-label">
+                    <span class="lbl">
+                      <span class="lbl-ico gi12"><i class="fa-solid fa-star"></i></span>
+                      Dịch vụ tư vấn
+                    </span>
+                  </label>
+                  <select class="form-select" v-model="editForm.rating">
+                    <option value="BAN_NHANH_30N">Bán nhanh 30 ngày</option>
+                    <option value="BAN_GP">Bán giải pháp</option>
+                  </select>
+                </div>
               </div>

               <div class="form-group">
                 <label class="form-label">
                   <span class="lbl">
-                    <span class="lbl-ico gi11"><i class="fa-solid fa-tag"></i></span>
-                    Phân loại
+                    <span class="lbl-ico gi7"><i class="fa-regular fa-note-sticky"></i></span>
+                    Ghi chú lịch hẹn
                   </span>
                 </label>
-                <select class="form-select" v-model="editForm.customerType">
-                  <option value="OWNER">Chính chủ</option>
-                  <option value="BROKER">Môi giới</option>
-                  <option value="RELATIVE">Người thân</option>
-                </select>
+                <textarea class="form-textarea" v-model="editForm.note" placeholder="Cập nhật ghi chú lịch hẹn..."></textarea>
               </div>

               <div class="form-group">
                 <label class="form-label">
                   <span class="lbl">
-                    <span class="lbl-ico gi12"><i class="fa-solid fa-star"></i></span>
-                    Đánh giá
+                    <span class="lbl-ico gi7"><i class="fa-regular fa-note-sticky"></i></span>
+                    Ghi chú khách hàng
                   </span>
                 </label>
-                <select class="form-select" v-model="editForm.rating">
-                  <option value="BAN_NHANH_30N">Bán nhanh 30 ngày</option>
-                  <option value="BAN_GP">Bán giải pháp</option>
-                </select>
+                <textarea class="form-textarea" v-model="editForm.customerNote" placeholder="Cập nhật ghi chú khách hàng..."></textarea>
               </div>
             </div>

-            <div class="form-group">
-              <label class="form-label">
-                <span class="lbl">
-                  <span class="lbl-ico gi7"><i class="fa-regular fa-note-sticky"></i></span>
-                  Ghi chú
-                </span>
-              </label>
-              <textarea class="form-textarea" v-model="editForm.note" placeholder="Cập nhật ghi chú..."></textarea>
-            </div>
-          </div>
+            <div class="modal-panel">
+              <h5>
+                <span class="sec-ico si4"><i class="fa-solid fa-clock-rotate-left"></i></span>
+                Lịch sử thay đổi
+              </h5>

-          <div class="modal-panel">
-            <h5>
-              <span class="sec-ico si4"><i class="fa-solid fa-clock-rotate-left"></i></span>
-              Lịch sử thay đổi
-            </h5>
-
-            <div class="history">
-              <div v-if="!historyItems.length" class="muted-empty">Chưa có lịch sử.</div>
-              <div v-else>
-                <div v-for="item in historyItems" :key="item.ts" class="h-item">
-                  <div class="h-top">
-                    <span>
-                      {{ item.actor }} •
-                      <span class="action-pill" :class="item.actionClass">{{ item.actionLabel }}</span>
-                    </span>
-                    <span>{{ item.stamp }}</span>
+              <div class="history">
+                <div v-if="!historyItems.length" class="muted-empty">Chưa có lịch sử.</div>
+                <div v-else>
+                  <div v-for="item in historyItems" :key="item.ts" class="h-item">
+                    <div class="h-top">
+                      <span>
+                        {{ item.actor }} •
+                        <span class="action-pill" :class="item.actionClass">{{ item.actionLabel }}</span>
+                      </span>
+                      <span>{{ item.stamp }}</span>
+                    </div>
+                    <div class="h-desc">{{ item.desc || '' }}</div>
                   </div>
-                  <div class="h-desc">{{ item.desc || '' }}</div>
                 </div>
               </div>
             </div>
-          </div>
+          </template>
         </div>

         <div class="modal-foot">
           <button class="btn btn-secondary" type="button" @click="closeEditModal">Đóng</button>
           <button class="btn btn-primary" type="button" @click="saveEditModal">
-            <i class="fa-solid fa-floppy-disk"></i>Lưu thay đổi
+            <i class="fa-solid fa-floppy-disk"></i>Cập nhật
           </button>
         </div>
       </div>
     </div>

     <!-- Modal chi tiết (màu mới đẹp hơn + icon nhỏ chung label) -->
     <div v-if="isDetailModalOpen" class="backdrop" @click.self="closeDetailModal">
       <div class="editor-modal detail" role="dialog" aria-modal="true">
         <div class="modal-head">
           <div class="mh-left">
             <div class="mh-ico"><i class="fa-regular fa-eye"></i></div>
             <div>
               <h4>Chi tiết lịch hẹn</h4>
               <p class="mh-sub">Màu sáng • card pastel • dễ đọc</p>
             </div>
           </div>
           <button class="modal-close" type="button" @click="closeDetailModal">
             <i class="fa-solid fa-xmark"></i>
           </button>
         </div>

         <div class="modal-body grid">
           <div v-if="detailLoading" class="detail-state">
             <i class="fa-solid fa-spinner fa-spin"></i>
             Đang tải dữ liệu...
