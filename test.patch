diff --git a/src/components/dich-vu/Phi-dich-vu.vue b/src/components/dich-vu/Phi-dich-vu.vue
index 5a9def4d616e09b1b122ac6269b1cf23fcf026e7..c065f28bc8a0656e9b59ec8ab87adcc5d8c84a10 100644
--- a/src/components/dich-vu/Phi-dich-vu.vue
+++ b/src/components/dich-vu/Phi-dich-vu.vue
@@ -378,50 +378,63 @@

                 <div v-if="selectedCustomer" class="selected-customer">
                   <div class="customer-avatar">{{ initials(selectedCustomer.name) }}</div>
                   <div class="min-w-0">
                     <div class="customer-name">{{ selectedCustomer.name }}</div>
                     <div class="customer-phone"><i class="fa-solid fa-phone me-1"></i>{{ selectedCustomer.phone }}</div>
                   </div>
                   <button class="clear-btn" type="button" @click="clearSelectedCustomer">
                     <i class="fa-solid fa-xmark"></i>
                   </button>
                 </div>
               </div>
                 <div class="field !m-0" style="max-height: 50px !important;">
                   <label class="field-label">
                     <span class="label-ico tone-emerald"><i class="fa-solid fa-phone"></i></span>
                     <span>S·ªë ƒëi·ªán tho·∫°i</span>
                   </label>
                   <input :value="selectedCustomer?.phone || ''" type="text" readonly>
                 </div>
               </div>
               <div class="section-title">
                 <i class="fa-solid fa-briefcase"></i>
                 D·ªãch v·ª• & gi√° tr·ªã
               </div>

+              <div v-if="canFullBranch" class="field">
+                <label class="field-label">
+                  <span class="label-ico tone-emerald"><i class="fa-solid fa-code-branch"></i></span>
+                  <span>Chi nh√°nh</span>
+                </label>
+                <select v-model="newContract.branchId" :disabled="branchLoading">
+                  <option v-for="branch in branchOptions" :key="branch.id" :value="branch.id">
+                    {{ branch.label }}
+                  </option>
+                </select>
+                <div class="muted tiny">Ch·ªçn chi nh√°nh √°p d·ª•ng cho h·ª£p ƒë·ªìng.</div>
+              </div>
+
               <div class="field">
                 <label class="field-label">
                   <span class="label-ico tone-indigo"><i class="fa-solid fa-list"></i></span>
                   <span>D·ªãch v·ª•</span>
                 </label>
                 <select v-model="newContract.serviceId">
                   <option v-for="service in serviceOptions" :key="service.id || service.name" :value="service.id || service.name">
                     {{ service.name }}
                   </option>
                 </select>
                 <div class="muted tiny">D·ªãch v·ª• l·∫•y t·ª´ h·ªá th·ªëng, gi√° g·ªëc d·ª±a theo ph√¢n kh√∫c.</div>
               </div>

               <div class="grid grid-cols-1 md:grid-cols-2 gap-3 px-3 pb-2">
                 <div class="field !m-0">
                   <label class="field-label">
                     <span class="label-ico tone-teal"><i class="fa-solid fa-building"></i></span>
                     <span>Gi√° tr·ªã t√†i s·∫£n ch·∫•p nh·∫≠n k√Ω b√°n</span>
                   </label>
                   <input
                     :value="formatNumberInput(newContract.giaTriTaiSan)"
                     type="text"
                     inputmode="numeric"
                     placeholder="VD: 1.500.000.000"
                     @input="newContract.giaTriTaiSan = parseNumberInput($event.target.value)"
@@ -1190,100 +1203,104 @@

 <script setup>
 import { ref, computed, watch, onMounted, onUnmounted } from 'vue'
 import api from '/src/api/api.js'
 import { useAuthStore } from '../../stores/authStore'
 import { useSidebarStore } from '../../stores/sidebarStore'
 import {
   confirmWithInput,
   showCenterWarning,
   showError,
   showLoading,
   updateAlertError,
   updateAlertSuccess
 } from '/src/assets/js/alertService.js'
 import ContractStatsDashboard from "../thiet-kegiandien/ContractStatsDashboard.vue";
 import {shortenName} from "../../assets/js/global.js";
 const authStore = useAuthStore()
 const sidebar = useSidebarStore()
 const info = computed(() => authStore.userInfo || {})
 const canPayContract = computed(() => authStore.hasPermission('HOPDONG_THU'))
 const canRefundContract = computed(() => authStore.hasPermission('HOPDONG_HOANPHI'))
 const canAdjustContract = computed(() => authStore.hasPermission('HOPDONG_DIEUCHINH'))
 const canDeleteContract = computed(() => authStore.hasPermission('HOPDONG_DELETE'))
 const canCancelContract = computed(() => authStore.hasPermission('HOPDONG_HUY'))
 const canContractSetting = computed(() => authStore.hasPermission('HOPDONG_SETTING'))
+const canFullBranch = computed(() => authStore.hasPermission('HOPDONG_FULL_CHINHANH'))
 const todayISO = () => {
   const d = new Date()
   const yyyy = d.getFullYear()
   const mm = String(d.getMonth() + 1).padStart(2, '0')
   const dd = String(d.getDate()).padStart(2, '0')
   return `${yyyy}-${mm}-${dd}`
 }
 // Constants
 const ENUM_STATUS = ['DANG_HIEU_LUC', 'HOAN_TAT', 'HUY']
 const ENUM_PAY = ['TIEN_MAT', 'CHUYEN_KHOAN', 'QR', 'KHAC']
 const ENUM_ADJ = ['GIAM_GIA', 'PHU_THU', 'PHAT', 'CHUYEN_DOI_DV']

 // State
 const activeTab = ref(1)
 const contracts = ref([])
 const totalElements = ref(0)
 const totalPages = ref(1)
 const seq = ref(1)
 const services = ref([])
 const segments = ref([])
+const branchOptions = ref([])
+const branchLoading = ref(false)

 // Filters
 const searchQuery = ref('')
 const filterService = ref(null)
 const filterStatus = ref(null)
 const tuNgay = ref(null)
 const denNgay = ref(null)
 const currentPage = ref(1)
 const pageSize = ref(10)
 const currentUserName = ref('Nguy·ªÖn Minh')
 const searchTimer = ref(null)

 // Customer search
 const customerSearch = ref('')
 const selectedCustomer = ref(null)
 const customerSearchResults = ref([])
 const customerSearchLoading = ref(false)
 const customerSearchError = ref('')
 const customerSearchTimer = ref(null)
 const lastCustomerKeyword = ref('')
 const suppressCustomerSearch = ref(false)
 const CONTRACT_DRAFT_KEY = 'contractDraftFromAppointment'

 // New contract form
 const newContract = ref({
   maHopDong: '',
   maKhachHang: '',
   tenKhachHang: '',
   tenDichVu: '',
   serviceId: null,
+  branchId: null,
   giaTriTaiSan: null,
   giaDichVuGoc: 0,
   phiGiam: 0,
   discountMode: 'PERCENT',
   discountValue: 0,
   giaSauGiam: 0,
   trangThaiHopDong: 'DANG_HIEU_LUC',
   ngayKy: todayISO(),
   initPlan: 'COC',
   tiLeCoc: 30,
   firstMethod: 'CHUYEN_KHOAN'
 })

 // Modals
 const showModal = ref(null)
 const currentContract = ref(null)
 const detailContract = ref(null)
 const openActionMenu = ref(null)
 const actionMenuPosition = ref({ top: 0, left: 0 })

 // Payment form
 const payment = ref({
   amount: 0,
   method: 'CHUYEN_KHOAN',
   date: todayISO(),
@@ -1460,50 +1477,65 @@ watch(customerSearch, (val) => {

 watch(() => newContract.value.serviceId, () => {
   updateServicePrice()
 })

 watch(() => newContract.value.giaTriTaiSan, () => {
   updateGiaGocFromAsset()
 })

 watch(() => newContract.value.discountMode, () => {
   updateGiaSauGiam()
 })

 watch(() => adjustment.value.serviceId, () => {
   updateAdjustmentServicePrice()
 })

 watch(() => adjustment.value.giaTriTaiSan, () => {
   updateAdjustmentGiaGocFromAsset()
 })

 watch(() => adjustment.value.discountMode, () => {
   updateAdjustmentGiaSauGiam()
 })

+watch(
+  canFullBranch,
+  (value) => {
+    if (value) {
+      fetchBranchOptions()
+      if (!newContract.value.branchId && branchOptions.value.length) {
+        newContract.value.branchId = branchOptions.value[0].id ?? null
+      }
+      return
+    }
+    newContract.value.branchId = null
+  },
+  { immediate: true }
+)
+
 watch(() => payment.value.amount, (val) => {
   if (!currentContract.value) return

   const maxAmount = calcConThieu(currentContract.value)

   // üîë Parse ‚Üí √âP S·ªê NGUY√äN
   let num = Math.floor(parseNumberInput(val))

   if (num > maxAmount) num = maxAmount
   if (num < 0) num = 0

   if (num !== payment.value.amount) {
     payment.value.amount = num
   }
 })

 watch(() => refund.value.amount, (val) => {
   if (!currentContract.value) return

   const maxAmount = getMaxRefundAmount(currentContract.value)
   let num = Math.floor(parseNumberInput(val))

   if (num > maxAmount) num = maxAmount
   if (num < 0) num = 0

@@ -1664,50 +1696,75 @@ const pad4 = (n) => {

 const fetchServices = async () => {
   try {
     const res = await api.get('/dich-vu-thg/admin', {
       params: {
         keyword: null
       }
     })
     services.value = res.data || []
   } catch (e) {
     console.error('‚ùå L·ªói fetch services', e)
     services.value = []
   }
 }

 const fetchSegments = async () => {
   try {
     const res = await api.get('/dich-vu-thg/admin/phan-khuc')
     segments.value = res.data || []
   } catch (e) {
     console.error('‚ùå L·ªói fetch segments', e)
     segments.value = []
   }
 }

+const fetchBranchOptions = async () => {
+  if (branchLoading.value) return
+  branchLoading.value = true
+  try {
+    const res = await api.get('/customer-crm/admin/lich-hen/options')
+    branchOptions.value = (Array.isArray(res.data) ? res.data : []).map((branch) => ({
+      id: Number(branch.id),
+      label: branch.address
+    }))
+    if (canFullBranch.value && branchOptions.value.length > 0) {
+      const hasMatch = branchOptions.value.some(
+        (branch) => String(branch.id) === String(newContract.value.branchId)
+      )
+      if (!hasMatch) {
+        newContract.value.branchId = branchOptions.value[0].id ?? null
+      }
+    }
+  } catch (e) {
+    console.error('‚ùå L·ªói fetch branches', e)
+    branchOptions.value = []
+  } finally {
+    branchLoading.value = false
+  }
+}
+
 const queueSearch = () => {
   if (searchTimer.value) clearTimeout(searchTimer.value)
   searchTimer.value = setTimeout(() => {
     fetchContracts()
   }, 300)
 }

 const fetchContracts = async () => {
   const payload = {
     keyword: searchQuery.value || null,
     serviceId: filterService.value || null,
     trangThaiHopDong: filterStatus.value || null,
     tuNgay: tuNgay.value || null,
     denNgay: denNgay.value || null,
     page: currentPage.value,
     size: pageSize.value
   }

   try {
     const res = await api.post('/hop-dong/admin/search', payload)
     const page = res?.data || {}
     const items = Array.isArray(page.content) ? page.content : []
     contracts.value = items
     totalElements.value = Number(page.page.totalElements ?? items.length)
     totalPages.value = Number(page.page.totalPages ?? Math.max(1, Math.ceil(totalElements.value / pageSize.value)))
@@ -1831,50 +1888,51 @@ const getMaxRefundAmount = (c) => {

 // Modal control
 const openModal = (modal) => {
   showModal.value = modal
 }

 const closeModal = (modal) => {
   resetContractForm()
   if (showModal.value === modal) {
     showModal.value = null
   }
   if (modal === 'modalDetail') {
     detailContract.value = null
   }
 }

 // Contract management
 const resetContractForm = () => {
   const firstService = serviceOptions.value[0] || null
   newContract.value = {
     maHopDong: genContractCode(),
     maKhachHang: '',
     tenKhachHang: '',
     tenDichVu: firstService?.name || '',
     serviceId: firstService?.id || firstService?.name || null,
+    branchId: canFullBranch.value ? branchOptions.value[0]?.id ?? null : null,
     giaTriTaiSan: null,
     giaDichVuGoc: 0,
     phiGiam: 0,
     discountMode: 'PERCENT',
     discountValue: 0,
     giaSauGiam: 0,
     trangThaiHopDong: 'DANG_HIEU_LUC',
     ngayKy: todayISO(),
     initPlan: 'COC',
     tiLeCoc: 30,
     firstMethod: 'CHUYEN_KHOAN'
   }
   customerSearch.value = ''
   selectedCustomer.value = null
   customerSearchResults.value = []
   customerSearchError.value = ''
   customerSearchLoading.value = false
   updateServicePrice()
 }

 const updateServicePrice = () => {
   const service = getServiceById(newContract.value.serviceId)
   newContract.value.tenDichVu = service?.name || ''
   updateGiaGocFromAsset()
 }
@@ -2051,50 +2109,51 @@ const saveContract = async () => {
   }

   if (!newContract.value.giaTriTaiSan) {
     showError('Thi·∫øu d·ªØ li·ªáu', 'B·∫°n c·∫ßn nh·∫≠p gi√° tr·ªã t√†i s·∫£n.')
     return
   }

   if (!newContract.value.giaDichVuGoc) {
     showError('Thi·∫øu d·ªØ li·ªáu', 'Gi√° g·ªëc ch∆∞a x√°c ƒë·ªãnh theo ph√¢n kh√∫c.')
     return
   }

   if (newContract.value.discountMode === 'MONEY' && newContract.value.discountValue <= 0) {
     showError('Gi·∫£m gi√° kh√¥ng h·ª£p l·ªá', 'Gi·∫£m gi√° ti·ªÅn ph·∫£i > 0 v√† kh√¥ng v∆∞·ª£t qu√° gi√° g·ªëc.')
     return
   }

   const payload = {
     maKhachHang: newContract.value.maKhachHang,
     giaTriKyBan: newContract.value.giaTriTaiSan,
     giaDichVuGoc: newContract.value.giaDichVuGoc,
     phiGiam: newContract.value.phiGiam || 0,
     giaSauGiam: newContract.value.giaSauGiam,
     hinhThucThanhToan: newContract.value.firstMethod,
     serviceId: newContract.value.serviceId,
+    branchId: canFullBranch.value ? newContract.value.branchId : null,
     soTienThanhToan: firstPaymentAmount.value,
     initPlan: newContract.value.initPlan
   }

   try {
     const res = await showLoading(api.post('/hop-dong/admin/create', payload))
     const created = res?.data || {}
     const hasPayments = Array.isArray(created.dotDongTien) && created.dotDongTien.length > 0
     const contract = {
       id: created.id || crypto.randomUUID(),
       maHopDong: created.maHopDong || newContract.value.maHopDong,
       maKhachHang: created.maKhachHang ?? newContract.value.maKhachHang,
       tenKhachHang: created.tenKhachHang || newContract.value.tenKhachHang,
       nhanVienTao: created.nhanVienTao || currentUserName.value,
       tenDichVu: created.tenDichVu || newContract.value.tenDichVu,
       serviceId: created.serviceId ?? newContract.value.serviceId,
       giaTriTaiSan: created.giaTriKyBan ?? created.giaTriTaiSan ?? newContract.value.giaTriTaiSan,
       giaDichVuGoc: created.giaDichVuGoc ?? newContract.value.giaDichVuGoc,
       phiGiam: created.phiGiam ?? newContract.value.phiGiam ?? 0,
       giaSauGiam: created.giaSauGiam ?? newContract.value.giaSauGiam,
       trangThaiHopDong: created.trangThaiHopDong ?? newContract.value.trangThaiHopDong,
       ngayKy: created.ngayKy ?? newContract.value.ngayKy ?? todayISO(),
       ngayTao: created.ngayTao ?? new Date().toLocaleString('vi-VN'),
       dotDongTien: hasPayments ? created.dotDongTien : [],
       hoanTien: created.hoanTien || [],
