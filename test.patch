diff --git a/src/components/productAdmin/ProductUpdate.vue b/src/components/productAdmin/ProductUpdate.vue
index 880795038d13f299be8531b0d7bf5a8fe45d5039..babd718c42877e71bd8634b2372d0c3f0699a9e1 100644
--- a/src/components/productAdmin/ProductUpdate.vue
+++ b/src/components/productAdmin/ProductUpdate.vue
@@ -240,147 +240,124 @@
                     <i class="fa-solid fa-percent text-white text-xs"></i>
                   </div>
                   <span>Ph√≠ m√¥i gi·ªõi (%) *</span>
                 </span>
               </label>
               <div class="relative">
                 <input
                     type="number"
                     v-model.number="formData.phiMoiGioi"
                     step="0.1"
                     min="0"
                     max="100"
                     class="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-rose-500 focus:border-transparent bg-white shadow-sm transition-all text-sm hover:border-slate-400"
                     placeholder="Nh·∫≠p % ph√≠ m√¥i gi·ªõi"
                     required
                 />
                 <i class="fa-solid fa-percent absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
               </div>
               <div class="text-sm font-medium text-rose-700 bg-rose-50 p-2 rounded-lg">
                 {{ formData.phiMoiGioi }}%
               </div>
             </div>
           </div>
         </div>
 
-        <!-- SECTION 2: ƒê·ªäA CH·ªà & KHU V·ª∞C -->
+        <!-- SECTION 2: ƒê·ªäA CH·ªà -->
         <div class="bg-white rounded-2xl shadow-xl border border-slate-300 p-6">
           <div class="flex items-center gap-3 mb-6 pb-4 border-b border-slate-200">
             <div class="bg-gradient-to-r from-emerald-500 to-green-600 p-2.5 rounded-xl">
               <i class="fa-solid fa-location-dot text-white text-lg"></i>
             </div>
-            <h2 class="text-xl font-bold text-slate-900">ƒê·ªãa ch·ªâ & Khu v·ª±c</h2>
+            <h2 class="text-xl font-bold text-slate-900">ƒê·ªãa ch·ªâ</h2>
           </div>
 
           <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
-            <!-- T·ªânh/Th√†nh ph·ªë -->
-            <div class="space-y-2">
+            <!-- ƒê·ªãa ch·ªâ ƒë∆∞·ªùng -->
+            <div class="space-y-2 md:col-span-2 lg:col-span-1">
               <label class="block text-sm font-semibold text-slate-800">
                 <span class="flex items-center gap-2">
-                  <div class="w-6 h-6 rounded-lg bg-gradient-to-r from-blue-500 to-indigo-500 flex items-center justify-center">
-                    <i class="fa-solid fa-city text-white text-xs"></i>
+                  <div class="w-6 h-6 rounded-lg bg-gradient-to-r from-purple-500 to-violet-500 flex items-center justify-center">
+                    <i class="fa-solid fa-road text-white text-xs"></i>
                   </div>
-                  <span>T·ªânh/Th√†nh ph·ªë *</span>
+                  <span>ƒê·ªãa ch·ªâ ƒë∆∞·ªùng *</span>
                 </span>
               </label>
-              <select
-                  v-model="selectedProvince"
-                  @change="onProvinceChange"
-                  class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white shadow-sm transition-all text-sm hover:border-slate-400"
-                  required
-              >
-                <option value="">-- Ch·ªçn t·ªânh/th√†nh ph·ªë --</option>
-                <option v-for="province in provinces" :key="province.name" :value="province.name">
-                  {{ formatProvinceName(province.name) }}
-                </option>
-              </select>
+              <div class="relative">
+                <input
+                    type="text"
+                    v-model="formAddress.street"
+                    class="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white shadow-sm transition-all text-sm hover:border-slate-400"
+                    placeholder="V√≠ d·ª•: 23 ƒê∆∞·ªùng Pasteur"
+                    required
+                />
+                <i class="fa-solid fa-location-dot absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
+              </div>
             </div>
 
             <!-- Ph∆∞·ªùng/X√£ -->
             <div class="space-y-2">
               <label class="block text-sm font-semibold text-slate-800">
                 <span class="flex items-center gap-2">
                   <div class="w-6 h-6 rounded-lg bg-gradient-to-r from-emerald-500 to-green-500 flex items-center justify-center">
                     <i class="fa-solid fa-map-marker-alt text-white text-xs"></i>
                   </div>
                   <span>Ph∆∞·ªùng/X√£ *</span>
                 </span>
               </label>
               <select
                   v-model="formAddress.ward"
-                  :disabled="!selectedProvince"
-                  class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white shadow-sm transition-all text-sm hover:border-slate-400 disabled:bg-slate-100 disabled:cursor-not-allowed"
+                  class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white shadow-sm transition-all text-sm hover:border-slate-400"
                   required
               >
                 <option value="">-- Ch·ªçn ph∆∞·ªùng/x√£ --</option>
-                <option v-for="ward in wards" :key="ward.name" :value="ward.name">
-                  {{ formatWardName(ward.name) }}
+                <option v-for="ward in wardOptions" :key="ward.code" :value="ward.name">
+                  {{ ward.name }}
                 </option>
               </select>
-              <div v-if="!selectedProvince" class="text-xs text-slate-500 italic">
-                Vui l√≤ng ch·ªçn t·ªânh/th√†nh ph·ªë tr∆∞·ªõc
-              </div>
             </div>
 
-            <!-- ƒê·ªãa ch·ªâ ƒë∆∞·ªùng -->
-            <div class="space-y-2 md:col-span-2 lg:col-span-1">
-              <label class="block text-sm font-semibold text-slate-800">
-                <span class="flex items-center gap-2">
-                  <div class="w-6 h-6 rounded-lg bg-gradient-to-r from-purple-500 to-violet-500 flex items-center justify-center">
-                    <i class="fa-solid fa-road text-white text-xs"></i>
-                  </div>
-                  <span>ƒê·ªãa ch·ªâ ƒë∆∞·ªùng *</span>
-                </span>
-              </label>
-              <div class="relative">
-                <input
-                    type="text"
-                    v-model="formAddress.street"
-                    class="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white shadow-sm transition-all text-sm hover:border-slate-400"
-                    placeholder="V√≠ d·ª•: 23 ƒê∆∞·ªùng Pasteur"
-                    required
-                />
-                <i class="fa-solid fa-location-dot absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
-              </div>
-            </div>
-
-            <!-- Khu v·ª±c m√£ -->
+            <!-- T·ªânh/Th√†nh ph·ªë -->
             <div class="space-y-2">
               <label class="block text-sm font-semibold text-slate-800">
                 <span class="flex items-center gap-2">
-                  <div class="w-6 h-6 rounded-lg bg-gradient-to-r from-amber-500 to-orange-500 flex items-center justify-center">
-                    <i class="fa-solid fa-map-pin text-white text-xs"></i>
+                  <div class="w-6 h-6 rounded-lg bg-gradient-to-r from-blue-500 to-indigo-500 flex items-center justify-center">
+                    <i class="fa-solid fa-city text-white text-xs"></i>
                   </div>
-                  <span>Khu v·ª±c</span>
+                  <span>T·ªânh/Th√†nh ph·ªë *</span>
                 </span>
               </label>
-              <input
-                  type="text"
-                  v-model="formData.khuVucMa"
-                  class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent bg-white shadow-sm transition-all text-sm hover:border-slate-400"
-                  placeholder="V√≠ d·ª•: TP. Th·ªß ƒê·ª©c"
-              />
+              <select
+                  v-model="formAddress.province"
+                  class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white shadow-sm transition-all text-sm hover:border-slate-400"
+                  required
+              >
+                <option value="">-- Ch·ªçn t·ªânh/th√†nh --</option>
+                <option v-for="province in provinceOptions" :key="province.code" :value="province.name">
+                  {{ province.name }}
+                </option>
+              </select>
             </div>
 
             <!-- V·ªã tr√≠ -->
             <div class="space-y-2">
               <label class="block text-sm font-semibold text-slate-800">
                 <span class="flex items-center gap-2">
                   <div class="w-6 h-6 rounded-lg bg-gradient-to-r from-rose-500 to-pink-500 flex items-center justify-center">
                     <i class="fa-solid fa-location-arrow text-white text-xs"></i>
                   </div>
                   <span>V·ªã tr√≠ *</span>
                 </span>
               </label>
               <select
                   v-model="formData.landPosition"
                   class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-rose-500 focus:border-transparent bg-white shadow-sm transition-all text-sm hover:border-slate-400"
                   required
               >
                 <option value="">-- Ch·ªçn v·ªã tr√≠ --</option>
                 <option value="M·∫∑t ti·ªÅn">M·∫∑t ti·ªÅn</option>
                 <option value="H·∫ªm">H·∫ªm</option>
                 <option value="H·∫ªm c·ª•t">H·∫ªm c·ª•t</option>
                 <option value="Khu d√¢n c∆∞">Khu d√¢n c∆∞</option>
                 <option value="M·∫∑t ti·ªÅn ƒë∆∞·ªùng l·ªõn">M·∫∑t ti·ªÅn ƒë∆∞·ªùng l·ªõn</option>
                 <option value="Ch∆∞a c·∫≠p nh·∫≠t">Ch∆∞a c·∫≠p nh·∫≠t</option>
               </select>
@@ -1088,317 +1065,467 @@
                 />
                 <i class="fa-solid fa-ruler-combined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
               </div>
             </div>
 
             <!-- Quy ho·∫°ch -->
             <div class="space-y-2">
               <label class="block text-sm font-semibold text-slate-800">
                 <span class="flex items-center gap-2">
                   <div class="w-6 h-6 rounded-lg bg-gradient-to-r from-blue-500 to-indigo-500 flex items-center justify-center">
                     <i class="fa-solid fa-map text-white text-xs"></i>
                   </div>
                   <span>Quy ho·∫°ch</span>
                 </span>
               </label>
               <input
                   type="text"
                   v-model="formData.quyHoach"
                   class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white shadow-sm transition-all text-sm hover:border-slate-400"
                   placeholder="V√≠ d·ª•: ƒê·∫•t ·ªü ƒë√¥ th·ªã"
               />
             </div>
           </div>
         </div>
 
+        <!-- SECTION: CHI TI·∫æT PH√íNG -->
+        <div class="bg-white rounded-2xl shadow-xl border border-slate-300 p-6">
+          <div class="flex items-center gap-3 mb-6 pb-4 border-b border-slate-200">
+            <div class="bg-gradient-to-r from-teal-500 to-emerald-500 p-2.5 rounded-xl">
+              <i class="fa-solid fa-bed text-white text-lg"></i>
+            </div>
+            <div>
+              <h2 class="text-xl font-bold text-slate-900">Chi ti·∫øt ph√≤ng</h2>
+              <p class="text-sm text-slate-600">C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng, di·ªán t√≠ch v√† m√¥ t·∫£ cho t·ª´ng lo·∫°i ph√≤ng.</p>
+            </div>
+          </div>
+
+          <div class="overflow-x-auto">
+            <table class="min-w-full text-sm text-left border border-slate-200 rounded-lg overflow-hidden">
+              <thead class="bg-slate-100 text-slate-700">
+              <tr>
+                <th class="px-4 py-3 font-semibold">Lo·∫°i ph√≤ng</th>
+                <th class="px-4 py-3 font-semibold w-32">S·ªë l∆∞·ª£ng</th>
+                <th class="px-4 py-3 font-semibold w-40">Di·ªán t√≠ch (m¬≤)</th>
+                <th class="px-4 py-3 font-semibold">M√¥ t·∫£</th>
+                <th class="px-4 py-3 font-semibold w-20 text-center">X√≥a</th>
+              </tr>
+              </thead>
+              <tbody>
+              <tr v-for="(room, index) in formData.rooms" :key="room.id || index" class="border-t border-slate-200">
+                <td class="px-4 py-3">
+                  <input
+                      v-model="room.loaiPhong"
+                      type="text"
+                      class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
+                      placeholder="Ph√≤ng ng·ªß, Ph√≤ng kh√°ch..."
+                  />
+                </td>
+                <td class="px-4 py-3">
+                  <input
+                      v-model.number="room.soLuong"
+                      type="number"
+                      min="0"
+                      class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
+                  />
+                </td>
+                <td class="px-4 py-3">
+                  <input
+                      v-model.number="room.dienTich"
+                      type="number"
+                      step="0.1"
+                      min="0"
+                      class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
+                  />
+                </td>
+                <td class="px-4 py-3">
+                  <input
+                      v-model="room.moTa"
+                      type="text"
+                      class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
+                      placeholder="Ghi ch√∫ th√™m..."
+                  />
+                </td>
+                <td class="px-4 py-3 text-center">
+                  <button type="button" class="text-rose-600 hover:text-rose-700" @click="removeRoom(index)">
+                    <i class="fa-solid fa-trash"></i>
+                  </button>
+                </td>
+              </tr>
+              <tr v-if="!formData.rooms.length">
+                <td colspan="5" class="px-4 py-4 text-center text-slate-500">Ch∆∞a c√≥ th√¥ng tin ph√≤ng</td>
+              </tr>
+              </tbody>
+            </table>
+          </div>
+
+          <div class="mt-4 flex items-center justify-between">
+            <div class="text-sm text-slate-600">Th√™m m·ªõi ho·∫∑c ch·ªânh s·ª≠a chi ti·∫øt ph√≤ng ƒë·ªÉ m√¥ t·∫£ ƒë·∫ßy ƒë·ªß t√†i s·∫£n.</div>
+            <button
+                type="button"
+                class="px-4 py-2 bg-gradient-to-r from-teal-500 to-emerald-500 text-white rounded-xl font-semibold shadow hover:from-teal-600 hover:to-emerald-600"
+                @click="addRoom"
+            >
+              <i class="fa-solid fa-plus mr-2"></i>Th√™m ph√≤ng
+            </button>
+          </div>
+        </div>
+
+        <!-- SECTION: H√åNH ·∫¢NH & T·ªÜP ƒê√çNH K√àM -->
+        <div class="bg-white rounded-2xl shadow-xl border border-slate-300 p-6">
+          <div class="flex items-center gap-3 mb-6 pb-4 border-b border-slate-200">
+            <div class="bg-gradient-to-r from-indigo-500 to-blue-500 p-2.5 rounded-xl">
+              <i class="fa-solid fa-images text-white text-lg"></i>
+            </div>
+            <div>
+              <h2 class="text-xl font-bold text-slate-900">H√¨nh ·∫£nh & t√†i li·ªáu</h2>
+              <p class="text-sm text-slate-600">Qu·∫£n l√Ω ·∫£nh, s·ªï v√† file ƒë√≠nh k√®m c·ªßa t√†i s·∫£n.</p>
+            </div>
+          </div>
+
+          <FileOrLand
+              entity-type="land"
+              :entity-id="asset.id"
+              :file-list="formData.files || []"
+              :canEdit="true"
+              @update:files="handleFilesUpdate"
+          />
+        </div>
+
         <!-- ACTION BUTTONS -->
         <div class="flex flex-col sm:flex-row items-center justify-between gap-4 pt-6 pb-10">
           <button
               type="button"
               @click="$router.back()"
               class="w-full sm:w-auto px-8 py-3.5 bg-gradient-to-r from-slate-500 to-gray-600 text-white rounded-xl font-semibold hover:from-slate-600 hover:to-gray-700 transition-all duration-200 shadow-sm hover:shadow-md flex items-center justify-center gap-2"
           >
             <i class="fa-solid fa-times"></i>
             <span>H·ªßy</span>
           </button>
 
           <div class="flex flex-col sm:flex-row items-center gap-4 w-full sm:w-auto">
             <button
                 type="button"
                 @click="resetForm"
                 class="w-full sm:w-auto px-8 py-3.5 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-xl font-semibold hover:from-amber-600 hover:to-orange-700 transition-all duration-200 shadow-sm hover:shadow-md flex items-center justify-center gap-2"
             >
               <i class="fa-solid fa-rotate-left"></i>
               <span>ƒê·∫∑t l·∫°i</span>
             </button>
 
             <button
                 type="submit"
                 :disabled="isSaving"
                 class="w-full sm:w-auto px-10 py-3.5 bg-gradient-to-r from-emerald-500 to-green-600 text-white rounded-xl font-semibold hover:from-emerald-600 hover:to-green-700 transition-all duration-200 shadow-sm hover:shadow-md flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed"
             >
               <i class="fa-solid fa-save"></i>
               <span>{{ isSaving ? 'ƒêang l∆∞u...' : 'L∆∞u thay ƒë·ªïi' }}</span>
             </button>
           </div>
         </div>
       </form>
     </div>
   </div>
 </template>
 
 <script setup>
-import { ref, computed, onMounted } from "vue";
+import { ref, computed, onMounted, watch } from "vue";
 import { useRoute, useRouter } from "vue-router";
 import api from "/src/api/api.js";
+import FileOrLand from "../land/FileOrLand.vue";
 import addressData from "/src/assets/js/address.json";
 
 const route = useRoute();
 const router = useRouter();
 const id = route.params.id;
 
 const asset = ref(null);
 const formData = ref({});
+const originalFiles = ref([]);
 const formAddress = ref({
   street: "",
   ward: "",
-  area: ""
+  province: ""
 });
-const selectedProvince = ref(null);
-const wards = ref([]);
-const provinces = ref([]);
 const isSaving = ref(false);
+const provinces = addressData || [];
+
+const provinceOptions = computed(() => provinces);
+const selectedProvince = computed(() => findProvinceByName(formAddress.value.province));
+const wardOptions = computed(() => selectedProvince.value?.wards || []);
+
+watch(() => formAddress.value.province, (newProvince) => {
+  const province = findProvinceByName(newProvince);
+
+  if (!province) {
+    formAddress.value.ward = "";
+    return;
+  }
+
+  const wardStillValid = province.wards.find(ward => normalizeText(ward.name) === normalizeText(formAddress.value.ward));
+
+  if (!wardStillValid) {
+    formAddress.value.ward = "";
+  }
+});
 
 // Load d·ªØ li·ªáu ban ƒë·∫ßu
 onMounted(async () => {
   await loadAssetDetail();
-  loadProvinces();
 });
 
-function loadProvinces() {
-  provinces.value = addressData;
-}
-
-function onProvinceChange() {
-  const found = provinces.value.find(p => p.name === selectedProvince.value);
-  wards.value = found ? found.wards : [];
-  formAddress.value.ward = "";
-}
-
 
 async function loadAssetDetail() {
   try {
     const res = await api.get(`/admin.thg/product/admin/chi-tiet/${id}`);
     asset.value = res.data;
     initializeFormData();
     parseAddress();
-    matchAddressWithData();
   } catch (error) {
     console.error("L·ªói khi t·∫£i d·ªØ li·ªáu t√†i s·∫£n:", error);
   }
 }
 
-function matchAddressWithData() {
-  if (!formAddress.value.area) return;
-
-  const provinceName = formAddress.value.area.trim();
-
-  // üîç t√¨m ƒë√∫ng t·ªânh
-  const foundProvince = provinces.value.find(
-      p => p.name.trim() === provinceName
-  );
+function initializeFormData() {
+  formData.value = JSON.parse(JSON.stringify(asset.value));
+  formData.value.loaiTaiSan = formData.value.loaiTaiSan || detectAssetTypeFromStructure.value || "";
+  formData.value.rooms = formData.value.rooms || [];
+  formData.value.files = formData.value.files || [];
+  formData.value.newFiles = formData.value.newFiles || [];
+  formData.value.newLandBookFiles = formData.value.newLandBookFiles || [];
+  formData.value.deletedFileIds = formData.value.deletedFileIds || [];
+  formData.value.deletedLandBookFileIds = formData.value.deletedLandBookFileIds || [];
+  originalFiles.value = JSON.parse(JSON.stringify(formData.value.files));
+}
 
-  if (!foundProvince) {
-    console.warn("Kh√¥ng t√¨m th·∫•y t·ªânh:", provinceName);
+function parseAddress() {
+  if (!formData.value.address) {
+    formAddress.value = { street: "", ward: "", province: "" };
     return;
   }
 
-  // set STRING
-  selectedProvince.value = foundProvince.name;
+  const parts = formData.value.address.split("/!!").map(p => p.trim());
+  const street = parts[0] || "";
+  const rawWard = parts[1] || "";
+  const rawProvince = parts[2] || "";
 
-  // load wards
-  wards.value = foundProvince.wards;
+  const provinceMatched = findProvinceByName(rawProvince);
+  const provinceName = provinceMatched?.name || "";
+  const wardName = findWardByName(rawWard, provinceMatched);
 
-  // match ward
-  const foundWard = foundProvince.wards.find(
-      w => w.name.trim() === formAddress.value.ward.trim()
-  );
+  formAddress.value = {
+    street,
+    ward: wardName,
+    province: provinceName
+  };
+  formData.value.khuVucMa = provinceName;
+}
 
-  if (foundWard) {
-    formAddress.value.ward = foundWard.name;
-  }
+function normalizeText(value) {
+  return (value || "")
+      .normalize("NFD")
+      .replace(/[\u0300-\u036f]/g, "")
+      .toLowerCase()
+      .trim();
 }
 
-function initializeFormData() {
-  formData.value = JSON.parse(JSON.stringify(asset.value));
-  formData.value.loaiTaiSan = formData.value.loaiTaiSan || detectAssetTypeFromStructure.value || "";
-  formData.value.rooms = formData.value.rooms || [];
+function findProvinceByName(name) {
+  const normalized = normalizeText(name);
+  if (!normalized) return null;
+
+  return provinces.find(province => normalizeText(province.name) === normalized) || null;
 }
 
-function parseAddress() {
-  if (!formData.value.address) return;
+function findWardByName(name, province) {
+  const normalized = normalizeText(name);
+  if (!normalized || !province) return "";
 
-  const parts = formData.value.address.split("/!!").map(p => p.trim());
-  formAddress.value = {
-    street: parts[0] || "",
-    ward: parts[1] || "",
-    area: parts[2] || ""
-  };
+  const match = (province.wards || []).find(ward => normalizeText(ward.name) === normalized);
+  return match ? match.name : "";
 }
 
 // Computed properties
 const isHouse = computed(() => formData.value.loaiTaiSan === "NHA");
 const isLand = computed(() => formData.value.loaiTaiSan === "DAT" || formData.value.loaiTaiSan === "DATLON");
 
 const detectAssetTypeFromStructure = computed(() => {
   if (!formData.value.structure) return null;
 
   const ketCau = formData.value.structure.toLowerCase();
   const houseKeywords = [
     "l·∫ßu", "tr·ªát", "t·∫ßng", "h·∫ßm", "g√°c",
     "nh√† c·∫•p", "c·∫•p 1", "c·∫•p 2", "c·∫•p 3", "c·∫•p 4",
     "bi·ªát th·ª±", "villa", "shophouse", "townhouse", "nh√†",
     "chung c∆∞", "cƒÉn h·ªô", "chcc", "studio",
     "condotel", "officetel", "apartment", "can ho",
     "chung cu", "tower", "block"
   ];
 
   if (houseKeywords.some(keyword => ketCau.includes(keyword))) {
     return "Nh√†";
   }
 
   if (formData.value.totalArea > 1000) {
     return "ƒê·∫•t l·ªõn";
   }
 
   return "ƒê·∫•t";
 });
 
 const fullAddressPreview = computed(() => {
   const parts = [
     formAddress.value.street,
     formAddress.value.ward,
-    formData.value.khuVucMa || formAddress.value.area
+    formAddress.value.province
   ].filter(part => part && part.trim());
 
   return parts.join(", ") || "Ch∆∞a c√≥ ƒë·ªãa ch·ªâ";
 });
 
 // H√†m x·ª≠ l√Ω
 function onAssetTypeChange() {
   // Reset c√°c tr∆∞·ªùng ƒë·∫∑c th√π khi thay ƒë·ªïi lo·∫°i
   if (isHouse.value) {
     formData.value.hinhDangThuaDat = "";
     formData.value.hienTrangDat = "";
     formData.value.quyHoach = "";
   } else if (isLand.value) {
     formData.value.structure = "";
     formData.value.floorArea = "";
     formData.value.soTang = "";
     formData.value.soLau = "";
   }
 }
 
+function handleFilesUpdate(updatedFiles) {
+  formData.value.files = updatedFiles;
+
+  const existingFiles = updatedFiles.filter(file => !file.file && file.id);
+  const newFiles = updatedFiles.filter(file => file.file instanceof File);
+
+  const newNormalFiles = newFiles.filter(f => !f.isIG).map(f => f.file);
+  const newLandBookFiles = newFiles.filter(f => f.isIG).map(f => f.file);
+
+  const originalIds = (originalFiles.value || []).map(f => f.id);
+  const currentIds = existingFiles.map(f => f.id);
+
+  const deletedFileIds = originalIds.filter(id => {
+    const file = (originalFiles.value || []).find(f => f.id === id);
+    return !currentIds.includes(id) && file && !file.isIG;
+  });
+
+  const deletedLandBookFileIds = originalIds.filter(id => {
+    const file = (originalFiles.value || []).find(f => f.id === id);
+    return !currentIds.includes(id) && file && file.isIG;
+  });
+
+  formData.value.newFiles = newNormalFiles;
+  formData.value.newLandBookFiles = newLandBookFiles;
+  formData.value.deletedFileIds = deletedFileIds;
+  formData.value.deletedLandBookFileIds = deletedLandBookFileIds;
+}
+
+function addRoom() {
+  formData.value.rooms.push({
+    id: Date.now(),
+    loaiPhong: "",
+    soLuong: 0,
+    dienTich: null,
+    moTa: ""
+  });
+}
+
+function removeRoom(index) {
+  formData.value.rooms.splice(index, 1);
+}
+
 async function saveChanges() {
   try {
     isSaving.value = true;
 
     // Gh√©p l·∫°i ƒë·ªãa ch·ªâ
     const addressParts = [
       formAddress.value.street,
       formAddress.value.ward,
-      formData.value.khuVucMa || formAddress.value.area
+      formAddress.value.province
     ].filter(part => part && part.trim());
 
     formData.value.address = addressParts.join("/!!");
+    formData.value.khuVucMa = formAddress.value.province || "";
 
     // Chu·∫©n b·ªã payload
     const payload = {
       ...formData.value,
       slide: undefined,
-      files: undefined,
       valuations: undefined,
       createAt: undefined,
       updateAt: undefined
     };
 
-    const res = await api.put(`/admin.thg/product/admin/cap-nhat/${id}`, payload);
+    console.log("[DEBUG] Payload c·∫≠p nh·∫≠t s·∫£n ph·∫©m:", payload);
+    // const res = await api.put(`/admin.thg/product/admin/cap-nhat/${id}`, payload);
 
-    if (res.status === 200) {
-      alert("C·∫≠p nh·∫≠t th√†nh c√¥ng!");
-      router.back();
-    }
+    // if (res.status === 200) {
+    //   alert("C·∫≠p nh·∫≠t th√†nh c√¥ng!");
+    //   router.back();
+    // }
   } catch (error) {
     console.error("L·ªói khi c·∫≠p nh·∫≠t:", error);
     alert("C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t!");
   } finally {
     isSaving.value = false;
   }
 }
 
 function resetForm() {
   if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën ƒë·∫∑t l·∫°i t·∫•t c·∫£ thay ƒë·ªïi?")) {
     initializeFormData();
     parseAddress();
-    matchAddressWithData();
   }
 }
 
 // Format functions
 function formatAddress(address) {
   if (!address) return "";
   return address.replace(/\/!!/g, ", ");
 }
 
 function formatUpdatedAt(value) {
   if (!value) return "Ch∆∞a c·∫≠p nh·∫≠t";
   const date = new Date(value);
 
   if (isNaN(date.getTime())) return "Ch∆∞a c·∫≠p nh·∫≠t";
 
   return date.toLocaleString("vi-VN", {
     day: "2-digit",
     month: "2-digit",
     year: "numeric",
     hour: "2-digit",
     minute: "2-digit",
   });
 }
 
-function formatProvinceName(name) {
-  if (!name) return "";
-  return name.replace(/^Th√†nh ph·ªë\s+/i, "TP. ").replace(/^T·ªânh\s+/i, "T. ");
-}
-
-function formatWardName(name) {
-  if (!name) return "";
-  return name
-      .replace(/^Ph∆∞·ªùng\s+/i, "P. ")
-      .replace(/^X√£\s+/i, "X. ")
-      .replace(/^Th·ªã tr·∫•n\s+/i, "TT. ");
-}
-
 function formatMoneyVN(value) {
   if (value == null || isNaN(value)) return "0";
   const num = Number(value);
 
   if (num < 1_000_000) {
     return num.toLocaleString("vi-VN");
   }
 
   if (num < 1_000_000_000) {
     const trieu = num / 1_000_000;
     return `${trieu.toFixed(trieu % 1 === 0 ? 0 : 1)} tri·ªáu`;
   }
 
   const ty = num / 1_000_000_000;
   return `${ty.toFixed(ty % 1 === 0 ? 0 : 2)} t·ª∑`;
 }
 
 function formatArea(value) {
   if (value === null || value === undefined || isNaN(value)) return "";
   return Number(value).toLocaleString("en-US", {
     minimumFractionDigits: 0,
     maximumFractionDigits: 2,
   }) + " m¬≤";
 }
 
