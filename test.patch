diff --git a/src/components/thiet-kegiandien/AppointmentsPage.vue b/src/components/thiet-kegiandien/AppointmentsPage.vue
index b5346a7dd33dc9bb1c3188132153dd7511d613bf..0e0da06402000961f540cf962c4b93db8ff460bf 100644
--- a/src/components/thiet-kegiandien/AppointmentsPage.vue
+++ b/src/components/thiet-kegiandien/AppointmentsPage.vue
@@ -2,51 +2,51 @@
 import { ref, reactive, onMounted, onBeforeUnmount, nextTick, watch } from 'vue'
 import { Chart, registerables } from 'chart.js'
 import api from '/src/api/api.js'
 import FileNew from './File.vue'
 Chart.register(...registerables)
 import {useAuthStore} from "/src/stores/authStore.js";
 const authStore = useAuthStore();
 const info = authStore.userInfo;
 // Trong script setup, thêm route
 const rootRef = ref(null)
 const cleanupHandlers = []
 let chart1 = null
 let chart2 = null
 let chart3 = null
 let chart4 = null
 let chart5 = null
 const statsReady = ref(false)

 // ===== Stats (KHÔNG ăn theo bộ lọc) =====
 const statTotal = ref(0)
 const statSelectedDay = ref(0)
 const statUp = ref(0)
 const statPending = ref(0)
 const statCancelled = ref(0)
 // ===== Filter (CHỈ áp dụng cho Calendar + Day Schedule + Table) =====
-const activeFilterText = ref('Tuần này')
+const activeFilterText = ref('Tháng này')
 const activeFilterCount = ref(0)
 const filteredAppointments = ref([])

 const daySlots = ref([])
 const dayTitle = ref('')
 const calendarTitle = ref('')
 const calendarCells = ref([])
 const historyItems = ref([])

 const openActionMenuId = ref(null)
 const dragOverSlot = ref(null)
 // ===== Summary from BE =====
 const statsAppointments = ref([])


 function getActionInfo(action) {
   return APPOINTMENT_ACTION[action] || {
     label: action,
     cls: 'act-other',
   }
 }

 const registerWindowListener = (event, handler, options) => {
   window.addEventListener(event, handler, options)
   cleanupHandlers.push(() => window.removeEventListener(event, handler, options))
@@ -221,51 +221,51 @@ function showToast(title, body, type = 'info') {
   if (!wrap) return
   const icon = type === 'error' ? 'fa-triangle-exclamation' : type === 'success' ? 'fa-circle-check' : 'fa-circle-info'

   const t = document.createElement('div')
   t.className = `toast ${type}`
   t.innerHTML = `
     <div class="ico"><i class="fa-solid ${icon}"></i></div>
     <div class="t">
       <div class="a">${title}</div>
       <div class="b">${body || ''}</div>
     </div>
     <button class="x" aria-label="close"><i class="fa-solid fa-xmark"></i></button>
   `
   wrap.appendChild(t)

   const kill = () => t.remove()
   t.querySelector('.x').addEventListener('click', kill)
   setTimeout(kill, 3800)
 }

 // ===== Date =====
 const selectedDateISO = ref(getTodayISO())
 const calendarMonth = ref(new Date())

 // ===== Filter controls =====
-const activeRange = ref('week') // today | week | month
+const activeRange = ref('month') // today | week | month
 const activeStatus = ref('ALL')
 const searchQuery = ref('')
 const searchKeyword = ref('')
 const appointmentsLoading = ref(false)
 const appointmentsError = ref('')
 let searchTimer = null

 // ===== Modals =====
 const editId = ref(null)
 const isModalOpen = ref(false)
 const isCreateModalOpen = ref(false)
 const isDetailModalOpen = ref(false)
 const selectedAppointment = ref(null)
 const detailCardRef = ref(null)
 const historyPanelRef = ref(null)

 // ===== Create form =====
 const createForm = reactive({
   customerSearch: '',
   selectedCustomer: null,
   branch: null,
   date: '',
   time: '',
   staff: '',
   consultant: 'Tư vấn 1',
@@ -1274,365 +1274,375 @@ const doughnutCenterPlugin = {
     const centerX = (chartArea.left + chartArea.right) / 2
     const centerY = (chartArea.top + chartArea.bottom) / 2

     ctx.save()
     ctx.font = '700 22px "Plus Jakarta Sans", sans-serif'
     ctx.fillStyle = '#0f172a'
     ctx.textAlign = 'center'
     ctx.textBaseline = 'middle'
     ctx.fillText(total.toLocaleString('vi-VN'), centerX, centerY - 4)
     ctx.font = '600 12px "Plus Jakarta Sans", sans-serif'
     ctx.fillStyle = '#64748b'
     ctx.fillText('Tổng', centerX, centerY + 16)
     ctx.restore()
   },
 }
 function initCharts() {
   const c1 = $('#appointmentsChart')
   const c2 = $('#statusChart')
   const c3 = $('#successChart')
   const c4 = $('#successChartSecondary')
   const c5 = $('#revenueChart')

   destroyCharts()

   // Chart 1 (Bar)
-  const ctx1 = c1.getContext('2d')
-  const barGrad = makeGrad(ctx1, [
-    [0, 'rgba(102,126,234,0.95)'],
-    [0.6, 'rgba(118,75,162,0.7)'],
-    [1, 'rgba(79,172,254,0.35)'],
-  ])
-
-  chart1 = new Chart(ctx1, {
-    type: 'bar',
-    data: {
-      labels: [],
-      datasets: [
-        {
-          label: 'Số lịch hẹn',
-          data: [],
-          backgroundColor: barGrad,
-          borderWidth: 0,
-          borderRadius: 10,
-          borderSkipped: false,
-          barPercentage: 0.62,
-          categoryPercentage: 0.7,
-        },
-      ],
-    },
-    options: {
-      responsive: true,
-      maintainAspectRatio: false,
-      interaction: {
-        mode: 'index',
-        intersect: false,
+  if (c1) {
+    const ctx1 = c1.getContext('2d')
+    const barGrad = makeGrad(ctx1, [
+      [0, 'rgba(102,126,234,0.95)'],
+      [0.6, 'rgba(118,75,162,0.7)'],
+      [1, 'rgba(79,172,254,0.35)'],
+    ])
+
+    chart1 = new Chart(ctx1, {
+      type: 'bar',
+      data: {
+        labels: [],
+        datasets: [
+          {
+            label: 'Số lịch hẹn',
+            data: [],
+            backgroundColor: barGrad,
+            borderWidth: 0,
+            borderRadius: 10,
+            borderSkipped: false,
+            barPercentage: 0.62,
+            categoryPercentage: 0.7,
+          },
+        ],
       },
-      plugins: {
-        legend: { display: false },
-        tooltip: {
-          enabled: true,
-          backgroundColor: 'rgba(15,23,42,0.95)',
-          padding: 10,
-          titleColor: '#fff',
-          bodyColor: '#e8edf6',
-          displayColors: false,
+      options: {
+        responsive: true,
+        maintainAspectRatio: false,
+        interaction: {
+          mode: 'index',
+          intersect: false,
         },
-      },
-      scales: {
-        y: {
-          beginAtZero: true,
-          ticks: { color: '#5b6576', font: { weight: '600' } },
-          grid: { color: 'rgba(148,163,184,0.22)' },
+        plugins: {
+          legend: { display: false },
+          tooltip: {
+            enabled: true,
+            backgroundColor: 'rgba(15,23,42,0.95)',
+            padding: 10,
+            titleColor: '#fff',
+            bodyColor: '#e8edf6',
+            displayColors: false,
+          },
         },
-        x: {
-          ticks: { color: '#5b6576', font: { weight: '600' } },
-          grid: { display: false },
+        scales: {
+          y: {
+            beginAtZero: true,
+            ticks: { color: '#5b6576', font: { weight: '600' } },
+            grid: { color: 'rgba(148,163,184,0.22)' },
+          },
+          x: {
+            ticks: { color: '#5b6576', font: { weight: '600' } },
+            grid: { display: false },
+          },
         },
       },
-    },
-  })
+    })
+  }

   // Chart 2 (Doughnut)
-  const ctx2 = c2.getContext('2d')
-  const gWait = makeGrad(ctx2, [
-    [0, 'rgba(251,191,36,0.95)'],
-    [1, 'rgba(253,230,138,0.55)'],
-  ])
-  const gUp = makeGrad(ctx2, [
-    [0, 'rgba(67,233,123,0.95)'],
-    [1, 'rgba(56,249,215,0.55)'],
-  ])
-  const gNot = makeGrad(ctx2, [
-    [0, 'rgba(250,112,154,0.92)'],
-    [1, 'rgba(254,225,64,0.55)'],
-  ])
-  const gPost = makeGrad(ctx2, [
-    [0, 'rgba(79,172,254,0.95)'],
-    [1, 'rgba(0,242,254,0.55)'],
-  ])
-  const gCancel = makeGrad(ctx2, [
-    [0, 'rgba(255,88,88,0.9)'],
-    [1, 'rgba(240,152,25,0.55)'],
-  ])
-  chart2 = new Chart(ctx2, {
-    type: 'doughnut',
-    data: {
-      labels: [],
-      datasets: [
-        {
-          data: [],
-          backgroundColor: [gWait, gUp, gNot, gPost, gCancel],
-          borderWidth: 0,
-          hoverOffset: 6,
-          spacing: 3,
-        },
-      ],
-    },
-    options: {
-      responsive: true,
-      maintainAspectRatio: false,
-      // ✅ PADDING CHO NGUYÊN CHART
-      layout: {
-        padding: {
-          top: 16,
-          right: 18,
-          bottom: 22,
-          left: 18,
-        },
-      },
-      cutout: '72%',
-      interaction: {
-        mode: 'nearest',
-        intersect: false,
+  if (c2) {
+    const ctx2 = c2.getContext('2d')
+    const gWait = makeGrad(ctx2, [
+      [0, 'rgba(251,191,36,0.95)'],
+      [1, 'rgba(253,230,138,0.55)'],
+    ])
+    const gUp = makeGrad(ctx2, [
+      [0, 'rgba(67,233,123,0.95)'],
+      [1, 'rgba(56,249,215,0.55)'],
+    ])
+    const gNot = makeGrad(ctx2, [
+      [0, 'rgba(250,112,154,0.92)'],
+      [1, 'rgba(254,225,64,0.55)'],
+    ])
+    const gPost = makeGrad(ctx2, [
+      [0, 'rgba(79,172,254,0.95)'],
+      [1, 'rgba(0,242,254,0.55)'],
+    ])
+    const gCancel = makeGrad(ctx2, [
+      [0, 'rgba(255,88,88,0.9)'],
+      [1, 'rgba(240,152,25,0.55)'],
+    ])
+    chart2 = new Chart(ctx2, {
+      type: 'doughnut',
+      data: {
+        labels: [],
+        datasets: [
+          {
+            data: [],
+            backgroundColor: [gWait, gUp, gNot, gPost, gCancel],
+            borderWidth: 0,
+            hoverOffset: 6,
+            spacing: 3,
+          },
+        ],
       },
-      plugins: {
-        legend: {
-          position: 'bottom',
-          labels: { color: '#455064', boxWidth: 10, boxHeight: 10, font: { weight: '600' } },
+      options: {
+        responsive: true,
+        maintainAspectRatio: false,
+        // ✅ PADDING CHO NGUYÊN CHART
+        layout: {
+          padding: {
+            top: 16,
+            right: 18,
+            bottom: 22,
+            left: 18,
+          },
+        },
+        cutout: '72%',
+        interaction: {
+          mode: 'nearest',
+          intersect: false,
         },
-        tooltip: {
-          enabled: true,
-          backgroundColor: 'rgba(20,22,30,0.92)',
-          padding: 10,
-          titleColor: '#fff',
-          bodyColor: '#e8edf6',
-          displayColors: true,
+        plugins: {
+          legend: {
+            position: 'bottom',
+            labels: { color: '#455064', boxWidth: 10, boxHeight: 10, font: { weight: '600' } },
+          },
+          tooltip: {
+            enabled: true,
+            backgroundColor: 'rgba(20,22,30,0.92)',
+            padding: 10,
+            titleColor: '#fff',
+            bodyColor: '#e8edf6',
+            displayColors: true,
+          },
         },
       },
-    },
-    plugins: [doughnutCenterPlugin],
-  })
+      plugins: [doughnutCenterPlugin],
+    })
+  }

   // Chart 3 (Pie)
-  const ctx3 = c3.getContext('2d')
-  const gSuccess = makeGrad(ctx3, [
-    [0, 'rgba(67,233,123,0.95)'],
-    [1, 'rgba(56,249,215,0.55)'],
-  ])
-  const gFail = makeGrad(ctx3, [
-    [0, 'rgba(255,88,88,0.9)'],
-    [1, 'rgba(240,152,25,0.55)'],
-  ])
-  const gCare = makeGrad(ctx3, [
-    [0, 'rgba(79,172,254,0.95)'],
-    [1, 'rgba(0,242,254,0.55)'],
-  ])
-  chart3 = new Chart(ctx3, {
-    type: 'pie',
-    data: {
-      labels: ['Thành công', 'Thất bại', 'Chăm sóc'],
-      datasets: [
-        {
-          data: [0, 0, 0],
-          backgroundColor: [gSuccess, gFail, gCare],
-          borderWidth: 0,
-          hoverOffset: 6,
-          spacing: 2,
-        },
-      ],
-    },
-    options: {
-      responsive: true,
-      maintainAspectRatio: false,
-      layout: {
-        padding: {
-          top: 16,
-          right: 18,
-          bottom: 22,
-          left: 18,
-        },
-      },
-      interaction: {
-        mode: 'nearest',
-        intersect: false,
+  if (c3) {
+    const ctx3 = c3.getContext('2d')
+    const gSuccess = makeGrad(ctx3, [
+      [0, 'rgba(67,233,123,0.95)'],
+      [1, 'rgba(56,249,215,0.55)'],
+    ])
+    const gFail = makeGrad(ctx3, [
+      [0, 'rgba(255,88,88,0.9)'],
+      [1, 'rgba(240,152,25,0.55)'],
+    ])
+    const gCare = makeGrad(ctx3, [
+      [0, 'rgba(79,172,254,0.95)'],
+      [1, 'rgba(0,242,254,0.55)'],
+    ])
+    chart3 = new Chart(ctx3, {
+      type: 'pie',
+      data: {
+        labels: ['Thành công', 'Thất bại', 'Chăm sóc'],
+        datasets: [
+          {
+            data: [0, 0, 0],
+            backgroundColor: [gSuccess, gFail, gCare],
+            borderWidth: 0,
+            hoverOffset: 6,
+            spacing: 2,
+          },
+        ],
       },
-      plugins: {
-        legend: {
-          position: 'bottom',
-          labels: { color: '#455064', boxWidth: 10, boxHeight: 10, font: { weight: '600' } },
+      options: {
+        responsive: true,
+        maintainAspectRatio: false,
+        layout: {
+          padding: {
+            top: 16,
+            right: 18,
+            bottom: 22,
+            left: 18,
+          },
         },
-        tooltip: {
-          enabled: true,
-          backgroundColor: 'rgba(20,22,30,0.92)',
-          padding: 10,
-          titleColor: '#fff',
-          bodyColor: '#e8edf6',
+        interaction: {
+          mode: 'nearest',
+          intersect: false,
+        },
+        plugins: {
+          legend: {
+            position: 'bottom',
+            labels: { color: '#455064', boxWidth: 10, boxHeight: 10, font: { weight: '600' } },
+          },
+          tooltip: {
+            enabled: true,
+            backgroundColor: 'rgba(20,22,30,0.92)',
+            padding: 10,
+            titleColor: '#fff',
+            bodyColor: '#e8edf6',
+          },
         },
       },
-    },
-  })
+    })
+  }

   // Chart 4 (Pie - Secondary)
-  const ctx4 = c4.getContext('2d')
-  const gSuccess2 = makeGrad(ctx4, [
-    [0, 'rgba(67,233,123,0.95)'],
-    [1, 'rgba(56,249,215,0.55)'],
-  ])
-  const gFail2 = makeGrad(ctx4, [
-    [0, 'rgba(255,88,88,0.9)'],
-    [1, 'rgba(240,152,25,0.55)'],
-  ])
-  const gCare2 = makeGrad(ctx4, [
-    [0, 'rgba(79,172,254,0.95)'],
-    [1, 'rgba(0,242,254,0.55)'],
-  ])
-  chart4 = new Chart(ctx4, {
-    type: 'pie',
-    data: {
-      labels: ['Thành công', 'Thất bại', 'Chăm sóc'],
-      datasets: [
-        {
-          data: [0, 0, 0],
-          backgroundColor: [gSuccess2, gFail2, gCare2],
-          borderWidth: 0,
-          hoverOffset: 6,
-          spacing: 2,
-        },
-      ],
-    },
-    options: {
-      responsive: true,
-      maintainAspectRatio: false,
-      layout: {
-        padding: {
-          top: 16,
-          right: 18,
-          bottom: 22,
-          left: 18,
-        },
-      },
-      interaction: {
-        mode: 'nearest',
-        intersect: false,
+  if (c4) {
+    const ctx4 = c4.getContext('2d')
+    const gSuccess2 = makeGrad(ctx4, [
+      [0, 'rgba(67,233,123,0.95)'],
+      [1, 'rgba(56,249,215,0.55)'],
+    ])
+    const gFail2 = makeGrad(ctx4, [
+      [0, 'rgba(255,88,88,0.9)'],
+      [1, 'rgba(240,152,25,0.55)'],
+    ])
+    const gCare2 = makeGrad(ctx4, [
+      [0, 'rgba(79,172,254,0.95)'],
+      [1, 'rgba(0,242,254,0.55)'],
+    ])
+    chart4 = new Chart(ctx4, {
+      type: 'pie',
+      data: {
+        labels: ['Thành công', 'Thất bại', 'Chăm sóc'],
+        datasets: [
+          {
+            data: [0, 0, 0],
+            backgroundColor: [gSuccess2, gFail2, gCare2],
+            borderWidth: 0,
+            hoverOffset: 6,
+            spacing: 2,
+          },
+        ],
       },
-      plugins: {
-        legend: {
-          position: 'bottom',
-          labels: { color: '#455064', boxWidth: 10, boxHeight: 10, font: { weight: '600' } },
+      options: {
+        responsive: true,
+        maintainAspectRatio: false,
+        layout: {
+          padding: {
+            top: 16,
+            right: 18,
+            bottom: 22,
+            left: 18,
+          },
         },
-        tooltip: {
-          enabled: true,
-          backgroundColor: 'rgba(20,22,30,0.92)',
-          padding: 10,
-          titleColor: '#fff',
-          bodyColor: '#e8edf6',
+        interaction: {
+          mode: 'nearest',
+          intersect: false,
+        },
+        plugins: {
+          legend: {
+            position: 'bottom',
+            labels: { color: '#455064', boxWidth: 10, boxHeight: 10, font: { weight: '600' } },
+          },
+          tooltip: {
+            enabled: true,
+            backgroundColor: 'rgba(20,22,30,0.92)',
+            padding: 10,
+            titleColor: '#fff',
+            bodyColor: '#e8edf6',
+          },
         },
       },
-    },
-  })
+    })
+  }

   // Chart 5 (Revenue)
-  const ctx5 = c5.getContext('2d')
-  const revenueGrad = makeGrad(ctx5, [
-    [0, 'rgba(102,126,234,0.5)'],
-    [0.6, 'rgba(118,75,162,0.25)'],
-    [1, 'rgba(79,172,254,0.12)'],
-  ])
-  const revenueBorder = makeGrad(ctx5, [
-    [0, 'rgba(102,126,234,0.95)'],
-    [1, 'rgba(118,75,162,0.85)'],
-  ])
-  chart5 = new Chart(ctx5, {
-    type: 'line',
-    data: {
-      labels: [],
-      datasets: [
-        {
-          label: 'Doanh thu',
-          data: [],
-          backgroundColor: revenueGrad,
-          borderColor: revenueBorder,
-          borderWidth: 2,
-          fill: true,
-          tension: 0.35,
-          pointRadius: 3,
-          pointHoverRadius: 4,
-          pointBackgroundColor: '#fff',
-          pointBorderColor: '#667eea',
-        },
-      ],
-    },
-    options: {
-      responsive: true,
-      maintainAspectRatio: false,
-      interaction: {
-        mode: 'index',
-        intersect: false,
+  if (c5) {
+    const ctx5 = c5.getContext('2d')
+    const revenueGrad = makeGrad(ctx5, [
+      [0, 'rgba(102,126,234,0.5)'],
+      [0.6, 'rgba(118,75,162,0.25)'],
+      [1, 'rgba(79,172,254,0.12)'],
+    ])
+    const revenueBorder = makeGrad(ctx5, [
+      [0, 'rgba(102,126,234,0.95)'],
+      [1, 'rgba(118,75,162,0.85)'],
+    ])
+    chart5 = new Chart(ctx5, {
+      type: 'line',
+      data: {
+        labels: [],
+        datasets: [
+          {
+            label: 'Doanh thu',
+            data: [],
+            backgroundColor: revenueGrad,
+            borderColor: revenueBorder,
+            borderWidth: 2,
+            fill: true,
+            tension: 0.35,
+            pointRadius: 3,
+            pointHoverRadius: 4,
+            pointBackgroundColor: '#fff',
+            pointBorderColor: '#667eea',
+          },
+        ],
       },
-      plugins: {
-        legend: { display: false },
-        tooltip: {
-          enabled: true,
-          backgroundColor: 'rgba(15,23,42,0.95)',
-          padding: 10,
-          titleColor: '#fff',
-          bodyColor: '#e8edf6',
-          callbacks: {
-            label(context) {
-              return `Doanh thu: ${formatCurrencyVND(context.parsed.y)}`
+      options: {
+        responsive: true,
+        maintainAspectRatio: false,
+        interaction: {
+          mode: 'index',
+          intersect: false,
+        },
+        plugins: {
+          legend: { display: false },
+          tooltip: {
+            enabled: true,
+            backgroundColor: 'rgba(15,23,42,0.95)',
+            padding: 10,
+            titleColor: '#fff',
+            bodyColor: '#e8edf6',
+            callbacks: {
+              label(context) {
+                return `Doanh thu: ${formatCurrencyVND(context.parsed.y)}`
+              },
             },
           },
         },
-      },
-      scales: {
-        y: {
-          beginAtZero: true,
-          ticks: {
-            color: '#5b6576',
-            font: { weight: '600' },
-            callback: (value) => formatCurrencyVND(value),
+        scales: {
+          y: {
+            beginAtZero: true,
+            ticks: {
+              color: '#5b6576',
+              font: { weight: '600' },
+              callback: (value) => formatCurrencyVND(value),
+            },
+            grid: { color: 'rgba(148,163,184,0.22)' },
+          },
+          x: {
+            ticks: { color: '#5b6576', font: { weight: '600' } },
+            grid: { display: false },
           },
-          grid: { color: 'rgba(148,163,184,0.22)' },
-        },
-        x: {
-          ticks: { color: '#5b6576', font: { weight: '600' } },
-          grid: { display: false },
         },
       },
-    },
-  })
+    })
+  }
 }

 // ===== Action menu =====
 function toggleActionMenu(id) {
   openActionMenuId.value = openActionMenuId.value === id ? null : id
 }
 function handleAction(type, appt, event) {
   openActionMenuId.value = null
   if (type === 'edit') openEditModal(appt.id)
   else if (type === 'status') openStatusPopover(event.currentTarget, appt.id)
   else if (type === 'delete') {
     appointments.value = appointments.value.filter((x) => x.id !== appt.id)
     generateCalendar()
     updateDaySchedule()
     updateFilterOutputs()
     showToast('Đã xoá lịch hẹn', appt.customer || 'Đã xoá.', 'success')
   } else if (type === 'detail') openDetailModal(appt)
 }
 function updateStatusChart() {
   if (!chart2) return

   const counts = {
     WAITING: 0,
     UP: 0,
     NOT_UP: 0,
