diff --git a/src/components/thiet-kegiandien/telesales-lien-he-khach-hang.vue b/src/components/thiet-kegiandien/telesales-lien-he-khach-hang.vue
index 422461b36a6d4b9d1eb5a2fdd313d937e98f36c7..31486ea782c59e78f78c919408f1016be78a7797 100644
--- a/src/components/thiet-kegiandien/telesales-lien-he-khach-hang.vue
+++ b/src/components/thiet-kegiandien/telesales-lien-he-khach-hang.vue
@@ -310,99 +310,110 @@
             <h5><i class="fas fa-tags"></i> Đánh dấu khách hàng</h5>
             <div class="tag-selector">
               <button
                   v-for="tag in availableTags"
                   :key="tag.value"
                   class="tag-option"
                   :class="{ active: isTagActive(tag.value) }"
                   :style="isTagActive(tag.value) ? { backgroundColor: tag.color, borderColor: tag.color, color: '#fff' } : {}"
                   @click="toggleCustomerStatus(tag.value)"
               >
                 {{ tag.label }}
               </button>
             </div>
           </div>

           <div class="detail-section">
             <h5>
               <i class="fas fa-sticky-note"></i>Mô tả:
               <span style="font-size: 14px; color: #4A4A4A; font-weight: 400">
                 {{ selectedCustomer.note !== '' ? selectedCustomer.note : 'Không có' }}
               </span>
             </h5>
           </div>

           <FileNew
-              v-if="selectedCustomer && selectedCustomer.files"
+              v-if="selectedCustomer"
               :key="'request-new-asset'"
-              :fileList="selectedCustomer.files"
-              :entityId="null"
+              :file-list="fileForm.files"
+              :entity-id="null"
               :allow-download-all="false"
-              entityType="land"
-              :canEdit="true"
+              entity-type="land"
+              :can-edit="true"
+              :on-upload="true"
               class="mt-2"
+              @update:files="handleFileUpdate"
           />

           <div class="add-note-form">
             <textarea v-model="newNote" placeholder="Thêm ghi chú cuộc gọi..." rows="3"></textarea>
           </div>

           <div class="detail-actions">
             <button class="action-btn move-btn" @click="moveToContacted">
               <i class="fas fa-save"></i> Lưu thông tin
             </button>
           </div>
         </div>
       </div>
     </div>
   </div>
 </template>

 <script setup>
 import { ref, computed, watch, onMounted, onUnmounted, nextTick } from 'vue'
 import Chart from 'chart.js/auto'
 import api from '/src/api/api.js'
 import FileNew from '../productAdmin/FileNew.vue'

 // ====== META ======
 const STATUS_META = {
   NEW: { label: 'Mới', color: '#94a3b8' },
   DC_TELESALES: { label: 'Mới tiếp nhận', color: '#6366f1' },
   CHAM_SOC: { label: 'Đang chăm sóc', color: '#38bdf8' },
   TN_7NGAY: { label: 'Tiềm năng 7 ngày', color: '#0ea5e9' },
   TN_14NGAY: { label: 'Tiềm năng 14 ngày', color: '#0284c7' },
   THAT_BAI: { label: 'Thất bại', color: '#f43f5e' },
   KHONG_LIEN_LAC_DUOC: { label: 'Không liên lạc được', color: '#f97316' },
   SAI_SO_LIEU: { label: 'Sai số liệu', color: '#a855f7' },
   THANH_CONG: { label: 'Thành công (Lên VP)', color: '#22c55e' }
 }

 // ====== Reactive state ======
 const activeTab = ref('new')
 const selectedCustomer = ref(null)
 const newNote = ref('')
 const searchQuery = ref('')
+const originalFiles = ref([])
+
+const fileForm = ref({
+  files: [],
+  newFiles: [],
+  newLandBookFiles: [],
+  deletedFileIds: [],
+  deletedLandBookFileIds: []
+})

 // ✅ FIX all -> null
 const statusFilter = ref(null)
 const typeFilter = ref(null)

 const currentPage = ref(1)
 const pageSize = ref(4)

 const selectedTimeRange = ref('month')
 const selectedYear = ref(new Date().getFullYear())
 const selectedMonth = ref(new Date().getMonth() + 1)

 const lineChart = ref(null)
 const lineChartInstance = ref(null)
 const summaryChartInstance = ref(null)

 // ✅ years = 5 năm gần nhất
 const currentYear = new Date().getFullYear()
 const years = Array.from({ length: 5 }, (_, i) => currentYear - i)

 const months = [
   'Tháng 1','Tháng 2','Tháng 3','Tháng 4','Tháng 5','Tháng 6',
   'Tháng 7','Tháng 8','Tháng 9','Tháng 10','Tháng 11','Tháng 12'
 ]

@@ -588,76 +599,159 @@ const getAvatarColor = (name) => {
   return `hsl(${hue}, 60%, 55%)`
 }

 const formatTime = (isoString) => {
   if (!isoString) return 'Chưa gọi'
   const date = new Date(isoString)
   return date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' })
 }

 const formatReceivedAt = (isoString) => {
   if (!isoString) return '-'
   const date = new Date(isoString)
   return date.toLocaleString('vi-VN', {
     hour: '2-digit',
     minute: '2-digit',
     day: '2-digit',
     month: '2-digit',
     year: 'numeric'
   })
 }

 // ====== Detail actions ======
 const selectCustomer = (customer) => {
   selectedCustomer.value = customer
   newNote.value = ''
+  resetFileForm(customer?.files)
 }

 const toggleCustomerStatus = (status) => {
   if (!selectedCustomer.value) return
   selectedCustomer.value.status = selectedCustomer.value.status === status ? null : status
 }

+const resetFileForm = (files) => {
+  const safeFiles = Array.isArray(files) ? JSON.parse(JSON.stringify(files)) : []
+  fileForm.value = {
+    files: safeFiles,
+    newFiles: [],
+    newLandBookFiles: [],
+    deletedFileIds: [],
+    deletedLandBookFileIds: []
+  }
+  originalFiles.value = JSON.parse(JSON.stringify(safeFiles))
+}
+
+const handleFileUpdate = (files) => {
+  fileForm.value.files = Array.isArray(files) ? files : []
+
+  const existingFiles = fileForm.value.files.filter((file) => !file.file && file.id)
+  const newFiles = fileForm.value.files.filter((file) => file.file instanceof File)
+
+  fileForm.value.newFiles = newFiles
+      .filter((file) => !file.isIG)
+      .map((file) => ({ file: file.file, isOnTop: file.isOnTop }))
+
+  fileForm.value.newLandBookFiles = newFiles
+      .filter((file) => file.isIG)
+      .map((file) => ({ file: file.file, isOnTop: file.isOnTop }))
+
+  const originalIds = (originalFiles.value || []).map((file) => file.id)
+  const currentIds = existingFiles.map((file) => file.id)
+
+  fileForm.value.deletedFileIds = originalIds.filter((id) => {
+    const file = (originalFiles.value || []).find((item) => item.id === id)
+    return !currentIds.includes(id) && file && !file.isIG
+  })
+
+  fileForm.value.deletedLandBookFileIds = originalIds.filter((id) => {
+    const file = (originalFiles.value || []).find((item) => item.id === id)
+    return !currentIds.includes(id) && file && file.isIG
+  })
+}
+
+const buildFilePayload = () => {
+  const dto = {
+    customerId: selectedCustomer.value.id,
+    status: selectedCustomer.value.status,
+    description: newNote.value,
+    files: fileForm.value.files
+        .filter((file) => !file.file && file.id)
+        .map((file) => ({
+          id: file.id,
+          fileName: file.fileName,
+          isIG: file.isIG,
+          isOnTop: file.isOnTop
+        })),
+    deletedFileIds: fileForm.value.deletedFileIds,
+    deletedLandBookFileIds: fileForm.value.deletedLandBookFileIds
+  }
+
+  const fd = new FormData()
+  fd.append('dto', new Blob([JSON.stringify(dto)], { type: 'application/json' }))
+
+  const mainFile = fileForm.value.newFiles.find((file) => file?.isOnTop && file.file instanceof File)
+      || fileForm.value.newLandBookFiles.find((file) => file?.isOnTop && file.file instanceof File)
+
+  if (mainFile) {
+    fd.append('newFileOntop', mainFile.file)
+  }
+
+  fileForm.value.newFiles.forEach((file) => {
+    if (file?.file instanceof File) {
+      fd.append('newFiles', file.file)
+    }
+  })
+
+  fileForm.value.newLandBookFiles.forEach((file) => {
+    if (file?.file instanceof File) {
+      fd.append('newLandBookFiles', file.file)
+    }
+  })
+
+  return fd
+}
+
 const moveToContacted = async () => {
   if (!selectedCustomer.value) return

   try {
-    await api.post('/customer-crm/telesales/journey-history/create', {
-      customerId: selectedCustomer.value.id,
-      status: selectedCustomer.value.status,
-      description: newNote.value
+    const payload = buildFilePayload()
+    await api.post('/customer-crm/telesales/journey-history/create', payload, {
+      headers: { 'Content-Type': 'multipart/form-data' }
     })

     const index = newCustomers.value.findIndex((c) => c.id === selectedCustomer.value.id)
     if (index !== -1) {
       const customer = newCustomers.value.splice(index, 1)[0]
       customer.tags = customer.status ? [customer.status] : []
       contactedCustomers.value.unshift(customer)
     }

     selectedCustomer.value = null
     newNote.value = ''
+    resetFileForm([])
     activeTab.value = 'contacted'

     // reload thống kê
     await refreshData()
   } catch (err) {
     console.error(err)
   }
 }

 // ====== API ======
 const fetchThongKeHomNay = async () => {
   try {
     const { data } = await api.get('/customer-crm/telesales/thong-ke/hom-nay')
     todayStats.value = data
   } catch (e) {
     console.error('❌ Lỗi thống kê hôm nay', e)
   }
 }

 const fetchThongKeTrangThaiTeleSales = async () => {
   try {
     const { data } = await api.get('/customer-crm/telesales/thong-ke-trang-thai')
     thongKeTrangThai.value = Array.isArray(data)
         ? data.map((item) => ({
           label: item.label,
@@ -672,51 +766,51 @@ const fetchThongKeTrangThaiTeleSales = async () => {
 const fetchKhachMoiTiepNhan = async () => {
   const res = await api.get('/customer-crm/telesales/khach-moi-tiep-nhan', {
     params: {
       type: typeFilter.value || null,
       search: searchQuery.value || null
     }
   })
   return res.data
 }

 const loadKhachMoiTiepNhan = async () => {
   try {
     const data = await fetchKhachMoiTiepNhan()
     newCustomers.value = (data || []).map((item) => ({
       id: item.id,
       name: item.hoTen,
       phone: item.soDienThoai,
       receivedAt: item.thoiGianTiepNhan,
       province: item.tinhMoi,
       oldProvince: item.tinhCu || null,
       type: item.type || null, // CHINH_CHU / MOI_GIOI / NGUOI_THAN
       note: item.ghiChu || '',
       status: null,
       tags: [],
       lastCall: null,
-      files: item.files || null
+      files: Array.isArray(item.files) ? item.files : []
     }))
   } catch (err) {
     newCustomers.value = []
   }
 }

 // ====== LINE CHART (theo năm / tháng) ======
 const fetchThongKeBieuDo = async () => {
   try {
     let res

     if (selectedTimeRange.value === 'month') {
       res = await api.get('/customer-crm/telesales/thong-ke/thang', {
         params: { year: selectedYear.value, month: selectedMonth.value }
       })
     } else {
       res = await api.get('/customer-crm/telesales/thong-ke/nam', {
         params: { year: selectedYear.value }
       })
     }

     thongKeThoiGian.value = Array.isArray(res.data) ? res.data : []
     await nextTick()
     initLineChart()
   } catch (e) {
