diff --git a/src/components/thiet-kegiandien/AppointmentsPage.vue b/src/components/thiet-kegiandien/AppointmentsPage.vue
index cb5676a30875caede239f54c4081585a4a4559d9..01f6c08d2449ef7f147e50233497127a8942f86a 100644
--- a/src/components/thiet-kegiandien/AppointmentsPage.vue
+++ b/src/components/thiet-kegiandien/AppointmentsPage.vue
@@ -1,37 +1,38 @@
 <script setup>
 import { ref, reactive, onMounted, onBeforeUnmount, nextTick, watch } from 'vue'
 import { Chart, registerables } from 'chart.js'
 import api from '/src/api/api.js'
 import FileNew from './File.vue'
 Chart.register(...registerables)

 const rootRef = ref(null)
 const cleanupHandlers = []
 let chart1 = null
 let chart2 = null
 let chart3 = null
+const statsReady = ref(false)

 // ===== Stats (KHÔNG ăn theo bộ lọc) =====
 const statTotal = ref(0)
 const statSelectedDay = ref(0)
 const statUp = ref(0)
 const statPending = ref(0)
 const statCancelled = ref(0)
 // ===== Filter (CHỈ áp dụng cho Calendar + Day Schedule + Table) =====
 const activeFilterText = ref('Tuần này')
 const activeFilterCount = ref(0)
 const filteredAppointments = ref([])

 const daySlots = ref([])
 const dayTitle = ref('')
 const calendarTitle = ref('')
 const calendarCells = ref([])
 const historyItems = ref([])

 const openActionMenuId = ref(null)
 const dragOverSlot = ref(null)
 // ===== Summary from BE =====
 const summaryLoading = ref(false)
 const summaryError = ref('')


@@ -148,50 +149,53 @@ function getRatingInfo(value) {
 const DAY_START_HOUR = 8
 const DAY_END_HOUR = 17
 const TIME_SLOTS = Array.from({ length: DAY_END_HOUR - DAY_START_HOUR + 1 }, (_, i) => `${pad2(DAY_START_HOUR + i)}:00`)

 function timeToMinutes(time) {
   const [h, m] = String(time || '').split(':')
   return Number(h) * 60 + Number(m)
 }

 function buildDaySlotTimes(list) {
   const times = new Set(TIME_SLOTS)
   list.forEach((a) => {
     if (!a?.time) return
     const minutes = timeToMinutes(a.time)
     if (Number.isNaN(minutes)) return
     if (minutes < DAY_START_HOUR * 60 || minutes > DAY_END_HOUR * 60) return
     times.add(a.time)
   })
   return Array.from(times).sort((a, b) => timeToMinutes(a) - timeToMinutes(b))
 }

 function formatVNDate(yyyyMMdd) {
   const [y, m, d] = yyyyMMdd.split('-')
   return `${d}/${m}/${y}`
 }
+function formatShortDateLabel(dateObj) {
+  return `${dateObj.getDate()}/${dateObj.getMonth() + 1}`
+}
 function toISODate(d) {
   return `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`
 }
 function startOfWeek(dateObj) {
   const d = new Date(dateObj)
   const day = d.getDay()
   const diff = (day === 0 ? -6 : 1) - day
   d.setDate(d.getDate() + diff)
   d.setHours(0, 0, 0, 0)
   return d
 }
 function endOfWeek(dateObj) {
   const s = startOfWeek(dateObj)
   const e = new Date(s)
   e.setDate(e.getDate() + 7)
   return e
 }
 function endOfWeekInclusive(dateObj) {
   const s = startOfWeek(dateObj)
   const e = new Date(s)
   e.setDate(e.getDate() + 6)
   return e
 }
 function initials(name) {
   const parts = String(name || '')
@@ -1212,55 +1216,55 @@ function destroyCharts() {
 }
 function makeGrad(ctx, stops) {
   const g = ctx.createLinearGradient(0, 0, 0, 220)
   stops.forEach((s) => g.addColorStop(s[0], s[1]))
   return g
 }
 function initCharts() {
   const c1 = $('#appointmentsChart')
   const c2 = $('#statusChart')
   const c3 = $('#successChart')
   if (!c1 || !c2 || !c3) return

   destroyCharts()

   // Chart 1 (Bar)
   const ctx1 = c1.getContext('2d')
   const barGrad = makeGrad(ctx1, [
     [0, 'rgba(102,126,234,0.95)'],
     [0.55, 'rgba(118,75,162,0.78)'],
     [1, 'rgba(79,172,254,0.50)'],
   ])

   chart1 = new Chart(ctx1, {
     type: 'bar',
     data: {
-      labels: ['3/1', '2/1', '1/1', '31/12', '30/12', '29/12', '28/12'],
+      labels: [],
       datasets: [
         {
           label: 'Số lịch hẹn',
-          data: [4, 3, 2, 1, 2, 3, 2],
+          data: [],
           backgroundColor: barGrad,
           borderWidth: 0,
           borderRadius: 14,
           borderSkipped: false,
           barPercentage: 0.7,
           categoryPercentage: 0.72,
         },
       ],
     },
     options: {
       responsive: true,
       maintainAspectRatio: false,
       plugins: {
         legend: { display: false },
         tooltip: {
           backgroundColor: 'rgba(20,22,30,0.92)',
           padding: 10,
           titleColor: '#fff',
           bodyColor: '#e8edf6',
           displayColors: false,
         },
       },
       scales: {
         y: {
           beginAtZero: true,
@@ -1327,51 +1331,51 @@ function initCharts() {
       },
     },
   })

   // Chart 3 (Pie)
   const ctx3 = c3.getContext('2d')
   const gSuccess = makeGrad(ctx3, [
     [0, 'rgba(67,233,123,0.95)'],
     [1, 'rgba(56,249,215,0.55)'],
   ])
   const gFail = makeGrad(ctx3, [
     [0, 'rgba(255,88,88,0.90)'],
     [1, 'rgba(240,152,25,0.55)'],
   ])
   const gCare = makeGrad(ctx3, [
     [0, 'rgba(79,172,254,0.95)'],
     [1, 'rgba(0,242,254,0.55)'],
   ])

   chart3 = new Chart(ctx3, {
     type: 'pie',
     data: {
       labels: ['Thành công', 'Thất bại', 'Chăm sóc'],
       datasets: [
         {
-          data: [60, 20, 20],
+          data: [0, 0, 0],
           backgroundColor: [gSuccess, gFail, gCare],
           borderWidth: 0,
           hoverOffset: 6,
           spacing: 2,
         },
       ],
     },
     options: {
       responsive: true,
       maintainAspectRatio: false,
       plugins: {
         legend: {
           position: 'bottom',
           labels: { color: '#455064', boxWidth: 10, boxHeight: 10, font: { weight: '600' } },
         },
         tooltip: {
           backgroundColor: 'rgba(20,22,30,0.92)',
           padding: 10,
           titleColor: '#fff',
           bodyColor: '#e8edf6',
         },
       },
     },
   })
 }
@@ -1436,84 +1440,134 @@ async function fetchStatusChart() {
   } catch (e) {
     statusChartError.value = 'Không thể tải biểu đồ trạng thái'
   } finally {
     statusChartLoading.value = false
   }
 }
 function updateStatusChart() {
   if (!chart2) return

   chart2.data.labels = [
     STATUS.UP.label,
     STATUS.NOT_UP.label,
     STATUS.POSTPONED.label,
     STATUS.CANCELLED.label,
   ]

   chart2.data.datasets[0].data = [
     statusChartData.value.UP || 0,
     statusChartData.value.NOT_UP || 0,
     statusChartData.value.POSTPONED || 0,
     statusChartData.value.CANCELLED || 0,
   ]

   chart2.update()
 }
+function getLast7Days() {
+  const days = []
+  const today = new Date()
+  today.setHours(0, 0, 0, 0)
+  for (let i = 0; i < 7; i += 1) {
+    const d = new Date(today)
+    d.setDate(today.getDate() - i)
+    days.push(d)
+  }
+  return days
+}
+function updateAppointmentsChart() {
+  if (!chart1) return
+
+  const counts = new Map()
+  appointments.value.forEach((appt) => {
+    if (!appt?.date) return
+    counts.set(appt.date, (counts.get(appt.date) || 0) + 1)
+  })
+
+  const days = getLast7Days()
+  chart1.data.labels = days.map((d) => formatShortDateLabel(d))
+  chart1.data.datasets[0].data = days.map((d) => {
+    const iso = toISODate(d)
+    return counts.get(iso) || 0
+  })
+  chart1.update()
+}
+function updateConsultChart() {
+  if (!chart3) return
+  const counts = {
+    [ConsultStatus.SUCCESS]: 0,
+    [ConsultStatus.FAIL]: 0,
+    [ConsultStatus.CARE]: 0,
+  }
+
+  appointments.value.forEach((appt) => {
+    if (!appt?.consultStatus) return
+    if (counts[appt.consultStatus] === undefined) return
+    counts[appt.consultStatus] += 1
+  })
+
+  chart3.data.datasets[0].data = [
+    counts[ConsultStatus.SUCCESS],
+    counts[ConsultStatus.FAIL],
+    counts[ConsultStatus.CARE],
+  ]
+  chart3.update()
+}

 // ===== Watchers =====
 watch(
     () => [activeRange.value, activeStatus.value],
     () => {
       // đổi range:
       // - today/week: khoá month nav, giữ selectedDate nằm trong range
       if (activeRange.value === 'month') {
         const d = new Date(`${selectedDateISO.value}T00:00:00`)
         calendarMonth.value = new Date(d.getFullYear(), d.getMonth(), 1)
       } else {
         // đảm bảo selected date enable
         if (!isCellEnabled(selectedDateISO.value)) {
           // kéo về start tuần / today
           if (activeRange.value === 'today') selectedDateISO.value = getTodayISO()
           if (activeRange.value === 'week') selectedDateISO.value = toISODate(startOfWeek(new Date(`${selectedDateISO.value}T00:00:00`)))
         }
       }

       generateCalendar()
       updateDaySchedule()
       updateFilterOutputs()
     },
 )
 watch(
     () => {
       const { startDate, endDate } = getFilterRange()
       return `${startDate}|${endDate}`
     },
     () => {
+      if (!statsReady.value) return
       fetchAppointmentSummary()
       fetchStatusChart()
     },
-    { immediate: true }
+    { immediate: false }
 )
 async function fetchAppointmentSummary() {
   const { startDate, endDate } = getFilterRange()

   summaryLoading.value = true
   summaryError.value = ''

   try {
     const res = await api.get('/customer-crm/admin/lich-hen/summary', {
       params: {
         fromDate: startDate,
         toDate: endDate,
       },
     })

     statTotal.value = res.data.total ?? 0
     statUp.value = res.data.up ?? 0
     statPending.value = res.data.pending ?? 0
     statCancelled.value = res.data.cancelled ?? 0

   } catch (e) {
     summaryError.value = 'Không thể tải thống kê'
   } finally {
     summaryLoading.value = false
   }
@@ -1524,50 +1578,57 @@ watch(
     (val) => {
       if (searchTimer) clearTimeout(searchTimer)
       searchTimer = setTimeout(() => {
         searchKeyword.value = (val || '').trim()
       }, 300)
     },
 )

 watch(
     () => [selectedAppointment.value, historyItems.value.length],
     async () => {
       await nextTick()
       syncHistoryPanelHeight()
     },
 )

 watch(
     () => {
       const { startDate, endDate } = getFilterRange()
       return [startDate, endDate, activeStatus.value, searchKeyword.value].join('|')
     },
     () => {
       fetchAppointments()
     },
 )
+watch(
+    () => appointments.value,
+    () => {
+      updateAppointmentsChart()
+      updateConsultChart()
+    },
+)
 async function autoPickCustomerByPhone(phone) {
   // gán vào input tìm kiếm
   createForm.customerSearch = phone

   // gọi search
   await fetchCustomerSearch(phone)

   // đợi DOM + data
   await nextTick()

   // auto chọn khách đầu tiên (SĐT unique)
   if (customerSearchResults.value.length > 0) {
     selectCustomer(customerSearchResults.value[0])
   }


 }

 // ===== Mount =====
 onMounted(async () => {
   if (!rootRef.value) return
 // ===== AUTO MỞ MODAL TẠO LỊCH TỪ TELESALE =====

   const flagDatLich = localStorage.getItem('flagDatLich')
   const customerPhone = localStorage.getItem('customerPhone')
@@ -1576,70 +1637,77 @@ onMounted(async () => {
   } catch (e) {
     console.error('Fetch branch failed', e)
   }
   if (flagDatLich === 'true' && customerPhone) {
     // mở modal tạo lịch
     await openCreateModal()
     await nextTick()
     // auto tìm + chọn khách theo SĐT
     await autoPickCustomerByPhone(customerPhone)

     // xoá localStorage để tránh lặp
     localStorage.removeItem('flagDatLich')
     localStorage.removeItem('customerPhone')
   }
   // ===== Init date =====
   selectedDateISO.value = getTodayISO()
   calendarMonth.value = new Date() // tháng hiện tại

   // ===== Init data =====
   await fetchAppointments()


   // ===== Init charts =====
   await nextTick()
   initCharts()
+  updateStatusChart()
+  updateAppointmentsChart()
+  updateConsultChart()
+  statsReady.value = true

   // ===== Fetch branch options (ONLY ONCE) =====


   // ===== Ready toast =====
   showToast('Sẵn sàng', 'Hệ thống quản lý lịch hẹn đã sẵn sàng.', 'success')

   // ===== Global listeners =====
   registerWindowListener('keydown', (e) => {
     if (e.key === 'Escape' && (isModalOpen.value || isCreateModalOpen.value || isDetailModalOpen.value)) {
       if (isModalOpen.value) closeEditModal()
       if (isCreateModalOpen.value) closeCreateModal()
       if (isDetailModalOpen.value) closeDetailModal()
     }
   })

   registerWindowListener('resize', async () => {
     await nextTick()
     initCharts()
     syncHistoryPanelHeight()
+    updateStatusChart()
+    updateAppointmentsChart()
+    updateConsultChart()
   })

   await fetchAppointmentSummary()
   await fetchStatusChart()

 })


 onBeforeUnmount(() => {
   destroyCharts()
   cleanupHandlers.forEach((cleanup) => cleanup())
 })
 </script>

 <template>
   <div ref="rootRef" class="appointments-page">
     <div class="toast-wrap" id="toastWrap"></div>

     <main class="main-content">
       <div class="header">
         <div class="page-title">
           <h2><i class="fa-solid fa-calendar-check me-2"></i>Quản lý lịch hẹn</h2>
           <p>Tạo, theo dõi và cập nhật trạng thái • phân loại • đánh giá</p>
         </div>
       </div>
