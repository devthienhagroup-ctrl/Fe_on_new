diff --git a/src/components/dich-vu/Phi-dich-vu.vue b/src/components/dich-vu/Phi-dich-vu.vue
index 0c02dc889b9fc24df04079ea361b732a5f8e4edb..a6a01dd6413576627548a8e5cbd262214acaa799 100644
--- a/src/components/dich-vu/Phi-dich-vu.vue
+++ b/src/components/dich-vu/Phi-dich-vu.vue
@@ -178,87 +178,87 @@
                   </td>
                   <td>
                     <div class="font-semibold">{{ contract.nhanVienTao }}</div>
                   </td>
                   <td class="mono">{{ formatCreatedAt(contract.ngayTao) }}</td>
                   <td>
                     <div class="actions" @click.stop>
                       <div class="icon-btn icon-menu" title="T√°c v·ª•" @click.stop="toggleActionMenu(contract.id, $event)">
                         <i class="fa-solid fa-ellipsis"></i>
                       </div>
                     </div>
                   </td>
                 </tr>
                 </tbody>
               </table>
             </div>
           </div>
         </div>
         <teleport to="body">
           <div
             v-if="openActionMenu && activeActionContract"
             class="action-menu action-menu--floating"
             :style="actionMenuPositionStyle"
             @click.stop
           >
-            <div class="action-item" @click="closeActionMenu(); openDetail(activeActionContract)">
+            <div class="action-item" @click="openDetail(activeActionContract); closeActionMenu()">
               <span class="icon-btn icon-view" aria-hidden="true">
                 <i class="fa-solid fa-eye"></i>
               </span>
               <span class="action-label">Chi ti·∫øt</span>
             </div>
             <div
               class="action-item"
               :class="{ disabled: !isActiveContract(activeActionContract) }"
-              @click="isActiveContract(activeActionContract) && (closeActionMenu(), openPay(activeActionContract))"
+              @click="isActiveContract(activeActionContract) && (openPay(activeActionContract), closeActionMenu())"
             >
               <span class="icon-btn icon-pay" aria-hidden="true">
                 <i class="fa-solid fa-circle-dollar-to-slot"></i>
               </span>
               <span class="action-label">ƒê√≥ng ph√≠</span>
             </div>
             <div
               class="action-item"
               :class="{ disabled: !isActiveContract(activeActionContract) }"
-              @click="isActiveContract(activeActionContract) && (closeActionMenu(), openRefund(activeActionContract))"
+              @click="isActiveContract(activeActionContract) && (openRefund(activeActionContract), closeActionMenu())"
             >
               <span class="icon-btn icon-refund" aria-hidden="true">
                 <i class="fa-solid fa-arrow-rotate-left"></i>
               </span>
               <span class="action-label">Ho√†n ph√≠</span>
             </div>
             <div
               class="action-item"
               :class="{ disabled: !isActiveContract(activeActionContract) }"
-              @click="isActiveContract(activeActionContract) && (closeActionMenu(), openAdjust(activeActionContract))"
+              @click="isActiveContract(activeActionContract) && (openAdjust(activeActionContract), closeActionMenu())"
             >
               <span class="icon-btn icon-adjust" aria-hidden="true">
                 <i class="fa-solid fa-sliders"></i>
               </span>
               <span class="action-label">ƒêi·ªÅu ch·ªânh</span>
             </div>
-            <div class="action-item" @click="closeActionMenu(); openDelete(activeActionContract)">
+            <div class="action-item" @click="openDelete(activeActionContract); closeActionMenu()">
               <span class="icon-btn icon-del" aria-hidden="true">
                 <i class="fa-solid fa-trash"></i>
               </span>
               <span class="action-label">X√≥a</span>
             </div>
           </div>
         </teleport>
         <div class="pagination">
           <div class="muted tiny">
             Hi·ªÉn th·ªã {{ pageStart }}-{{ pageEnd }} / {{ totalElements }}
           </div>
           <div class="pager">
             <button class="btn ghost btn-page" :disabled="currentPage === 1" @click="prevPage">Tr∆∞·ªõc</button>
             <button
               v-for="page in totalPages"
               :key="page"
               class="btn ghost btn-page"
               :class="{ active: currentPage === page }"
               @click="goToPage(page)"
             >
               {{ page }}
             </button>
             <button class="btn ghost btn-page" :disabled="currentPage === totalPages" @click="nextPage">Sau</button>
           </div>
         </div>
@@ -695,72 +695,215 @@
         </div>
       </div>
     </div>

     <!-- MODAL: ADJUST -->
     <div class="modal" :class="{ show: showModal === 'modalAdjust' }" @click.self="closeModal('modalAdjust')">
       <div class="modal-card">
         <div class="modal-h">
           <div class="modal-title">
             <i class="fa-solid fa-sliders"></i>
             ƒêi·ªÅu ch·ªânh h·ª£p ƒë·ªìng
           </div>
           <button class="x" @click="closeModal('modalAdjust')">
             <i class="fa-solid fa-xmark"></i>
           </button>
         </div>

         <div class="modal-b">
           <div class="grid grid-cols-1 lg:grid-cols-2 gap-3">
             <div class="card">
               <div class="card-h"><i class="fa-solid fa-pen-to-square"></i> Th√¥ng tin ƒëi·ªÅu ch·ªânh</div>

               <div class="field">
                 <label><i class="fa-solid fa-coins"></i> S·ªë ti·ªÅn ƒëi·ªÅu ch·ªânh</label>
                 <input
+                  v-if="adjustment.type !== 'CHUYEN_DOI_DV'"
                   :value="formatNumberInput(adjustment.amount)"
                   type="text"
                   inputmode="numeric"
                   placeholder="VD: 300.000"
                   @input="handleAdjustmentAmountInput"
                 >
+                <input
+                  v-else
+                  type="text"
+                  value="Theo d·ªãch v·ª• chuy·ªÉn ƒë·ªïi"
+                  readonly
+                >
                 <div class="muted tiny">Ch·ªâ nh·∫≠p s·ªë d∆∞∆°ng cho ƒëi·ªÅu ch·ªânh.</div>
               </div>

               <div class="field">
                 <label><i class="fa-solid fa-layer-group"></i> Lo·∫°i ƒëi·ªÅu ch·ªânh</label>
                 <select v-model="adjustment.type">
                   <option value="GIAM_GIA">Gi·∫£m th√™m</option>
                   <option value="PHU_THU">Ph·ª• thu</option>
                   <option value="PHAT">Ph·∫°t</option>
+                  <option value="CHUYEN_DOI_DV">Chuy·ªÉn ƒë·ªïi d·ªãch v·ª•</option>
                 </select>
               </div>

               <div class="field">
                 <label><i class="fa-solid fa-clipboard"></i> L√Ω do</label>
                 <textarea v-model="adjustment.reason" placeholder="VD: Ph·∫°t tr·ªÖ ti·∫øn ƒë·ªô..."></textarea>
               </div>
+
+              <template v-if="adjustment.type === 'CHUYEN_DOI_DV'">
+                <div class="section-title">
+                  <i class="fa-solid fa-briefcase"></i>
+                  D·ªãch v·ª• & gi√° tr·ªã
+                </div>
+
+                <div class="field">
+                  <label class="field-label">
+                    <span class="label-ico tone-indigo"><i class="fa-solid fa-list"></i></span>
+                    <span>D·ªãch v·ª•</span>
+                  </label>
+                  <select v-model="adjustment.serviceId">
+                    <option v-for="service in serviceOptions" :key="service.id || service.name" :value="service.id || service.name">
+                      {{ service.name }}
+                    </option>
+                  </select>
+                </div>
+
+                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 px-3 pb-2">
+                  <div class="field !m-0">
+                    <label class="field-label">
+                      <span class="label-ico tone-teal"><i class="fa-solid fa-building"></i></span>
+                      <span>Gi√° tr·ªã t√†i s·∫£n k√Ω b√°n</span>
+                    </label>
+                    <input
+                      :value="formatNumberInput(adjustment.giaTriTaiSan)"
+                      type="text"
+                      inputmode="numeric"
+                      placeholder="VD: 1.500.000.000"
+                      @input="adjustment.giaTriTaiSan = parseNumberInput($event.target.value)"
+                    >
+                  </div>
+
+                  <div class="field !m-0">
+                    <label class="field-label">
+                      <span class="label-ico tone-orange"><i class="fa-solid fa-money-bill-wave"></i></span>
+                      <span>Gi√° g·ªëc</span>
+                    </label>
+                    <input :value="formatMoney(adjustment.giaDichVuGoc)" type="text" readonly>
+                  </div>
+                </div>
+
+                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 px-3 pb-2">
+                  <div class="field !m-0">
+                    <label class="field-label">
+                      <span class="label-ico tone-pink"><i class="fa-solid fa-tags"></i></span>
+                      <span>Gi·∫£m gi√°</span>
+                      <div class="discount-toggle">
+                        <button type="button" :class="{ active: adjustment.discountMode === 'MONEY' }" @click="setAdjustmentDiscountMode('MONEY')">
+                          <i class="fa-solid fa-money-bill-wave"></i>
+                          Ti·ªÅn
+                        </button>
+                        <button type="button" :class="{ active: adjustment.discountMode === 'PERCENT' }" @click="setAdjustmentDiscountMode('PERCENT')">
+                          <i class="fa-solid fa-percent"></i>
+                          %
+                        </button>
+                      </div>
+                    </label>
+                    <div class="discount-input">
+                      <div class="discount-value">
+                        <input
+                          :value="adjustment.discountMode === 'PERCENT' ? adjustment.discountValue : formatNumberInput(adjustment.discountValue)"
+                          type="text"
+                          inputmode="numeric"
+                          :placeholder="adjustment.discountMode === 'PERCENT' ? 'VD: 10' : 'VD: 1.000.000'"
+                          @input="setAdjustmentDiscountValueFromInput($event.target.value)"
+                        >
+                        <span class="discount-suffix">{{ adjustment.discountMode === 'PERCENT' ? '%' : '‚Ç´' }}</span>
+                      </div>
+                    </div>
+                  </div>
+
+                  <div class="field !m-0">
+                    <label class="field-label">
+                      <span class="label-ico tone-purple"><i class="fa-solid fa-circle-dollar-to-slot"></i></span>
+                      <span>Gi√° sau gi·∫£m</span>
+                    </label>
+                    <input :value="formatMoney(adjustment.giaSauGiam)" type="text" readonly>
+                  </div>
+                </div>
+
+                <div class="section-title">
+                  <i class="fa-solid fa-wallet"></i>
+                  Tu·ª≥ ch·ªçn thanh to√°n ban ƒë·∫ßu
+                </div>
+
+                <div class="px-3 pb-2">
+                  <div class="plan" id="planAdjustWrap">
+                    <div class="plan-item" :class="{ active: adjustment.initPlan === 'COC' }" @click="adjustment.initPlan = 'COC'">
+                      <div class="plan-ico"><i class="fa-solid fa-hand-holding-dollar"></i></div>
+                      <div class="min-w-0">
+                        <div class="plan-tt">C·ªçc (%)</div>
+                      </div>
+                    </div>
+
+                    <div class="plan-item" :class="{ active: adjustment.initPlan === 'FULL' }" @click="adjustment.initPlan = 'FULL'">
+                      <div class="plan-ico"><i class="fa-solid fa-circle-check"></i></div>
+                      <div class="min-w-0">
+                        <div class="plan-tt">ƒê√≥ng t·∫•t</div>
+                      </div>
+                    </div>
+                  </div>
+
+                  <div class="grid grid-cols-1 gap-3" :class="adjustment.initPlan === 'COC' ? 'md:grid-cols-3' : 'md:grid-cols-2'">
+                    <div v-if="adjustment.initPlan === 'COC'" class="field !m-0">
+                      <label class="field-label">
+                        <span class="label-ico tone-gold"><i class="fa-solid fa-percent"></i></span>
+                        <span>% c·ªçc</span>
+                      </label>
+                      <input v-model.number="adjustment.tiLeCoc" type="number" min="0" max="100" placeholder="VD: 30"
+                             :disabled="adjustment.initPlan === 'FULL'">
+                    </div>
+
+                    <div class="field !m-0">
+                      <label class="field-label">
+                        <span class="label-ico tone-cyan"><i class="fa-solid fa-money-check-dollar"></i></span>
+                        <span>Ti·ªÅn thanh to√°n</span>
+                      </label>
+                      <input :value="formatMoney(adjustmentFirstPaymentAmount)" type="text" readonly>
+                    </div>
+
+                    <div class="field !m-0">
+                      <label class="field-label">
+                        <span class="label-ico tone-forest"><i class="fa-solid fa-credit-card"></i></span>
+                        <span>H√¨nh th·ª©c</span>
+                      </label>
+                      <select v-model="adjustment.firstMethod">
+                        <option value="CHUYEN_KHOAN">Chuy·ªÉn kho·∫£n</option>
+                        <option value="TIEN_MAT">Ti·ªÅn m·∫∑t</option>
+                      </select>
+                    </div>
+                  </div>
+                </div>
+              </template>
             </div>

             <div class="card">
               <div class="card-h"><i class="fa-solid fa-circle-info"></i> T√≥m t·∫Øt h·ª£p ƒë·ªìng</div>
               <div class="p-3">
                 <div class="text-sm font-extrabold">{{ currentContract?.maHopDong }} ‚Ä¢ {{ currentContract?.tenKhachHang }}</div>
                 <div class="muted tiny mt-1">{{ currentContract?.tenDichVu }} ‚Ä¢ Ng√†y t·∫°o {{ formatCreatedAt(currentContract?.ngayTao) }} ‚Ä¢ Tr·∫°ng th√°i {{ getStatusText(currentContract?.trangThaiHopDong) }}</div>

                 <div class="grid grid-cols-2 gap-2 mt-3">
                   <div class="kpi">
                     <div class="k"><span class="dot"></span>Gi√° sau gi·∫£m</div>
                     <div class="v price p4">{{ formatMoney(currentContract?.giaSauGiam || 0) }}</div>
                   </div>
                   <div class="kpi">
                     <div class="k"><span class="dot"></span>T·ªïng ƒëi·ªÅu ch·ªânh</div>
                     <div class="v price p2">{{ formatMoney(getTongDieuChinh(currentContract)) }}</div>
                   </div>
                   <div class="kpi">
                     <div class="k"><span class="dot"></span>Doanh thu</div>
                     <div class="v price p1">{{ formatMoney(getDoanhThuRow(currentContract)) }}</div>
                   </div>
                   <div class="kpi">
                     <div class="k"><span class="dot"></span>Doanh s·ªë</div>
                     <div class="v price p3">{{ formatMoney(getDoanhSoRow(currentContract)) }}</div>
                   </div>
@@ -1019,51 +1162,51 @@
   </div>
 </template>

 <script setup>
 import { ref, computed, watch, onMounted, onUnmounted } from 'vue'
 import api from '/src/api/api.js'
 import {
   confirmWithInput,
   showCenterWarning,
   showError,
   showLoading,
   updateAlertError,
   updateAlertSuccess
 } from '/src/assets/js/alertService.js'
 import ContractStatsDashboard from "../thiet-kegiandien/ContractStatsDashboard.vue";
 const todayISO = () => {
   const d = new Date()
   const yyyy = d.getFullYear()
   const mm = String(d.getMonth() + 1).padStart(2, '0')
   const dd = String(d.getDate()).padStart(2, '0')
   return `${yyyy}-${mm}-${dd}`
 }
 // Constants
 const ENUM_STATUS = ['DANG_HIEU_LUC', 'HOAN_TAT', 'HUY']
 const ENUM_PAY = ['TIEN_MAT', 'CHUYEN_KHOAN', 'QR', 'KHAC']
-const ENUM_ADJ = ['GIAM_GIA', 'PHU_THU', 'PHAT']
+const ENUM_ADJ = ['GIAM_GIA', 'PHU_THU', 'PHAT', 'CHUYEN_DOI_DV']

 // State
 const activeTab = ref(1)
 const contracts = ref([])
 const totalElements = ref(0)
 const totalPages = ref(1)
 const seq = ref(1)
 const services = ref([])
 const segments = ref([])

 // Filters
 const searchQuery = ref('')
 const filterService = ref(null)
 const filterStatus = ref(null)
 const tuNgay = ref(null)
 const denNgay = ref(null)
 const currentPage = ref(1)
 const pageSize = ref(2)
 const currentUserName = ref('Nguy·ªÖn Minh')
 const searchTimer = ref(null)

 // Customer search
 const customerSearch = ref('')
 const selectedCustomer = ref(null)
 const customerSearchResults = ref([])
@@ -1097,51 +1240,62 @@ const newContract = ref({
 const showModal = ref(null)
 const currentContract = ref(null)
 const detailContract = ref(null)
 const openActionMenu = ref(null)
 const actionMenuPosition = ref({ top: 0, left: 0 })

 // Payment form
 const payment = ref({
   amount: 0,
   method: 'CHUYEN_KHOAN',
   date: todayISO(),
   note: ''
 })

 // Refund form
 const refund = ref({
   amount: 0,
   date: todayISO(),
   reason: ''
 })

 // Adjustment form
 const adjustment = ref({
   amount: 0,
   type: 'GIAM_GIA',
-  reason: ''
+  reason: '',
+  tenDichVu: '',
+  serviceId: null,
+  giaTriTaiSan: null,
+  giaDichVuGoc: 0,
+  phiGiam: 0,
+  discountMode: 'PERCENT',
+  discountValue: 0,
+  giaSauGiam: 0,
+  initPlan: 'COC',
+  tiLeCoc: 30,
+  firstMethod: 'CHUYEN_KHOAN'
 })

 // Toast
 const showToast = ref(false)
 const toast = ref({
   type: 'info',
   title: '',
   text: '',
   icon: 'fa-solid fa-circle-info'
 })

 // Computed properties
 const pageStart = computed(() => {
   if (!totalElements.value) return 0
   return (currentPage.value - 1) * pageSize.value + 1
 })

 const pageEnd = computed(() => {
   return Math.min(currentPage.value * pageSize.value, totalElements.value)
 })

 const totalDoanhThu = computed(() => {
   return contracts.value.reduce((sum, c) => sum + getDoanhThu(c), 0)
 })

@@ -1173,50 +1327,58 @@ const matchingSegment = computed(() => {
   ) || null
 })

 const segmentHint = computed(() => {
   if (!newContract.value.serviceId) {
     return 'Vui l√≤ng ch·ªçn d·ªãch v·ª• ƒë·ªÉ hi·ªÉn th·ªã ph√¢n kh√∫c.'
   }
   if (!newContract.value.giaTriTaiSan) {
     return 'Nh·∫≠p gi√° tr·ªã t√†i s·∫£n ƒë·ªÉ x√°c ƒë·ªãnh m·ª©c gi√° g·ªëc.'
   }
   if (!matchingSegment.value) {
     return 'Ch∆∞a c√≥ ph√¢n kh√∫c ph√π h·ª£p v·ªõi gi√° tr·ªã t√†i s·∫£n n√†y.'
   }
   return `Ph√¢n kh√∫c ${formatMoney(matchingSegment.value.min)} ‚Üí ${formatMoney(matchingSegment.value.max)}`
 })

 const firstPaymentAmount = computed(() => {
   if (newContract.value.initPlan === 'FULL') {
     return newContract.value.giaSauGiam
   } else {
     const percent = Math.max(0, Math.min(100, newContract.value.tiLeCoc || 0))
     return Math.round(newContract.value.giaSauGiam * (percent / 100))
   }
 })

+const adjustmentFirstPaymentAmount = computed(() => {
+  if (adjustment.value.initPlan === 'FULL') {
+    return adjustment.value.giaSauGiam
+  }
+  const percent = Math.max(0, Math.min(100, adjustment.value.tiLeCoc || 0))
+  return Math.round((adjustment.value.giaSauGiam || 0) * (percent / 100))
+})
+
 // Watchers
 watch(searchQuery, () => {
   currentPage.value = 1
   queueSearch()
 })

 watch(filterService, () => {
   currentPage.value = 1
   fetchContracts()
 })

 watch(filterStatus, () => {
   currentPage.value = 1
   fetchContracts()
 })

 watch([tuNgay, denNgay], () => {
   currentPage.value = 1
   fetchContracts()
 })

 watch(currentPage, () => {
   fetchContracts()
 })

@@ -1247,50 +1409,62 @@ watch(customerSearch, (val) => {
   if (!k) {
     lastCustomerKeyword.value = ''
     customerSearchResults.value = []
     customerSearchError.value = ''
     customerSearchLoading.value = false
     return
   }

   customerSearchTimer.value = setTimeout(() => {
     fetchCustomerSearch(k)
   }, 250)
 })

 watch(() => newContract.value.serviceId, () => {
   updateServicePrice()
 })

 watch(() => newContract.value.giaTriTaiSan, () => {
   updateGiaGocFromAsset()
 })

 watch(() => newContract.value.discountMode, () => {
   updateGiaSauGiam()
 })

+watch(() => adjustment.value.serviceId, () => {
+  updateAdjustmentServicePrice()
+})
+
+watch(() => adjustment.value.giaTriTaiSan, () => {
+  updateAdjustmentGiaGocFromAsset()
+})
+
+watch(() => adjustment.value.discountMode, () => {
+  updateAdjustmentGiaSauGiam()
+})
+
 watch(() => payment.value.amount, (val) => {
   if (!currentContract.value) return

   const maxAmount = calcConThieu(currentContract.value)

   // üîë Parse ‚Üí √âP S·ªê NGUY√äN
   let num = Math.floor(parseNumberInput(val))

   if (num > maxAmount) num = maxAmount
   if (num < 0) num = 0

   if (num !== payment.value.amount) {
     payment.value.amount = num
   }
 })

 watch(() => refund.value.amount, (val) => {
   if (!currentContract.value) return

   const maxAmount = getMaxRefundAmount(currentContract.value)
   let num = Math.floor(parseNumberInput(val))

   if (num > maxAmount) num = maxAmount
   if (num < 0) num = 0

@@ -1629,50 +1803,91 @@ const setDiscountMode = (mode) => {

 const updateGiaSauGiam = () => {
   const giaGoc = Number(newContract.value.giaDichVuGoc || 0)
   if (newContract.value.discountMode === 'PERCENT') {
     const percent = Math.max(0, Math.min(100, Number(newContract.value.discountValue || 0)))
     newContract.value.discountValue = percent
     newContract.value.phiGiam = Math.round(giaGoc * (percent / 100))
   } else {
     const money = Number(newContract.value.discountValue || 0)
     const clamped = Math.max(0, Math.min(giaGoc, money))
     newContract.value.discountValue = clamped
     newContract.value.phiGiam = clamped
   }
   newContract.value.giaSauGiam = Math.max(0, giaGoc - (newContract.value.phiGiam || 0))
 }

 const setDiscountValueFromInput = (value) => {
   if (newContract.value.discountMode === 'PERCENT') {
     newContract.value.discountValue = parseNumberInput(value)
   } else {
     newContract.value.discountValue = parseNumberInput(value)
   }
   updateGiaSauGiam()
 }

+const updateAdjustmentServicePrice = () => {
+  const service = getServiceById(adjustment.value.serviceId)
+  adjustment.value.tenDichVu = service?.name || ''
+  updateAdjustmentGiaGocFromAsset()
+}
+
+const updateAdjustmentGiaGocFromAsset = () => {
+  const assetValue = Number(adjustment.value.giaTriTaiSan || 0)
+  const segment = findSegmentForAsset(adjustment.value.serviceId, assetValue)
+  if (segment) {
+    adjustment.value.giaDichVuGoc = Number(segment.price || 0)
+  } else {
+    adjustment.value.giaDichVuGoc = 0
+  }
+  updateAdjustmentGiaSauGiam()
+}
+
+const setAdjustmentDiscountMode = (mode) => {
+  adjustment.value.discountMode = mode
+}
+
+const updateAdjustmentGiaSauGiam = () => {
+  const giaGoc = Number(adjustment.value.giaDichVuGoc || 0)
+  if (adjustment.value.discountMode === 'PERCENT') {
+    const percent = Math.max(0, Math.min(100, Number(adjustment.value.discountValue || 0)))
+    adjustment.value.discountValue = percent
+    adjustment.value.phiGiam = Math.round(giaGoc * (percent / 100))
+  } else {
+    const money = Number(adjustment.value.discountValue || 0)
+    const clamped = Math.max(0, Math.min(giaGoc, money))
+    adjustment.value.discountValue = clamped
+    adjustment.value.phiGiam = clamped
+  }
+  adjustment.value.giaSauGiam = Math.max(0, giaGoc - (adjustment.value.phiGiam || 0))
+}
+
+const setAdjustmentDiscountValueFromInput = (value) => {
+  adjustment.value.discountValue = parseNumberInput(value)
+  updateAdjustmentGiaSauGiam()
+}
+
 const setPaymentAmountFromInput = (value) => {
   const parsed = parseNumberInput(value)
   const maxAmount = calcConThieu(currentContract.value)
   payment.value.amount = Math.min(parsed, maxAmount)
 }

 const setRefundAmountFromInput = (value) => {
   const parsed = parseNumberInput(value)
   const maxAmount = getMaxRefundAmount(currentContract.value)
   refund.value.amount = Math.min(parsed, maxAmount)
 }

 const clearSelectedCustomer = () => {
   selectedCustomer.value = null
   customerSearch.value = ''
   customerSearchResults.value = []
   customerSearchError.value = ''
   customerSearchLoading.value = false
   newContract.value.maKhachHang = ''
   newContract.value.tenKhachHang = ''
 }

 const fetchCustomerSearch = async (keyword) => {
   const k = (keyword || '').trim()
   if (!k) {
@@ -1907,149 +2122,203 @@ const saveRefund = async () => {

   const payload = {
     hopDongId: currentContract.value.id,
     soTienHoan: refund.value.amount,
     ngayHoan: refund.value.date || todayISO(),
     lyDoHoan: reason
   }

   try {
     await showLoading(api.post('/hop-dong/admin/hoan-phi', payload))
     updateAlertSuccess('Ho√†n ph√≠ th√†nh c√¥ng', `-${formatMoney(refund.value.amount)}`)
     await fetchContracts()
     closeModal('modalRefund')
   } catch (error) {
     console.error('‚ùå L·ªói ho√†n ph√≠', error)
     updateAlertError('Ho√†n ph√≠ th·∫•t b·∫°i', 'Vui l√≤ng th·ª≠ l·∫°i sau.')
   }
 }

 // Adjustment management
 const openAdjust = (contract) => {
   currentContract.value = contract
   adjustment.value = {
     amount: 0,
     type: 'GIAM_GIA',
-    reason: ''
+    reason: '',
+    tenDichVu: contract?.tenDichVu || '',
+    serviceId: contract?.serviceId || null,
+    giaTriTaiSan: getGiaTaiSanKy(contract),
+    giaDichVuGoc: Number(contract?.giaDichVuGoc || 0),
+    phiGiam: Number(contract?.phiGiam || 0),
+    discountMode: 'PERCENT',
+    discountValue: 0,
+    giaSauGiam: Number(contract?.giaSauGiam || 0),
+    initPlan: 'COC',
+    tiLeCoc: 30,
+    firstMethod: 'CHUYEN_KHOAN'
   }
+  updateAdjustmentGiaGocFromAsset()
   openModal('modalAdjust')
 }

 const handleAdjustmentAmountInput = (event) => {
   adjustment.value.amount = parseNumberInput(event.target.value)
 }

 const saveAdjustment = async () => {
-  if (adjustment.value.amount <= 0) {
-    showCenterWarning('S·ªë ti·ªÅn kh√¥ng h·ª£p l·ªá', 'ƒêi·ªÅu ch·ªânh ph·∫£i l·ªõn h∆°n 0.')
+  if (!ENUM_ADJ.includes(adjustment.value.type)) {
+    showCenterWarning('Lo·∫°i ƒëi·ªÅu ch·ªânh sai', 'Ch·ªçn GIAM_GIA/PHU_THU/PHAT/CHUYEN_DOI_DV.')
     return
   }

-  if (!ENUM_ADJ.includes(adjustment.value.type)) {
-    showCenterWarning('Lo·∫°i ƒëi·ªÅu ch·ªânh sai', 'Ch·ªçn GIAM_GIA/PHU_THU/PHAT.')
+  if (adjustment.value.type !== 'CHUYEN_DOI_DV' && adjustment.value.amount <= 0) {
+    showCenterWarning('S·ªë ti·ªÅn kh√¥ng h·ª£p l·ªá', 'ƒêi·ªÅu ch·ªânh ph·∫£i l·ªõn h∆°n 0.')
     return
   }

   if (adjustment.value.type === 'GIAM_GIA') {
     const giaSauGiam = Number(currentContract.value?.giaSauGiam || 0)
     const tongDieuChinh = getTongDieuChinh(currentContract.value)
     const maxGiam = giaSauGiam + tongDieuChinh
     if (adjustment.value.amount > maxGiam) {
       showCenterWarning(
         'S·ªë ti·ªÅn gi·∫£m v∆∞·ª£t m·ª©c',
         `T·ªëi ƒëa ƒë∆∞·ª£c gi·∫£m: ${formatMoney(maxGiam)}.`
       )
       return
     }
   }

   const reason = (adjustment.value.reason || '').trim()
   if (!reason) {
     showCenterWarning('Thi·∫øu l√Ω do', 'B·∫°n c·∫ßn nh·∫≠p l√Ω do ƒëi·ªÅu ch·ªânh.')
     return
   }

+  if (adjustment.value.type === 'CHUYEN_DOI_DV') {
+    updateAdjustmentGiaSauGiam()
+    if (!adjustment.value.serviceId) {
+      showCenterWarning('Thi·∫øu d·ªØ li·ªáu', 'B·∫°n c·∫ßn ch·ªçn d·ªãch v·ª• chuy·ªÉn ƒë·ªïi.')
+      return
+    }
+    if (!adjustment.value.giaTriTaiSan) {
+      showCenterWarning('Thi·∫øu d·ªØ li·ªáu', 'B·∫°n c·∫ßn nh·∫≠p gi√° tr·ªã t√†i s·∫£n k√Ω b√°n.')
+      return
+    }
+    if (!adjustment.value.giaDichVuGoc) {
+      showCenterWarning('Thi·∫øu d·ªØ li·ªáu', 'Gi√° g·ªëc ch∆∞a x√°c ƒë·ªãnh theo ph√¢n kh√∫c.')
+      return
+    }
+    if (adjustment.value.discountMode === 'MONEY' && adjustment.value.discountValue <= 0) {
+      showCenterWarning('Gi·∫£m gi√° kh√¥ng h·ª£p l·ªá', 'Gi·∫£m gi√° ti·ªÅn ph·∫£i > 0 v√† kh√¥ng v∆∞·ª£t qu√° gi√° g·ªëc.')
+      return
+    }
+    logServiceSwitchAdjustment({
+      hopDongId: currentContract.value?.id,
+      reason,
+      serviceId: adjustment.value.serviceId,
+      giaTriKyBan: adjustment.value.giaTriTaiSan,
+      giaDichVuGoc: adjustment.value.giaDichVuGoc,
+      phiGiam: adjustment.value.phiGiam,
+      giaSauGiam: adjustment.value.giaSauGiam,
+      initPlan: adjustment.value.initPlan,
+      tiLeCoc: adjustment.value.initPlan === 'COC' ? adjustment.value.tiLeCoc : null,
+      soTienThanhToan: adjustmentFirstPaymentAmount.value,
+      hinhThucThanhToan: adjustment.value.firstMethod
+    })
+    closeModal('modalAdjust')
+    return
+  }
+
   const payload = {
     hopDongId: currentContract.value.id,
     soTienDieuChinh: adjustment.value.amount,
     loaiDieuChinh: adjustment.value.type,
     lyDo: reason
   }

   try {
     await showLoading(api.post('/hop-dong/admin/dieu-chinh', payload))
     updateAlertSuccess('ƒêi·ªÅu ch·ªânh th√†nh c√¥ng',
         `${adjustment.value.type === 'GIAM_GIA' ? '-' : '+'}${formatMoney(adjustment.value.amount)} (${adjustment.value.type})`)
     await fetchContracts()
     closeModal('modalAdjust')
   } catch (error) {
     console.error('‚ùå L·ªói ƒëi·ªÅu ch·ªânh', error)
     updateAlertError('ƒêi·ªÅu ch·ªânh th·∫•t b·∫°i', 'Vui l√≤ng th·ª≠ l·∫°i sau.')
   }
 }

+const logServiceSwitchAdjustment = (payload) => {
+  console.log('CHUYEN_DOI_DV payload', payload)
+}
+
 const isActiveContract = (contract) => contract?.trangThaiHopDong === 'DANG_HIEU_LUC'

 const activeActionContract = computed(() =>
   contracts.value.find((contract) => contract.id === openActionMenu.value)
 )

 const actionMenuPositionStyle = computed(() => ({
   top: `${actionMenuPosition.value.top}px`,
   left: `${actionMenuPosition.value.left}px`
 }))

 const toggleActionMenu = (contractId, event) => {
   if (openActionMenu.value === contractId) {
     openActionMenu.value = null
     return
   }
   const target = event?.currentTarget
   if (target) {
     const rect = target.getBoundingClientRect()
     const menuWidth = 200
     const gap = 12
     const left = Math.max(12, rect.left - menuWidth - gap)
     const top = Math.min(
       window.innerHeight - 12,
       Math.max(12, rect.top + rect.height / 2)
     )
     actionMenuPosition.value = { top, left }
   }
   openActionMenu.value = contractId
 }

 const closeActionMenu = () => {
   openActionMenu.value = null
 }

 const handleDocumentClick = () => {
   openActionMenu.value = null
 }

 // Detail view
 const openDetail = (contract) => {
+  if (!contract) {
+    return
+  }
   currentContract.value = contract
   detailContract.value = {
     ...contract,
     dotDongTiens: contract?.dotDongTien || [],
     hoanTiens: contract?.hoanTien || [],
     dieuChinhHopDongs: contract?.dieuChinh || []
   }
   openModal('modalDetail')
   console.log(contract)
   fetchDetailContract(contract.id)
 }

 const fetchDetailContract = async (contractId) => {
   if (!contractId) return
   try {
       const res = await api.get(`/hop-dong/admin/${contractId}/detail`)
     detailContract.value = res?.data || detailContract.value
   } catch (error) {
     console.error('‚ùå L·ªói t·∫£i chi ti·∫øt h·ª£p ƒë·ªìng', error)
     updateAlertError('T·∫£i chi ti·∫øt th·∫•t b·∫°i', 'Vui l√≤ng th·ª≠ l·∫°i sau.')
   }
 }

 const cancelContract = async () => {
   const contract = detailContract.value || currentContract.value
